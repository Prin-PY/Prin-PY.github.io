<!DOCTYPE html>


<html lang="en">
  

    <head>
      <meta charset="utf-8" />
        
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title> 半个出家人</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/img/circle_image.png" />
       
<link rel="stylesheet" href="/dist/main.css">

      
<link rel="stylesheet" href="/css/fonts/remixicon.css">

      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    <link rel="alternate" href="/atom.xml" title="半个出家人" type="application/atom+xml">
</head>
  </html>
</html>


<body>
  <div id="app">
    
      
    <main class="content on">
      
<section class="cover">
    
      
      <a class="forkMe" href="https://github.com/Shen-Yu/hexo-theme-ayer"
        target="_blank"><img width="149" height="149" src="/images/forkme.png"
          class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="img/header_img/home-bg-1.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">半个出家人</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.staticfile.org/typed.js/2.0.12/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['The world isn&#39;t split into good people and Death Eaters. We&#39;ve all got both light and dark inside us. What matters is the part we choose to act on. That&#39;s who we really are.', '愿你一生努力，一生被爱', '想要的都拥有，得不到的都释怀'],
        startDelay: 0,
        typeSpeed: 100,
        loop: true,
        backSpeed: 80,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  <ul class="ads">
    
        <li>
            <a href="https://curl.qcloud.com/kvO7hb43" target="_blank" rel="noopener">
                <img src="https://pic.imgdb.cn/item/62174b452ab3f51d912a5ccc.jpg" width="300" alt="云服务器限时秒杀">
            </a>
        </li>
    
        <li>
            <a href="https://www.vultr.com/?ref=8630075" target="_blank" rel="noopener">
                <img src="https://pic.imgdb.cn/item/62174b452ab3f51d912a5cd7.png" width="300" alt="vultr优惠vps">
            </a>
        </li>
    
</ul>
  
  
  

<div class="notice" style="margin-top:50px">
    <i class="ri-heart-fill"></i>
    <div class="notice-content" id="broad"></div>
</div>
<script type="text/javascript">
    fetch('https://v1.hitokoto.cn')
        .then(response => response.json())
        .then(data => {
            document.getElementById("broad").innerHTML = data.hitokoto;
        })
        .catch(console.error)
</script>

<style>
    .notice {
        padding: 20px;
        border: 1px dashed #e6e6e6;
        color: #969696;
        position: relative;
        display: inline-block;
        width: 100%;
        background: #fbfbfb50;
        border-radius: 10px;
    }

    .notice i {
        float: left;
        color: #999;
        font-size: 16px;
        padding-right: 10px;
        vertical-align: middle;
        margin-top: -2px;
    }

    .notice-content {
        display: initial;
        vertical-align: middle;
    }
</style>
  
  <article class="articles">
    
    
    
    
    <article
  id="post-Unity3D-BatchMode"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2023/07/25/Unity3D-BatchMode/"
    >BatchMode</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2023/07/25/Unity3D-BatchMode/" class="article-date">
  <time datetime="2023-07-25T12:56:23.239Z" itemprop="datePublished">2023-07-25</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Unity3D/">Unity3D</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="使用原理"><a href="#使用原理" class="headerlink" title="使用原理"></a>使用原理</h2><h3 id="DOS"><a href="#DOS" class="headerlink" title="DOS"></a>DOS</h3><p>DOS是Disk Operation System(磁盘操作系统）的简称，是个人计算机上的一类操作系统。它直接操纵管理硬盘的文件，一般都是黑底白色文字的界面。<br>DOS就是人与机器的一座桥梁，是罩在机器硬件外面的一层“外壳”，只需通过一些接近于自然语言的DOS命令，就可以轻松地完成绝大多数对机器的日常操作。<br>此外，DOS还能有效地管理各种软硬件资源，对它们进行合理的调度，所有的软件和硬件都在DOS的监控和管理之下，有条不紊地进行着自己的工作，但是在操作不慎情况下也会死机。<br><strong>MS-DOS</strong> 是MicroSoft-dos，它不是纯DOS，是基于Windows的DOS程序，在功能上类似于DOS，但是不一样。<br>最新的Windows操作系统中，MS-dos的核心依然存在，只是加上Windows当作系统的图形界面。<br>微软图形界面操作系统 Windows NT 问世以来，DOS是一个 <strong>后台程序</strong> 的形式出现的。名为 <strong>Windows命令提示符</strong> 。可以通过点击运行- <strong>CMD</strong> 进入。</p>
<h4 id="DOS命令"><a href="#DOS命令" class="headerlink" title="DOS命令"></a>DOS命令</h4><p>DOS命令行不许要去专门当做一门语言学习，你只需要根据自己的需求百度一下命令行的使用方式即可。</p>
<h3 id="Batch-bat文件"><a href="#Batch-bat文件" class="headerlink" title="Batch(.bat文件)"></a>Batch(.bat文件)</h3><p><strong>批处理(Batch)</strong> ，也称为 <strong>批处理脚本</strong> 。通常被认为是一种简化的脚本语言，也称作宏。它应用于DOS和Windows系统中。<br>它是由DOS或者Windows系统内嵌的命令解释器（通常是COMMAND. COM或者CMD.EXE）解释运行。类似于Unix中的Shell脚本。批处理文件具有.bat或者.cmd的扩展名，其最简单的例子，是逐行书写在命令行中会用到的各种命令。<br><strong>使用</strong> ：在“命令提示”下键入批处理文件的名称，或者双击该批处理文件，系统就会调用Cmd.exe运行该批处理程序。<br><strong>运行</strong> ：运行批处理程序时，首先扫描整个批处理程序，然后从第一行代码开始向下逐句执行所有的命令，直至程序结尾或遇见exit命令或出错意外退出。</p>
<blockquote>
<p>批处理程序虽然是在命令行环境中运行，但不仅仅能使用命令行软件，任何当前系统下可运行的程序都可以放在批处理文件中运行。</p>
</blockquote>
<h4 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h4><h5 id="echo-命令"><a href="#echo-命令" class="headerlink" title="echo 命令"></a>echo 命令</h5><p>语法: echo [{on|off}] [message]<br>Sample：@echo off / echo hello world</p>
<p>打开回显或关闭请求回显功能，或显示消息。如果没有任何参数，echo命令将显示当前回显设置。<br>在实际应用中我们会把这条命令和重定向符号（也称为管道符号，一般用&gt; &gt;&gt; ^）结合来实现输入一些命令到特定的文件中，例如：</p>
<pre><code class="lang-csharp">
echo test&gt;test.txt 

# 会创建一个名为&quot;test&quot;的文本文件，并将&quot;test&quot;输入到文本文件中。
</code></pre>
<p>在批处理文件的开头，通常有：<br>echo off<br>原因是”@”可以将本行的命令关闭回显，搭配”echo off”就可以不显示”echo off”的回显了。</p>
<h5 id="rem-命令"><a href="#rem-命令" class="headerlink" title="rem 命令"></a>rem 命令</h5><p>语法：Rem [注释内容]<br>Sample：Rem 你好。</p>
<p>注释命令，类似于在C语言中的/ <em>——–</em> /，它并不会被执行，只是起一个注释的作用，只有在编辑批处理时才会被看到，主要用于方便修改。<br>:: 也具有rem的功能<br>但::和rem还是有区别的，当关闭回显时，rem和::后的内容都不会显示。<br>但是当打开回显时，rem后的内容会显示出来，然而::后的内容仍然不会显示。</p>
<h5 id="pause"><a href="#pause" class="headerlink" title="pause"></a>pause</h5><p>暂停命令。运行 Pause 命令时，将显示下面的消息：<br>Press any key to continue…（或：请按任意键继续…)</p>
<h5 id="call"><a href="#call" class="headerlink" title="call"></a>call</h5><h5 id="start"><a href="#start" class="headerlink" title="start"></a>start</h5><h5 id="goto"><a href="#goto" class="headerlink" title="goto"></a>goto</h5><h5 id="set"><a href="#set" class="headerlink" title="set"></a>set</h5><h4 id="符号"><a href="#符号" class="headerlink" title="符号"></a>符号</h4><h3 id="其他概念"><a href="#其他概念" class="headerlink" title="其他概念"></a>其他概念</h3><p>Bash(Bourne-Again SHell): Unix shell的一种，能运行于大多数类Unix系统的操作系统之上，包括Linux与Mac OS X v10.4都将它作为默认shell。<br>是一个命令处理器，通常运行于文本窗口中，并能执行用户直接输入的命令。Bash还能从文件中读取命令，这样的文件称为脚本。</p>
<h3 id="Unity-Editor拓展"><a href="#Unity-Editor拓展" class="headerlink" title="Unity Editor拓展"></a>Unity Editor拓展</h3><p>放在工程目录下Assets/Editor文件下的方法都是对Unity引擎编辑器的拓展，一般常见的插件都会编写一部分编辑器拓展代码来自定义插件的Inspector面板等其他操作。</p>
<h3 id="Editor方法触发方式"><a href="#Editor方法触发方式" class="headerlink" title="Editor方法触发方式"></a>Editor方法触发方式</h3><h4 id="MenuItem"><a href="#MenuItem" class="headerlink" title="MenuItem"></a>MenuItem</h4><h4 id="EditorWindow-gt-Button"><a href="#EditorWindow-gt-Button" class="headerlink" title="EditorWindow-&gt;Button"></a>EditorWindow-&gt;Button</h4><pre><code class="lang-csharp">
using UnityEditor; 

using UnityEngine; 

public class MyClass : EditorWindow

{ 

// 重写window面板

private void OnGUI()

{ 

if(GUILayout.Button(&quot;MyFunc1&quot;)) 

{ 

MyFunc1(); 

} 

} 

// 打开窗口

[MenuItem(&quot;My Tools/My Window&quot;)] 

private static void OpenMyWindow()

{ 

GetWindow&lt;MyClass&gt; (true, &quot;My Window&quot;); 

} 

[MenuItem(&quot;My Tools/MyFunc1&quot;)] 

private static void MyFunc1()

{ 

//..你的操作

Debug.Log (&quot;你的操作&quot;); 

} 

}
</code></pre>
<h4 id="利用批处理来调用"><a href="#利用批处理来调用" class="headerlink" title="利用批处理来调用"></a>利用批处理来调用</h4><p>更多Unity Command line arguments：<a href="https://docs.unity3d.com/Manual/CommandLineArguments.html" target="_blank" rel="noopener">https://docs.unity3d.com/Manual/CommandLineArguments.html</a></p>
<blockquote>
<p>最新Unity支持直接用.bat脚本直接导出linux、MacOS、Window的应用，暂时不支持Android和IOS等其它终端的输出。</p>
</blockquote>
<pre><code class="lang-csharp">
using UnityEditor; 

public class MyWindow : EditorWindow

{ 

public static void MyFunc1()

{ 

Debug.Log(&quot;MyFunc1 Operation&quot;); 

} 

} 

``` ```csharp 

rem 发布工具

@echo off 

echo 启动 Unity.exe 请稍后... 

start /min D:\Unity\Editor\Unity.exe -batchmode -projectPath D:\MyProject\BatchProject -executeMethod MyClass.MyFunc1 

Pause

taskkill /f /im unity.exe
</code></pre>
<h5 id="命令介绍"><a href="#命令介绍" class="headerlink" title="命令介绍"></a>命令介绍</h5><p>echo 为DOS编程中一种显示消息的方法</p>
<p>start DOS编程中用于启动应用程序的命令<br>-batchmode 是Unity提供的Command line arguments中较为常用的一种，它是后台运行Unity，不显示Unity界面，这对于把机械的工作交给策划？美术？是极其重要的。<br>在-batchmode下运行Unity。这应该始终与其他命令行参数一起使用，因为 <strong>它确保没有出现弹出窗口，并且不需要任何人为干预</strong> 。执行脚本代码期间发生异常时，资产服务器更新失败或其他失败的操作，Unity立即退出并返回代码1。<br>请注意，在批处理模式下，Unity将其日志输出的最小版本发送到控制台。但是，日志文件仍然包含完整的日志信息。在编辑器打开相同的项目时以批处理模式打开项目不受支持; Unity的一个实例只能一次运行。</p>
<p>-projectPath 指定项目的路径</p>
<p>-executeMethod(ClassName.MethodName) 调用Unity编辑器某个类型中的某个方法</p>
<p>一旦Unity启动，项目打开，并且执行了可选的Asset Server更新之后，执行静态方法。这可以用于执行持续集成，执行单元测试，构建或准备数据等任务。要从命令行进程返回错误，请抛出异常，导致Unity退出代码1，或者使用非零返回代码调用EditorApplication.Exit。要传递参数，将它们添加到命令行并使用函数检索它们System.Environment.GetCommandLineArgs。要使用-executeMethod，您需要将封闭的脚本放在编辑器文件夹中。要执行的方法必须定义为static。</p>
<p>Ref: <a href="https://blog.csdn.net/qq_29579137/article/details/76598929" target="_blank" rel="noopener">https://blog.csdn.net/qq_29579137/article/details/76598929</a></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/" rel="tag">Unity3D</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-Unity3D-Camera-Screen"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2023/07/25/Unity3D-Camera-Screen/"
    >Camera &amp; Screen</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2023/07/25/Unity3D-Camera-Screen/" class="article-date">
  <time datetime="2023-07-25T12:56:23.239Z" itemprop="datePublished">2023-07-25</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Unity3D/">Unity3D</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="Screen"><a href="#Screen" class="headerlink" title="Screen"></a>Screen</h2><pre><code class="lang-csharp">
Screen.autorotateToLandscapeLeft = true; //自动旋转屏幕为向左 

Screen.autorotateToLandscapeRight = false; //自动旋转屏幕向右 

Screen.autorotateToPortrait = true; //自动旋转为纵向 

Screen.autorotateToPortraitUpsideDown = true; //自动旋转为纵向倒置 

print(Screen.currentResolution); //当前屏幕分辨率 

Screen.fullScreen = !Screen.fullScreen; //是否全屏 

print(Screen.height); //屏幕分辨率的高度 

Screen.lockCursor = !Screen.lockCursor; //是否锁定光标 

Screen.showCursor = !Screen.showCursor; //是否显示光标 

Screen.orientation = ScreenOrientation.Landscape; //屏幕取向 

Resolution[] resolutions = Screen.resolutions; //显示器支持的所有全屏分辨率 

foreach (Resolution res in resolutions) 

{ 

print(res.width + &quot; &quot; \+ res.height); 

} 

//参数1宽， 参数 2高， 参数3是否全屏 

Screen.SetResolution(resolutions[0].width, resolutions[0].height, true);
</code></pre>
<h2 id="Camera"><a href="#Camera" class="headerlink" title="Camera"></a>Camera</h2><h3 id="View-Frustum-视锥体-相关参数图解"><a href="#View-Frustum-视锥体-相关参数图解" class="headerlink" title="View Frustum(视锥体)相关参数图解"></a>View Frustum(视锥体)相关参数图解</h3><h4 id="透视相机-Perspective"><a href="#透视相机-Perspective" class="headerlink" title="透视相机(Perspective)"></a>透视相机(Perspective)</h4><p><img src="assets/Camera%20&amp;%20Screen/20180524230527942.jpg" alt="Alt text"></p>
<p><img src="assets/Camera%20&amp;%20Screen/20180524232513244.jpg" alt="Alt text"></p>
<p>nearClipPalneHeight(近截平面的高)=2<em>Near</em>tan(FOV/2)<br>farClipPlaneHeight(远截平面)=2<em>Far</em>tan(FOV/2)<br>Aspect(摄像机的纵横比)=nearClipPlaneWidth/nearClipPalneHeight=farClipPlaneWidth/farClipPlaneHeight</p>
<h4 id="正交相机-Orthographic"><a href="#正交相机-Orthographic" class="headerlink" title="正交相机(Orthographic)"></a>正交相机(Orthographic)</h4><p><img src="assets/Camera%20&amp;%20Screen/20180524230615918.jpg" alt="Alt text"></p>
<p><img src="assets/Camera%20&amp;%20Screen/20180524231957314.jpg" alt="Alt text"></p>
<p>nearClipPlaneHeight=2*Size<br>farClipPlaneHeight=nearClipPlaneHeight<br>Aspect=nearClipPlaneHeight/farClipPlaneWidth=nearClipPlaneHeight/nearClipPalneWidth</p>
<h3 id="属性（Inspector可见）"><a href="#属性（Inspector可见）" class="headerlink" title="属性（Inspector可见）"></a>属性（Inspector可见）</h3><h4 id="Clear-Flags"><a href="#Clear-Flags" class="headerlink" title="Clear Flags"></a>Clear Flags</h4><p>清除标识：确定了屏幕哪些部分将被清除，方便多个摄像机画不同的游戏元素</p>
<p>Skybox ：<br>天空盒：这是默认设置。屏幕上的任何空的部分将显示当前相机的天空盒。<br>如果当前的相机没有设置天空盒，它会默认在渲染设置（Render Settings ）选择天空盒<br>Solid Color ：<br>纯色，屏幕上的空白部分将显示当前摄像机的背景色<br>Depth Only ：<br>深度相机，只渲染采集到的画面<br>如果你想绘制一个玩家的枪，又不让它内部环境被裁剪，你会设置深度为0的相机绘制环境，<br>和另一个深度为1的相机单独绘制武器。武器相机的清除标志（Clear Flags ）应设置 为depth only。<br>Don’t Clear ：<br>不清除，此模式不清除颜色或深度缓存。每帧的渲染画面叠加在上一帧画面之上。</p>
<h4 id="Background-背景色"><a href="#Background-背景色" class="headerlink" title="Background:背景色"></a>Background:背景色</h4><h4 id="Culling-Mask"><a href="#Culling-Mask" class="headerlink" title="Culling Mask"></a>Culling Mask</h4><p>Culling Mask:包含或省略要由相机呈现的对象层。在检查器中将图层分配给您的对象。<br>Nothing:什么层都不剔除<br>Everything:什么层都剔除<br>Default:默认层剔除<br>TransparentFX:隐形层,系统不会渲染贴图和模型<br>Ignore Raycast:射线层剔除<br>Water:水层剔除<br>UI：UI层剔除</p>
<p>原理：<br>清除标记至少与渲染管线的两个步骤有关：深度测试和颜色混合。屏幕上每一个像素都至少有两个信息， <strong>颜色信息</strong> 和 <strong>深度信息</strong> ，当新的一帧的像素信息在屏幕呈现之前，先会将 <strong>上一帧的缓存信息清除</strong> 某些部分（或者不清除任何信息），然后和 <strong>剩下的信息做深度测试和颜色混合得到最终结果</strong> （还有其他步骤，这里只讨论着两个），把结果放在帧缓存区并显示在屏幕上。</p>
<p>深入理解见：<a href="https://blog.csdn.net/mingyi2106/article/details/81606959" target="_blank" rel="noopener">https://blog.csdn.net/mingyi2106/article/details/81606959</a></p>
<h4 id="Projection"><a href="#Projection" class="headerlink" title="Projection"></a>Projection</h4><p>切换相机的功能来模拟透视。</p>
<p>Perspective(透视): 相机将完整地呈现透视物体。拍摄角度为0-180°（最高）<br>透视模式下，有远小近大的效果。呈现3D效果<br><strong>Field of View</strong> : 设置为“透视”时，“相机”的视口大小。</p>
<p>Orthographic(正交): 相机将统一渲染对象，没有视角。注：正交模式下不支持延迟渲染。正向渲染总是被使用。<br>物体在视口的代销只与正交视口的大小有关，与摄像机到物体的距离无关，主要呈现2D效果。<br><strong>Size</strong> :设置为“正交”时，“相机”的视口大小。</p>
<p>orthographic :摄像机投影模式。若值为true,正交模式，反之投影模式。</p>
<h4 id="Clipping-Planes"><a href="#Clipping-Planes" class="headerlink" title="Clipping Planes"></a>Clipping Planes</h4><p>剪切平面，从相机到开始和停止渲染的距离。<br>Near ：相对于相机的最近点将出现绘图。<br>Far ：相对于相机的最远点将出现绘图。</p>
<h4 id="ViewportRect"><a href="#ViewportRect" class="headerlink" title="ViewportRect"></a>ViewportRect</h4><p>视口矩形 四个值指示屏幕上的相机视图将被绘制的位置。在视口坐标中测量（值为0-1）。</p>
<h4 id="Depth"><a href="#Depth" class="headerlink" title="Depth"></a>Depth</h4><p>相机的位置按照画图顺序。具有较大值的相机将被绘制在具有较小值的相机之上。</p>
<h4 id="Rendering-Path"><a href="#Rendering-Path" class="headerlink" title="Rendering Path"></a>Rendering Path</h4><p>渲染路径 ：定义什么绘制方法被用于相机的选项<br>Use Graphics Settings 使用玩家设置：在玩家设置（Player Settings.）相机使用哪个渲染路径。<br>Forward 用正向光照渲染：所有对象每材质渲染只渲染一次,快速渲染。基于着色器的渲染路径。支持逐像素计算光照（包括法线贴图和灯光Cookies）和来自一个平行光的实时阴影。<br>Deferred 延迟照明：所有物体将在无光照的环境渲染一次，然后在渲染队列尾部将物体的光照一起渲染出来。支持实时阴影，计算消耗大，对硬件要求高，不支持移动设备，仅专业版可用。<br>Legacy Vertex Lit :使用顶点光照。最低消耗的渲染路径，不支持实时阴影，适用于移动及老式设备。<br>Legacy Deferred : 旧的延迟光照 </p>
<h4 id="Target-Texture"><a href="#Target-Texture" class="headerlink" title="Target Texture"></a>Target Texture</h4><p>目标纹理:渲染纹理 （Render Texture）包含相机视图输出。这会使相机渲染在屏幕上的能力被禁止。可用于实现画中画或者画面特效。</p>
<h4 id="Occlusion-Culling（遮挡剔除）"><a href="#Occlusion-Culling（遮挡剔除）" class="headerlink" title="Occlusion Culling（遮挡剔除）"></a>Occlusion Culling（遮挡剔除）</h4><p>是否剔除物体背向摄像机的部分</p>
<h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><ul>
<li><p>Allow HDR:高动态光照渲染，启动相机高动态范围渲染功能。让场景更真实。</p>
</li>
<li><p>Allow MSAA: 这台相机应该使用MSAA渲染目标吗？如果当前质量设置MSAA级别支持，将只使用MSAA。</p>
</li>
<li><p>Allow Dynamic Resolution：动态分辨率缩放。<br>如果相机使用动态分辨率渲染，则为true，否则为false。即使此属性为true，动态分辨率也只能在当前图形设备支持的情况下使用。</p>
</li>
<li><p>Target Display:设置此摄像机的目标显示。<br>此设置使摄像机呈现在指定的显示中。显示器（例如监视器）支持的最大数目是8. </p>
</li>
</ul>
<h3 id="属性（Inspector不可见）"><a href="#属性（Inspector不可见）" class="headerlink" title="属性（Inspector不可见）"></a>属性（Inspector不可见）</h3><h4 id="aspect-：Camera视口的宽高比（可获取，可设置）"><a href="#aspect-：Camera视口的宽高比（可获取，可设置）" class="headerlink" title="aspect ：Camera视口的宽高比（可获取，可设置）"></a>aspect ：Camera视口的宽高比（可获取，可设置）</h4><p>获取或者设置Camera视口的宽高比例值。例如：camera.aspect =2.0f,则视口的宽度、高度 = 2.0f，当硬件显示器屏幕的宽度与高度比例不为2.0f时,视图的显示将会发生变形。aspect只处理摄像机camera可以看到的视图的宽高比例，而硬件显示屏的作用只是把摄像机camera看到的内容显示出来，当硬件显示屏的宽高比例与aspect的比例值不同时，视图将发生变形。</p>
<h4 id="pixelRect"><a href="#pixelRect" class="headerlink" title="pixelRect"></a>pixelRect</h4><p>设置Camera被渲染到屏幕中的坐标位置。以实际像素大小来设置显示视口的位置。如下图：A为原始平面大小，B为变换后的视口大小，则X0的值为视口右移的像素大小，Y0的值为视口上移的像素大小，w为Camera.pixelWidth,h的值为Camera.pixelHeight。这里要注意：Screen.width和Screen.height为模拟硬件屏幕的宽高值，不随Camera.pixelWidth和Camera.pixelHeight的改变而改变。</p>
<pre><code class="lang-csharp">
public class PixelRect : MonoBehaviour

{ 

int which_change = -1; 

float temp_x = 0.0f, temp_y = 0.0f; 

void Update()

{ 

//Screen.width和Screen.height为模拟硬件屏幕的宽高值,

//其返回值不随camera.pixelWidth和camera.pixelHeight的改变而改变

Debug.Log(&quot;Screen.width:&quot; \+ Screen.width); 

Debug.Log(&quot;Screen.height:&quot; \+ Screen.height); 

Debug.Log(&quot;pixelWidth:&quot; \+ Camera.main.pixelWidth); 

Debug.Log(&quot;pixelHeight:&quot; \+ Camera.main.pixelHeight); 

//通过改变Camera的坐标位置而改变视口的区间

if (which_change == 0) 

{ 

if (Camera.main.pixelWidth &gt; 1.0f) 

{ 

temp_x += Time.deltaTime * 20.0f; 

} 

//取消以下注释察看平移状况

//if (Camera.main.pixelHeight &gt; 1.0f)

//{

// temp_y += Time.deltaTime * 20.0f;

//}

Camera.main.pixelRect = new Rect(temp_x, temp_y, Camera.main.pixelWidth, Camera.main.pixelHeight); 

} 

//通过改变Camera的视口宽度和高度来改变视口的区间

else if (which_change == 1)

{ 

if (Camera.main.pixelWidth &gt; 1.0f) 

{ 

temp_x = Camera.main.pixelWidth - Time.deltaTime * 20.0f; 

} 

//取消以下注释察看平移状况

//if (camera.pixelHeight &gt; 1.0f)

//{

// temp_y = camera.pixelHeight - Time.deltaTime * 20.0f;

//}

Camera.main.pixelRect = new Rect(0, 0, temp_x, temp_y); 

} 

} 

void OnGUI()

{ 

if (GUI.Button(new Rect(10.0f, 10.0f, 200.0f, 45.0f), &quot;视口改变方式1&quot;)) 

{ 

Camera.main.rect = new Rect(0.0f, 0.0f, 1.0f, 1.0f); 

which_change = 0; 

temp_x = 0.0f; 

temp_y = 0.0f; 

} 

if (GUI.Button(new Rect(10.0f, 60.0f, 200.0f, 45.0f), &quot;视口改变方式2&quot;)) 

{ 

Camera.main.rect = new Rect(0.0f, 0.0f, 1.0f, 1.0f); 

which_change = 1; 

temp_x = 0.0f; 

temp_y = Camera.main.pixelHeight; 

} 

if (GUI.Button(new Rect(10.0f, 110.0f, 200.0f, 45.0f), &quot;视口还原&quot;)) 

{ 

Camera.main.rect = new Rect(0.0f, 0.0f, 1.0f, 1.0f); 

which_change = -1; 

} 

} 

}
</code></pre>
<h3 id="实用案例"><a href="#实用案例" class="headerlink" title="实用案例"></a>实用案例</h3><h4 id="cameraToWorldMatrix-变换矩阵"><a href="#cameraToWorldMatrix-变换矩阵" class="headerlink" title="cameraToWorldMatrix : 变换矩阵"></a>cameraToWorldMatrix : 变换矩阵</h4><pre><code class="lang-csharp">
using UnityEngine; 

public class cameratoworldmatrix : MonoBehaviour { 

// Use this for initialization

void Start () { 

Debug.Log(&quot;Camera旋转前位置&quot; \+ transform.position); 

Matrix4x4 m = Camera.main.cameraToWorldMatrix; 

// 向量的位置转换为世界坐标中的位置

//v3 的值为沿着Camera局部坐标系的-z轴方向前移5个单位的位置在世界坐标系中的位置

Vector3 v3 = m.MultiplyPoint(Vector3.forward * 5.0f); 

//v4 的值为沿着Camera世界坐标系的-z轴方向前移5个单位的位置在世界坐标系中的位置

Vector3 v4 = m.MultiplyPoint(transform.forward * 5.0f); 

Debug.Log(&quot;旋转前，V3坐标值：&quot;+v3); 

Debug.Log(&quot;旋转前，V4坐标值：&quot;+v4); 

// 将摄像机沿着Y轴正向旋转90度（此时摄像机局部坐标系的z轴方向和世界坐标的X轴方向一致），

transform.Rotate(Vector3.up * 90f); 

m = Camera.main.cameraToWorldMatrix; 

v3 = m.MultiplyPoint(Vector3.forward * 5.0f); 

v4 = m.MultiplyPoint(transform.forward * 5.0f); 

Debug.Log(&quot;旋转后， v3坐标值&quot;+v3); 

Debug.Log(&quot;旋转后， v4坐标值&quot;+v4); 

} 

}
</code></pre>
<h4 id="CullingMask设置"><a href="#CullingMask设置" class="headerlink" title="CullingMask设置"></a>CullingMask设置</h4><p>CullingMask 按层渲染，此属性用于按层（GameObject.layer）有选择性地渲染场景中的物体。通过cullingMask可以使得当前摄像机有选择性地渲染场景中的部分物体，默认cullingMask =-1即渲染场景中的任何物体，cullingMask = 0时不渲染场景中的任何物体。若只渲染2,3,4，可以使用cullingMask = （1&lt;&lt;2）+ (1&lt;&lt;3)+(1&lt;&lt;4)来进行。</p>
<h4 id="eventMask属性（待研究）"><a href="#eventMask属性（待研究）" class="headerlink" title="eventMask属性（待研究）"></a>eventMask属性（待研究）</h4><p>按层响应事件，选择哪个层（layer）的物体可以响应鼠标事件</p>
<p>必须满足两个条件：</p>
<ol>
<li><p>物体在摄像机的视野范围内。</p>
</li>
<li><p>在2的layer次方的值与eventMask进行运算（&amp;）后结果仍为2的layer次方的值，如：defalult ,layer值为0，2的0次方=1，如果1与eventMask进行与运算后扔为1，则此物体响应鼠标事件。由于EventMask为奇数时，与1的与运算结果都为1，所以若物体层为defalut并且eventMask为奇数时物体会响应鼠标事件。</p>
</li>
</ol>
<p>如果想要多个不同层的物体响应鼠标事件，则需要把所有层的2的layer次方值相加，再与eventMask做与运算。例如，2个物体，layer值分贝为1,3，当event与9进行与运算后结果仍为9，则这两个物体都会响应鼠标事件。</p>
<p>此属性有一个特殊情况，但固体layer选择IgnoreRaycast(其为系统内置，值为2)时，无论EventMask值为多少，物体都无法响应鼠标事件。</p>
<pre><code class="lang-csharp">
using UnityEngine; 

using System.Collections; 

public class EventMask_ts : MonoBehaviour

{ 

bool is_rotate = false;//控制物体旋转

public Camera c;//指向场景中摄像机

//记录摄像机的eventMask值，可以在程序运行时在Inspector面板中修改其值的大小

public int eventMask_now = -1; 

//记录当前物体的层

int layer_now; 

int layerTemp;//记录2的layer次方的值

int ad;//记录与运算（&amp;）的结果

string str = null; 

void Update()

{ 

//记录当前对象的层，可以在程序运行时在Inspector面板中选择不同的层

layer_now = gameObject.layer; 

//求2的layer_now次方的值

layerTemp= (int)Mathf.Pow(2.0f, layer_now); 

//与运算（&amp;）

ad = eventMask_now &amp; layerTemp; 

c.eventMask = eventMask_now; 

//当is_rotate为true时旋转物体

if (is_rotate) 

{ 

transform.Rotate(Vector3.up * 15.0f * Time.deltaTime); 

} 

} 

//当鼠标左键按下时，物体开始旋转

void OnMouseDown()

{ 

is_rotate = true; 

} 

//当鼠标左键抬起时，物体结束旋转

void OnMouseUp()

{ 

is_rotate = false; 

} 

void OnGUI()

{ 

GUI.Label(new Rect(10.0f, 10.0f, 300.0f, 45.0f), &quot;当前对象的layer值为：&quot; \+ layer_now + &quot; , 2的layer次方的值为&quot; \+ layerTemp); 

GUI.Label(new Rect(10.0f, 60.0f, 300.0f, 45.0f), &quot;当前摄像机eventMask的值为：&quot; \+ eventMask_now); 

GUI.Label(new Rect(10.0f, 110.0f, 500.0f, 45.0f), &quot;根据算法，当eventMask的值与&quot; \+ layerTemp+ &quot;进行与运算（&amp;）后， 若结果为&quot; \+ tp + &quot;，则物体相应OnMousexxx方法，否则不响应！&quot;); 

if (ad == tp) 

{ 

str = &quot; ,所以物体会相应OnMouseDown方法！&quot;; 

} 

else

{ 

str = &quot; ,所以物体不会相应OnMouseDown方法！&quot;; 

} 

GUI.Label(new Rect(10.0f, 160.0f, 500.0f, 45.0f), &quot;而当前eventMask与&quot; \+ layerTemp+ &quot;进行与运算（&amp;）的结果为&quot; \+ ad + str); 

} 

}
</code></pre>
<h4 id="LayerCullDistances-层消隐的距离"><a href="#LayerCullDistances-层消隐的距离" class="headerlink" title="LayerCullDistances:层消隐的距离"></a>LayerCullDistances:层消隐的距离</h4><p>摄像机可以通过基于层（GameObject.layer）的方式来设置不同层物体的消隐距离，但这个距离必须小于或者等于摄像机的farClipPlane才有效。</p>
<h4 id="layerCullSpherical-基于球面距离剔除"><a href="#layerCullSpherical-基于球面距离剔除" class="headerlink" title="layerCullSpherical:基于球面距离剔除"></a>layerCullSpherical:基于球面距离剔除</h4><p>基于球面距离的剔除方式。属性默认为false，即不使用球面剔除，表示只要有一点没有超出物体所在层的远视口平面，物体就是可见的。当设置此属性为True时，只要物体的世界坐标点Position与摄像机的距离大于所在层的剔除距离，物体就不可见。</p>
<h4 id="Shader相关"><a href="#Shader相关" class="headerlink" title="Shader相关"></a>Shader相关</h4><ul>
<li><p>RenderWithShader:使用其他shader渲染<br>使用指定shader来代替当前物体的shader渲染一帧。当replacementTag为空时会替换视口中所有物体的shader</p>
</li>
<li><p>SetReplacementShader 使用指定的shader来替换物体当前的shader,被替换后每一帧都会替换shader来渲染物体,与上面的方法刚好不同。</p>
</li>
</ul>
<pre><code class="lang-csharp">
public class RenderWithShader : MonoBehaviour

{ 

bool is_use = false; 

void OnGUI()

{ 

if (is_use) 

{ 

//使用高光shader：Specular来渲染Camera

Camera.main.RenderWithShader(Shader.Find(&quot;Specular&quot;), &quot;RenderType&quot;); 

} 

if (GUI.Button(new Rect(10.0f, 10.0f, 300.0f, 45.0f), &quot;使用RenderWithShader启用高光&quot;)) 

{ 

//RenderWithShader每调用一次只渲染一帧，所以不可将其直接放到这儿

//camera.RenderWithShader(Shader.Find(&quot;Specular&quot;), &quot;RenderType&quot;);

is_use = true; 

} 

if (GUI.Button(new Rect(10.0f, 60.0f, 300.0f, 45.0f), &quot;使用SetReplacementShader启用高光&quot;)) 

{ 

//SetReplacementShader方法用来替换已有shader，调用一次即可

Camera.main.SetReplacementShader(Shader.Find(&quot;Specular&quot;), &quot;RenderType&quot;); 

is_use = false; 

} 

if (GUI.Button(new Rect(10.0f, 110.0f, 300.0f, 45.0f), &quot;关闭高光&quot;)) 

{ 

Camera.main.ResetReplacementShader(); 

is_use = false; 

} 

} 

}
</code></pre>
<h4 id="更多"><a href="#更多" class="headerlink" title="更多"></a>更多</h4><p>见：<a href="https://www.jianshu.com/p/547ef7f4a313" target="_blank" rel="noopener">https://www.jianshu.com/p/547ef7f4a313</a></p>
<h2 id="编辑器模式下修改屏幕分辨率"><a href="#编辑器模式下修改屏幕分辨率" class="headerlink" title="编辑器模式下修改屏幕分辨率"></a>编辑器模式下修改屏幕分辨率</h2><pre><code class="lang-csharp">
#if UNITY_EDITOR

using System; 

using System.Reflection; 

using UnityEditor; 

using UnityEngine; 

public static class GameViewUtils

{ 

static object gameViewSizesInstance; 

static MethodInfo getGroup; 

static GameViewUtils()

{ 

// gameViewSizesInstance = ScriptableSingleton&lt;GameViewSizes&gt;.instance;

var sizesType = typeof(Editor).Assembly.GetType(&quot;UnityEditor.GameViewSizes&quot;); 

var singleType = typeof(ScriptableSingleton&lt;&gt;).MakeGenericType(sizesType); 

var instanceProp = singleType.GetProperty(&quot;instance&quot;); 

getGroup = sizesType.GetMethod(&quot;GetGroup&quot;); 

gameViewSizesInstance = instanceProp.GetValue(null, null); 

} 

public enum GameViewSizeType 

{ 

AspectRatio, FixedResolution 

} 

[MenuItem(&quot;Test/AddSize&quot;)] 

public static void AddTestSize()

{ 

AddCustomSize(GameViewSizeType.AspectRatio, GameViewSizeGroupType.Standalone, 123, 456, &quot;Test size&quot;); 

} 

[MenuItem(&quot;Test/SizeTextQuery&quot;)] 

public static void SizeTextQueryTest()

{ 

Debug.Log(SizeExists(GameViewSizeGroupType.Standalone, &quot;Test size&quot;)); 

} 

[MenuItem(&quot;Test/Query16:9Test&quot;)] 

public static void WidescreenQueryTest()

{ 

Debug.Log(SizeExists(GameViewSizeGroupType.Standalone, &quot;16:9&quot;)); 

} 

[MenuItem(&quot;Test/Set16:9&quot;)] 

public static void SetWidescreenTest()

{ 

SetSize(FindSize(GameViewSizeGroupType.Standalone, &quot;16:9&quot;)); 

} 

[MenuItem(&quot;Test/SetTestSize&quot;)] 

public static void SetTestSize()

{ 

int idx = FindSize(GameViewSizeGroupType.Standalone, 123, 456); 

if (idx != -1) 

SetSize(idx); 

} 

public static void SetSize(int index)

{ 

var gvWndType = typeof(Editor).Assembly.GetType(&quot;UnityEditor.GameView&quot;); 

var selectedSizeIndexProp = gvWndType.GetProperty(&quot;selectedSizeIndex&quot;, 

BindingFlags.Instance | BindingFlags.Public | BindingFlags.NonPublic); 

var gvWnd = EditorWindow.GetWindow(gvWndType); 

selectedSizeIndexProp.SetValue(gvWnd, index, null); 

} 

[MenuItem(&quot;Test/SizeDimensionsQuery&quot;)] 

public static void SizeDimensionsQueryTest()

{ 

Debug.Log(SizeExists(GameViewSizeGroupType.Standalone, 123, 456)); 

} 

public static void AddCustomSize(GameViewSizeType viewSizeType, GameViewSizeGroupType sizeGroupType, int width, int height, string text)

{ 

// GameViewSizes group = gameViewSizesInstance.GetGroup(sizeGroupTyge);

// group.AddCustomSize(new GameViewSize(viewSizeType, width, height, text);

var group = GetGroup(sizeGroupType); 

var addCustomSize = getGroup.ReturnType.GetMethod(&quot;AddCustomSize&quot;); // or group.GetType().

var gvsType = typeof(Editor).Assembly.GetType(&quot;UnityEditor.GameViewSize&quot;); 

var ctor = gvsType.GetConstructor(new Type[] { typeof(int), typeof(int), typeof(int), typeof(string) }); 

var newSize = ctor.Invoke(new object[] { (int)viewSizeType, width, height, text }); 

addCustomSize.Invoke(group, new object[] { newSize }); 

} 

public static bool SizeExists(GameViewSizeGroupType sizeGroupType, string text)

{ 

return FindSize(sizeGroupType, text) != -1; 

} 

public static int FindSize(GameViewSizeGroupType sizeGroupType, string text)

{ 

// GameViewSizes group = gameViewSizesInstance.GetGroup(sizeGroupType);

// string[] texts = group.GetDisplayTexts();

// for loop...

var group = GetGroup(sizeGroupType); 

var getDisplayTexts = group.GetType().GetMethod(&quot;GetDisplayTexts&quot;); 

var displayTexts = getDisplayTexts.Invoke(group, null) as string[]; 

for (int i = 0; i &lt; displayTexts.Length; i++) 

{ 

string display = displayTexts[i]; 

// the text we get is &quot;Name (W:H)&quot; if the size has a name, or just &quot;W:H&quot; e.g. 16:9

// so if we&#39;re querying a custom size text we substring to only get the name

// You could see the outputs by just logging

// Debug.Log(display);

int pren = display.IndexOf(&#39;(&#39;); 

if (pren != -1) 

display = display.Substring(0, pren - 1); // -1 to remove the space that&#39;s before the prens. This is very implementation-depdenent

if (display == text) 

return i; 

} 

return -1; 

} 

public static bool SizeExists(GameViewSizeGroupType sizeGroupType, int width, int height)

{ 

return FindSize(sizeGroupType, width, height) != -1; 

} 

public static int FindSize(GameViewSizeGroupType sizeGroupType, int width, int height)

{ 

// goal:

// GameViewSizes group = gameViewSizesInstance.GetGroup(sizeGroupType);

// int sizesCount = group.GetBuiltinCount() + group.GetCustomCount();

// iterate through the sizes via group.GetGameViewSize(int index)

var group = GetGroup(sizeGroupType); 

var groupType = group.GetType(); 

var getBuiltinCount = groupType.GetMethod(&quot;GetBuiltinCount&quot;); 

var getCustomCount = groupType.GetMethod(&quot;GetCustomCount&quot;); 

int sizesCount = (int)getBuiltinCount.Invoke(group, null) + (int)getCustomCount.Invoke(group, null); 

var getGameViewSize = groupType.GetMethod(&quot;GetGameViewSize&quot;); 

var gvsType = getGameViewSize.ReturnType; 

var widthProp = gvsType.GetProperty(&quot;width&quot;); 

var heightProp = gvsType.GetProperty(&quot;height&quot;); 

var indexValue = new object[1]; 

for (int i = 0; i &lt; sizesCount; i++) 

{ 

indexValue[0] = i; 

var size = getGameViewSize.Invoke(group, indexValue); 

int sizeWidth = (int)widthProp.GetValue(size, null); 

int sizeHeight = (int)heightProp.GetValue(size, null); 

if (sizeWidth == width &amp;&amp; sizeHeight == height) 

return i; 

} 

return -1; 

} 

static object GetGroup(GameViewSizeGroupType type)

{ 

return getGroup.Invoke(gameViewSizesInstance, new object[] { (int)type }); 

} 

//[MenuItem(&quot;Test/LogCurrentGroupType&quot;)]

//public static void LogCurrentGroupType()

//{

// Debug.Log(GetCurrentGroupType());

//}

public static GameViewSizeGroupType GetCurrentGroupType()

{ 

var getCurrentGroupTypeProp = gameViewSizesInstance.GetType().GetProperty(&quot;currentGroupType&quot;); 

return (GameViewSizeGroupType)(int)getCurrentGroupTypeProp.GetValue(gameViewSizesInstance, null); 

} 

public static void switchOrientation()

{ 

int width = Screen.height; 

int height = Screen.width; 

int index = FindSize(GetCurrentGroupType(), width, height); 

if (index == -1) 

{ 

AddCustomSize(GameViewSizeType.FixedResolution, GetCurrentGroupType(), width, height, &quot;&quot;); 

index = FindSize(GetCurrentGroupType(), width, height); 

} 

if (index != -1) 

{ 

SetSize(index); 

} 

else

{ 

Debug.LogError(&quot;switchOrientation failed, can not find or add resoulution for &quot; \+ width.ToString() + &quot;*&quot; \+ height.ToString()); 

} 

} 

} 

#endif
</code></pre>
<h2 id="屏幕比例与摄像机设置"><a href="#屏幕比例与摄像机设置" class="headerlink" title="屏幕比例与摄像机设置"></a>屏幕比例与摄像机设置</h2><h3 id="宽高比（aspect）"><a href="#宽高比（aspect）" class="headerlink" title="宽高比（aspect）"></a>宽高比（aspect）</h3><p>Screen.witdh和Screen.heigh表示模拟硬件设备的宽高值，不受camera等相关组件在软件层面的代码影响。<br>Unity在Screen界面可以设置Screen的比例和像素，但是没有提供相应的接口用代码设置屏幕比例，因为硬件的屏幕就是不可设置的。</p>
<p><strong>aspect</strong> ：获取和设置屏幕的 <strong>宽高比</strong> 。</p>
<p>Viewport Rect：视口框。指的是在Screen上，显示图像的方框。X、Y为偏移值，W、H为实际视口宽/高与Screen宽/高的比例值。</p>
<p>aspect默认和screen的宽高比保持一致，摄像机渲染的图像填满screen。<br>当Viewport Rect宽高比发生变化时，aspect与之保持一致。<br>即默认情况下，aspect是由屏幕的宽高比以及Viewport Rect一起决定的。</p>
<p>当在脚本中手动更改aspect的值时，aspect的值即为手动设置的值，相机的宽高比也就是人手动设置的。</p>
<p>此时，Viewport宽高比不变，相机会把自己的视口当中的图像渲染到Viewport当中，由于宽高比不一致会导致变形。</p>
<h3 id="可见区域形状"><a href="#可见区域形状" class="headerlink" title="可见区域形状"></a>可见区域形状</h3><h4 id="Perspective"><a href="#Perspective" class="headerlink" title="Perspective"></a>Perspective</h4><p>透视视图下，可见区域是一个四棱台。<br>Aspect决定了宽高比，即棱台上下底、截面的宽高比。<br>Field of View：相机视野角度，由FOV Axis确定的轴向上的角度值(degree)</p>
<blockquote>
<p>宽高比决定了，改变Field of View，视口截面的形状会成比例缩放。从角度的层面来看，棱台的侧棱与高之间的夹角随FoV的变大而变大，直观来看，就是视角的放大与缩小。<br> （调整Screen或Viewport或aspect，只能改变相机视口的宽度，不能改变高度，就是因为Field of View把高度值定死了）<br> Clipping Planes：剪裁面片，指的是可视区域棱台的上下底面 距离camera坐标点的位置（近截面和远截面）</p>
</blockquote>
<p>以上所有参数，共同决定了camera可见范围的形状以及它与屏幕渲染的图像的关系。</p>
<blockquote>
<p><strong>aspect值在代码中设置过一次，就会固定。如果没有设置过，就默认与Screen宽高比一致。</strong></p>
</blockquote>
<h4 id="Orthographic"><a href="#Orthographic" class="headerlink" title="Orthographic"></a>Orthographic</h4><p>较容易理解。size参数相当于Perspective模式下的FoV。</p>
<p>摄像机高度 = 摄像机orthographicSize <em> 2<br>摄像机实际宽度 = 摄像机高度 </em> 屏幕宽高比<br>摄像机实际宽度 = 摄像机orthographicSize <em> 2 </em> 屏幕宽高比</p>
<h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="https://www.cnblogs.com/unity-carry/p/9512662.html" target="_blank" rel="noopener">https://www.cnblogs.com/unity-carry/p/9512662.html</a><br><a href="https://www.jianshu.com/p/547ef7f4a313" target="_blank" rel="noopener">https://www.jianshu.com/p/547ef7f4a313</a><br><a href="https://www.jianshu.com/p/95cb4621206e" target="_blank" rel="noopener">https://www.jianshu.com/p/95cb4621206e</a></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/" rel="tag">Unity3D</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-Unity3D-CSharp调用Java-与Android交互"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2023/07/25/Unity3D-CSharp%E8%B0%83%E7%94%A8Java-%E4%B8%8EAndroid%E4%BA%A4%E4%BA%92/"
    >CSharp调用Java&amp;与Android交互</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2023/07/25/Unity3D-CSharp%E8%B0%83%E7%94%A8Java-%E4%B8%8EAndroid%E4%BA%A4%E4%BA%92/" class="article-date">
  <time datetime="2023-07-25T12:56:23.239Z" itemprop="datePublished">2023-07-25</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Unity3D/">Unity3D</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="Heading"><a href="#Heading" class="headerlink" title="Heading"></a>Heading</h2><p><a href="https://www.jb51.net/article/134135.htm" target="_blank" rel="noopener">https://www.jb51.net/article/134135.htm</a><br><a href="https://blog.csdn.net/m0_38096376/article/details/69567409" target="_blank" rel="noopener">https://blog.csdn.net/m0_38096376/article/details/69567409</a><br><a href="https://www.jianshu.com/p/b5e3cfcdf081" target="_blank" rel="noopener">https://www.jianshu.com/p/b5e3cfcdf081</a><br><a href="https://www.cnblogs.com/wufeng0927/p/5178216.html" target="_blank" rel="noopener">https://www.cnblogs.com/wufeng0927/p/5178216.html</a></p>
<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><pre><code class="lang-csharp">
using UnityEngine; 

public class NewBehaviourScript : MonoBehaviour

{ 

float e = 0; 

private void OnGUI()

{ 

GUILayout.Label(string.Format($&quot;&lt;size=80&gt;电池总容量{Power.capacity}毫安,电压{Power.voltage}伏&lt;/size&gt;&quot;)); 

GUILayout.Label(string.Format($&quot;&lt;size=80&gt;实时电流{e}毫安,实时功率{(int)(e * Power.voltage)},满电量能玩{((Power.capacity /e).ToString(&quot;f2&quot;))}小时&lt;/size&gt;&quot;)); 

} 

float t = 0f; 

private void Update()

{ 

if(Time.time - t &gt; 1f) 

{ 

t = Time.time; 

e = Power.electricity; 

} 

} 

} 

public class Power

{ 

static public float electricity 

{ 

get { 

#if UNITY_ANDROID

//获取电流（微安），避免频繁获取，取一次大概2毫秒

float electricity = (float)manager.Call&lt;int&gt;(&quot;getIntProperty&quot;, PARAM_BATTERY); 

//小于1W就认为它的单位是毫安，否则认为是微安

return ToMA(electricity); 

#else

return -1f; 

#endif

} 

} 

//获取电压 伏

static public float voltage { get; private set; } 

//获取电池总容量 毫安

static public int capacity { get; private set; } 

//获取实时电流参数

static object[] PARAM_BATTERY = new object[] { 2 }; //BatteryManager.BATTERY_PROPERTY_CURRENT_NOW)

static AndroidJavaObject manager; 

static Power()

{ 

#if UNITY_ANDROID

AndroidJavaClass unityPlayer = new AndroidJavaClass(&quot;com.unity3d.player.UnityPlayer&quot;); 

AndroidJavaObject currActivity = unityPlayer.GetStatic&lt;AndroidJavaObject&gt;(&quot;currentActivity&quot;); 

manager = currActivity.Call&lt;AndroidJavaObject&gt;(&quot;getSystemService&quot;, new object[] { &quot;batterymanager&quot; }); 

capacity = (int)(ToMA((float)manager.Call&lt;int&gt;(&quot;getIntProperty&quot;, new object[] { 1 })) / ((float)manager.Call&lt;int&gt;(&quot;getIntProperty&quot;, new object[] { 4 })/100f)); //BATTERY_PROPERTY_CHARGE_COUNTER 1 BATTERY_PROPERTY_CAPACITY 4

AndroidJavaObject receive = currActivity.Call&lt;AndroidJavaObject&gt;(&quot;registerReceiver&quot;, new object[] { null,new AndroidJavaObject(&quot;android.content.IntentFilter&quot;, new object[] { &quot;android.intent.action.BATTERY_CHANGED&quot; }) }); 

if (receive != null) 

{ 

voltage = (float)receive.Call&lt;int&gt;(&quot;getIntExtra&quot;, new object[] { &quot;voltage&quot;,0 })/1000f; //BatteryManager.EXTRA_VOLTAGE

} 

#endif

} 

static float ToMA(float maOrua)

{ 

return maOrua &lt; 10000 ? maOrua : maOrua / 1000f; 

} 

}
</code></pre>
<h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="https://www.xuanyusong.com/archives/4753" target="_blank" rel="noopener">https://www.xuanyusong.com/archives/4753</a></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/" rel="tag">Unity3D</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-Unity3D-Atlas-图集"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2023/07/25/Unity3D-Atlas-%E5%9B%BE%E9%9B%86/"
    >Atlas(图集)</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2023/07/25/Unity3D-Atlas-%E5%9B%BE%E9%9B%86/" class="article-date">
  <time datetime="2023-07-25T12:56:23.238Z" itemprop="datePublished">2023-07-25</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Unity3D/">Unity3D</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="Sprite的本质"><a href="#Sprite的本质" class="headerlink" title="Sprite的本质"></a>Sprite的本质</h2><p>原本的数据是图片，图片导入后，Sprite类型的设置以及Sprite的分割都是在ImportSettings当中设置的。而ImportSettings的信息就存储在.meta文件当中。因此，Sprite的本质就是meta文件当中存储的图集名称、ID及在原图片上的偏移量等信息。</p>
<h2 id="图集（Atlas）的本质"><a href="#图集（Atlas）的本质" class="headerlink" title="图集（Atlas）的本质"></a>图集（Atlas）的本质</h2><p>将Sprite集合设置为图集后，图集资源存储的就是Sprite索引的集合，在打包时，会将图集合并为Texture2D类型的资源放入包中，然后再放入各个Sprite的名称、ID以及在图集上的偏移量。</p>
<h3 id="图集的作用"><a href="#图集的作用" class="headerlink" title="图集的作用"></a>图集的作用</h3><ul>
<li><p>节省内存 - OpenGL载入纹理图片时，所用内存会自动扩张到2的N次方。如果图片大小为64<em>65，那么就会按照64</em>128载入。</p>
</li>
<li><p>减小包体 - 合成的大图会比之前所有的散图所占用的物理存储更小</p>
</li>
<li><p>提升载入速度 - 将很多小图拼接成一张大图，载入内存时一次载入，提高了载入速度。</p>
</li>
<li><p>DrawCall合批</p>
</li>
</ul>
<h2 id="Unity中的图集功能"><a href="#Unity中的图集功能" class="headerlink" title="Unity中的图集功能"></a>Unity中的图集功能</h2><blockquote>
<p>只有Sprite模式的图片才可以打包成图集</p>
</blockquote>
<p>旧版：<br>Sprite Mode 设置为 Muitiple 设置Packing Tag<br>Window-&gt;Sprite Packer –&gt;点击 Pack 即可</p>
<p>新版：<br>Project Setting -&gt; Editor -&gt; Sprite Packer -&gt; Mode = Always Enabled<br>新建 Sprite Atlas<br>选择打包图集的文件夹或者依次添加单独图片，点击Pack Preview后自动打包成一个图集</p>
<p>代码获取图集并动态选择Sprite：</p>
<pre><code class="lang-csharp">
using UnityEditor; 

using UnityEngine; 

using UnityEngine.U2D; 

using UnityEngine.UI; 

public class SpriteAtlasExample : MonoBehaviour

{ 

private void Awake()

{ 

SpriteAtlas atlas = AssetDatabase.LoadAssetAtPath&lt;SpriteAtlas&gt;(&quot;Assets/TestAtlas.spriteatlas&quot;); 

Sprite sprite = atlas.GetSprite(&quot;Icon2&quot;); 

if (sprite != null) 

{ 

GetComponent&lt;Image&gt;().sprite = sprite; 

} 

} 

}
</code></pre>
<h3 id="Late-Binding-technology"><a href="#Late-Binding-technology" class="headerlink" title="Late Binding technology"></a>Late Binding technology</h3><p>Include in Build - Unity includes the Sprite Atlases with the Project’s build and automatically loads them at the build’s run time. </p>
<p><img src="Atlas\(图集\" alt="Alt text"><br>_files/1618326776601.png)</p>
<h4 id="Preparing-Sprite-Atlases-for-distribution"><a href="#Preparing-Sprite-Atlases-for-distribution" class="headerlink" title="Preparing Sprite Atlases for distribution"></a>Preparing Sprite Atlases for distribution</h4><p>Disable ‘Include in Build’ - Unity does not include the disabled Sprite Atlas in the Project’s published build, and does not automatically load it at run time. </p>
<p>Methods：</p>
<ol>
<li><p>Place the Sprite Atlases into the build’s Resources folder.</p>
</li>
<li><p>Distribute them as downloadable AssetBundles.</p>
</li>
</ol>
<h4 id="Late-Binding"><a href="#Late-Binding" class="headerlink" title="Late Binding"></a>Late Binding</h4><p>the build does not automatically load a prepared Sprite Atlas at run time.</p>
<p>SpriteAtlasManager.atlasRequested - Trigger when any <strong>Sprite was bound to SpriteAtlas</strong> but <strong>couldn’t locate the atlas asset during runtime</strong>.</p>
<ul>
<li><p>如果图集勾选Include in Build，在打包时，图集本身就会被自动打入AB包当中，加载Prefab时，就会把图集加载进内存，也就不会触发atlasRequested </p>
</li>
<li><p>不勾选Include in Build，在打包时，图集不会自动进入prefab所在的AB包，也不会自动加载出来，触发atlasRequested事件后，在相应的回调函数当中加载图集，即可实现延迟绑定，图集加载出来之后即可显示。</p>
</li>
</ul>
<pre><code class="lang-csharp">
using UnityEngine; 

using UnityEngine.U2D; 

public class AtlasLoader : MonoBehaviour

{ 

void OnEnable()

{ 

SpriteAtlasManager.atlasRequested += RequestAtlas; 

} 

void OnDisable()

{ 

SpriteAtlasManager.atlasRequested -= RequestAtlas; 

} 

void RequestAtlas(string tag, System.Action&lt;SpriteAtlas&gt; callback)

{ 

var sa = Resources.Load&lt;SpriteAtlas&gt;(tag); 

callback(sa); 

} 

} 

``` ```csharp 

void RequestAtlas(string tag, System.Action&lt;SpriteAtlas&gt; callback)

{ 

Debug.LogError(&quot;RequestAtlas:&quot; \+ tag); 

string abPath = Application.streamingAssetsPath + &quot;/&quot; \+ tag.ToLower(); 

AssetBundle ab = AssetBundle.LoadFromFile(abPath); 

SpriteAtlas sa = ab.LoadAsset&lt;SpriteAtlas&gt;(tag); 

callback(sa); 

}
</code></pre>
<h2 id="Texture-Packer"><a href="#Texture-Packer" class="headerlink" title="Texture Packer"></a>Texture Packer</h2><h3 id="Texture-Packer的图集-vs-Unity-Atlas的区别"><a href="#Texture-Packer的图集-vs-Unity-Atlas的区别" class="headerlink" title="Texture Packer的图集 vs. Unity Atlas的区别"></a>Texture Packer的图集 vs. Unity Atlas的区别</h3><p>Unity打图集时会将设置的一个sprite集合打入一张Texture2D当中，不会生成png、jpg等编码的图片格式，而在打包成AssetBundle后会生成一个Texture2D类型的资源。将合并后的Texture2D类型的资源以及各个图集的名称、ID、偏移量存储到包中。</p>
<hr>
<p>Texture Packer的基本使用：</p>
<p>Texture Packer会将图集合并成图片，生成一张合并后的PNG，并生成 <code>.tpsheet</code>文件（图集表），存储各个Sprite的名称以及偏移量。</p>
<p>在Unity中安装TexturePacker Importer插件后，将合并后的图集以及<code>.tpsheet</code>表格导入Unity后，插件会自动读取该信息，并根据该信息处理合并后的图片的ImportSettings，拆分Sprite，在Unity中还原TexturePacker中的设置。</p>
<h3 id="命令行使用"><a href="#命令行使用" class="headerlink" title="命令行使用"></a>命令行使用</h3><pre><code class="lang-csharp">
E:\04_DCC_Tools\CodeAndWeb\TexturePacker\bin\TexturePacker --data foo.tpsheet \--sheet foo.png ./ ChatSystemAtlas.tps \--no-trim --max-size 1024
</code></pre>
<p>其他相关参数：</p>
<pre><code class="lang-csharp">
–replace &lt;regexp&gt;=&lt;string&gt; # 使用&lt;string&gt;替换掉拼接图片的文件名中正则表达式匹配的字符串 

–texturepath &lt;path&gt; # 图片与tpsheet文件不再同一个目录时使用,不会改变out.png的目录 

–ignore-files &lt;regexp&gt;

–width/–height &lt;int&gt;

–allow-free-size # 允许输出图片不是2的幂,以最小尺寸输出 

–trim/no-trim # 剪裁图片,即移除图片周围的透明像素,保留原始尺寸,默认开启 

–crop # 与上面的一条类似,移除图片四周的透明像素,不保留原始尺寸,保存为一张更小的图片 

\--opt RGB444 # 设置输出图片的像素格式 一般默认RGBA8888
</code></pre>
<h3 id="更多用法"><a href="#更多用法" class="headerlink" title="更多用法"></a>更多用法</h3><p>见官网：<a href="https://www.codeandweb.com/texturepacker/unity" target="_blank" rel="noopener">https://www.codeandweb.com/texturepacker/unity</a></p>
<h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><p>图集的详细介绍：<a href="https://www.cnblogs.com/msxh/p/14194756.html" target="_blank" rel="noopener">https://www.cnblogs.com/msxh/p/14194756.html</a><br><a href="http://blog.justbilt.com/2013/12/12/use_tp_on_command_line/" target="_blank" rel="noopener">http://blog.justbilt.com/2013/12/12/use_tp_on_command_line/</a><br><a href="https://zhuanlan.zhihu.com/p/89332754" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/89332754</a></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/" rel="tag">Unity3D</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-Unity3D-Audio"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2023/07/25/Unity3D-Audio/"
    >Audio</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2023/07/25/Unity3D-Audio/" class="article-date">
  <time datetime="2023-07-25T12:56:23.238Z" itemprop="datePublished">2023-07-25</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Unity3D/">Unity3D</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><h3 id="Basic-Theory"><a href="#Basic-Theory" class="headerlink" title="Basic Theory"></a>Basic Theory</h3><p>To simulate the effects of position, Unity requires sounds to originate from Audio Sources<br>attached to objects. The sounds emitted are then picked up by an Audio Listener<br>attached to another object, most often the main camera. Unity can then simulate the effects of a source’s distance and position from the listener object and play them to the user accordingly. The relative speed of the source and listener objects can also be used to simulate the <strong>Doppler Effect(多普勒效应)</strong> for added realism.</p>
<h4 id="回声和混响"><a href="#回声和混响" class="headerlink" title="回声和混响"></a>回声和混响</h4><p>Unity can’t calculate echoes purely from scene geometry but you can simulate them by adding Audio Filters to objects. For example, you could apply the Echo filter to a sound that is supposed to be coming from inside a cave. In situations where objects can move in and out of a place with a strong echo, you can add a Reverb Zone to the scene. </p>
<h2 id="Assets"><a href="#Assets" class="headerlink" title="Assets"></a>Assets</h2><p>Unity supports <strong>mono</strong> , <strong>stereo</strong> and <strong>multichannel</strong> audio assets (up to eight channels).<br>Unity3D游戏引擎一共支持4个音乐格式的文件<br>.AIFF 适用于较短的音乐文件可用作游戏打斗音效<br>.WAV 适用于较短的音乐文件可用作游戏打斗音效<br>.MP3 适用于较长的音乐文件可用作游戏背景音乐<br>.OGG 适用于较长的音乐文件可用作游戏背景音乐</p>
<blockquote>
<p>Unity also supports tracker modules, which use short audio samples as “instruments” that are then arranged to play tunes. Tracker modules can be imported from .xm, .mod, .it, and .s3m files but are otherwise used in much the same way as ordinary audio clips.</p>
</blockquote>
<h2 id="Recording"><a href="#Recording" class="headerlink" title="Recording"></a>Recording</h2><p>Unity can access the computer’s microphones from a script and create Audio Clips by direct recording. The <strong>Microphone</strong> class provides a straightforward API to find available microphones, query their capabilities and start and end a recording session.</p>
<h1 id="Clip"><a href="#Clip" class="headerlink" title="Clip"></a>Clip</h1><h3 id="Load-Type"><a href="#Load-Type" class="headerlink" title="Load Type"></a>Load Type</h3><h4 id="Decompress-On-Load"><a href="#Decompress-On-Load" class="headerlink" title="Decompress On Load"></a>Decompress On Load</h4><p>Use this option for smaller compressed sounds to avoid the performance overhead of decompressing on the fly. Be aware that decompressing Vorbis-encoded sounds on load will use about <strong>ten times</strong> more memory than keeping them compressed (for ADPCM encoding it’s about 3.5 times), so don’t use this option for large files.</p>
<p>适用于 <strong>较小</strong> 的压缩声音，避免即时解压缩的性能开销。不要使用于大文件。</p>
<h4 id="Compressed-In-Memory"><a href="#Compressed-In-Memory" class="headerlink" title="Compressed In Memory"></a>Compressed In Memory</h4><p>Keep sounds compressed in memory and decompress while playing. This option has a slight <strong>performance overhead</strong> (especially for Ogg/Vorbis compressed files) so only use it for bigger files where decompression on load would use a prohibitive amount of memory.<br>播放时解压会有CPU开销（尤其是OGG / Vorbis格式的压缩文件），但可以提高加载速度并减少内存消 耗，因此这个选项适用于 <strong>大文件</strong> 。 </p>
<blockquote>
<p>The decompression is happening on the mixer thread and can be monitored in the “DSP CPU” section in the audio pane of the profiler window.</p>
</blockquote>
<h4 id="Streaming"><a href="#Streaming" class="headerlink" title="Streaming"></a>Streaming</h4><p>Decode sounds on the fly. This method uses a minimal amount of memory to buffer compressed data that is <strong>incrementally read from the disk and decoded on the fly.</strong></p>
<blockquote>
<p>Profiler中：“Streaming CPU” section in the audio pane of the profiler window.<br> Streaming clips has an overload of approximately 200KB, even if none of the audio data is loaded.</p>
</blockquote>
<p>直接从磁盘流音频数据。这只使用了原始声音占内存大小的很小一部分。 该方法使用最少的内存和最多的CPU，它有个很明显的缺点就是不能被引用超过一次。试着让 Audio Clip产生多个副本的时候会每个都产生数据缓冲区，如果非要这么做会产生大量的内存和cpu消耗。因此这个选择最好是给单实例的Audio Clip，如背景和环境音效。对于手游而言不要优先考虑使用这种方式。</p>
<h3 id="Compression-Format"><a href="#Compression-Format" class="headerlink" title="Compression Format"></a>Compression Format</h3><h4 id="PCM"><a href="#PCM" class="headerlink" title="PCM"></a>PCM</h4><p>全称是Pulse-Code Modulation。属于脉冲调制编码，它将模拟信号转换为数字信号，实质上没有经过编码，没有进行压缩，所以在音质上是属于完全无损的原始音频。而且相较于原生的模拟信号，它的抗干扰能力更强，保真效果更好。</p>
<p>This option offers higher quality at the expense of larger file size and is best for very short sound effects.</p>
<h4 id="ADPCM"><a href="#ADPCM" class="headerlink" title="ADPCM"></a>ADPCM</h4><p>Adaptive Differential Pulse Code Modulation，自适应差分脉冲编码调制。是一种基于PCM的优化压缩方式，但也属于有损压缩。<br>This format is useful for sounds that contain a fair bit of noise and need to be played in large quantities, such as footsteps, impacts, weapons. The compression ratio is 3.5 times smaller than PCM, but CPU usage is much lower than the MP3/Vorbis formats which makes it the preferrable choice for the aforementioned categories of sounds.</p>
<h4 id="Vorbis-MP3"><a href="#Vorbis-MP3" class="headerlink" title="Vorbis/MP3"></a>Vorbis/MP3</h4><p>应该叫做OGG Vorbis。类似mp3格式，但这是一种免费开发的非商业压缩格式。属于有损压缩。</p>
<p>The compression results in smaller files but with somewhat lower quality compared to PCM audio. The amount of compression is configurable via the Quality slider. This format is best for <strong>medium length</strong> sound effects and music.</p>
<h3 id="使用建议"><a href="#使用建议" class="headerlink" title="使用建议"></a>使用建议</h3><h4 id="占据大量内存的长音频"><a href="#占据大量内存的长音频" class="headerlink" title="占据大量内存的长音频"></a>占据大量内存的长音频</h4><ul>
<li><p>使用流（Streaming）载入方式（Load Type），并且设置压缩格式（Compression Format）为Vorbis。如此设置即可使内存使用量减至最低，但相对的会占用更多CPU资源和I/O吞吐量。</p>
</li>
<li><p>使用压缩并存储至内存（Compressed In Memory）载入方式，设置压缩格式为Vorbis。与第一个方案唯一的区别是，前者占据更多I/O吞吐，而此种方式占用更多内存。可以调整Quality滑块来通过降低音频质量来减小音频剪辑压缩后的尺寸。一般来说，100%的Quality值略高，我们推荐70%。注意，使用该种设置添加两个以上的音乐或环境声剪辑时会大量消耗CPU。</p>
</li>
</ul>
<h4 id="短或中等长度的音频"><a href="#短或中等长度的音频" class="headerlink" title="短或中等长度的音频"></a>短或中等长度的音频</h4><ul>
<li><p>对于经常播放的短音频剪辑，使用载入时压缩（Decompress On Load）载入方式（Load Type），PCM或ADPCM压缩格式（Compression Format）。选择PCM时，播放无需解压，适用于短且使用频率高的音频剪辑。您也可以用ADPCM压缩格式，播放该格式需要解压缩，但解压缩ADPCM比Vorbis快很多。</p>
</li>
<li><p>对于经常播放的中等长度剪辑，使用压缩并存储至内存（Compressed In Memory）和ADPCM压缩格式（Compression Format）。原始PCM的大小大概是ADPCM的3.5倍，ADPCM的解压缩算法也比Vorbis解压缩算法占用更少CPU。</p>
</li>
<li><p>对于播放频率低的短音频剪辑，使用压缩并存储至内存（Compressed In Memory）和ADPCM压缩格式（Compression Format）</p>
</li>
<li><p>对于播放频率低的中等长度剪辑，使用压缩并存储至内存（Compressed In Memory）和Vorbis压缩格式（Compression Format）。使用ADPCM处理该种声音效果（SFX）未免显得浪费了存储空间，况且播放的频率又很低，所以使用更多CPU资源解压缩还是可以接受的。</p>
</li>
</ul>
<h3 id="Sample-Rate-Setting"><a href="#Sample-Rate-Setting" class="headerlink" title="Sample Rate Setting"></a>Sample Rate Setting</h3><p>Preserve Sample Rate: 保留采样率<br>Optimize Sample Rate：此设置根据分析的最高频率内容自动优化采样率。<br>Override Sample Rate：此设置允许手动覆盖采样率，因此可以有效地避免采样内容丢失。</p>
<h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="https://docs.unity3d.com/Manual/AudioOverview.html" target="_blank" rel="noopener">https://docs.unity3d.com/Manual/AudioOverview.html</a><br><a href="https://www.xuanyusong.com/archives/550" target="_blank" rel="noopener">https://www.xuanyusong.com/archives/550</a><br><a href="https://support.unity3d.com/hc/zh-cn/articles/208211393-%E6%B8%B8%E6%88%8F%E5%9C%A8%E6%92%AD%E6%94%BE%E5%A3%B0%E9%9F%B3%E5%8F%91%E7%94%9F%E5%8D%A1%E9%A1%BF" target="_blank" rel="noopener">https://support.unity3d.com/hc/zh-cn/articles/208211393-%E6%B8%B8%E6%88%8F%E5%9C%A8%E6%92%AD%E6%94%BE%E5%A3%B0%E9%9F%B3%E5%8F%91%E7%94%9F%E5%8D%A1%E9%A1%BF</a></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/" rel="tag">Unity3D</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-Unity3D-A计划"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2023/07/25/Unity3D-A%E8%AE%A1%E5%88%92/"
    >A计划</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2023/07/25/Unity3D-A%E8%AE%A1%E5%88%92/" class="article-date">
  <time datetime="2023-07-25T12:56:23.238Z" itemprop="datePublished">2023-07-25</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Unity3D/">Unity3D</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="学前准备"><a href="#学前准备" class="headerlink" title="学前准备"></a>学前准备</h1><p>学习方法：<br>我已经算是能够熟练使用Unity了，基本算是一个资深的Unity开发者了，已经完全能够应付工作了，学习A计划只是为了把我的基础知识体系补充的更加全面，查缺补漏，在入门级别的小问题上就不值得浪费时间了，快速刷完就OK。</p>
<h3 id="解决问题"><a href="#解决问题" class="headerlink" title="解决问题"></a>解决问题</h3><p>先自己解决三小时以上，解决不了再提问<br>解决错误的时候，先解决第一个</p>
<blockquote>
<p>2019破解<br> <a href="https://www.isharepc.com/19012.html" target="_blank" rel="noopener">https://www.isharepc.com/19012.html</a></p>
</blockquote>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/" rel="tag">Unity3D</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-Unity3D-Assets-Resources-and-AssetBundles-Unity-Le"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2023/07/25/Unity3D-Assets-Resources-and-AssetBundles-Unity-Le/"
    >Assets, Resources and AssetBundles - Unity Le</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2023/07/25/Unity3D-Assets-Resources-and-AssetBundles-Unity-Le/" class="article-date">
  <time datetime="2023-07-25T12:56:23.234Z" itemprop="datePublished">2023-07-25</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Unity3D/">Unity3D</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>arn</p>
<h2 id="1-A-guide-to-AssetBundles-and-Resources"><a href="#1-A-guide-to-AssetBundles-and-Resources" class="headerlink" title="1.A guide to AssetBundles and Resources"></a>1.A guide to AssetBundles and Resources</h2><p>This is a series of articles that provides an in-depth discussion of Assets and resource management in the Unity engine. It seeks to provide expert developers with deep, source-level knowledge of Unity’s Asset and serialization systems. It examines both the technical underpinnings of Unity’s AssetBundle system and the current best practices for employing them.</p>
<p>The guide is broken down into four chapters:</p>
<ol>
<li>1. </li>
</ol>
<p>Assets, Objects and serialization discusses the low-level details of how Unity serializes Assets and handles references between Assets. It is strongly recommended that readers begin with this chapter as it defines terminology used throughout the guide.</p>
<ol>
<li>2. </li>
</ol>
<p>The Resources folder discusses the built-in Resources API.</p>
<ol>
<li>3. </li>
</ol>
<p>AssetBundle fundamentals builds on the information in chapter 1 to describe how AssetBundles operate, and discusses both the loading of AssetBundles and the loading of Assets from AssetBundles.</p>
<ol>
<li>4. </li>
</ol>
<p>AssetBundle usage patterns is a long article discussing many of the topics surrounding the practical uses of AssetBundles. It includes sections on assigning Assets to AssetBundles and on managing loaded Assets, and describes many common pitfalls encountered by developers using AssetBundles.</p>
<p>Note: This guide’s terms for Objects and Assets differ from Unity’s public API naming conventions.</p>
<p>The data this guide calls Objects are called Assets in many public Unity APIs, such as<a href="http://docs.unity3d.com/ScriptReference/AssetBundle.LoadAsset.html" target="_blank" rel="noopener"> AssetBundle.LoadAsset</a> and<a href="http://docs.unity3d.com/ScriptReference/Resources.UnloadUnusedAssets.html" target="_blank" rel="noopener"> Resources.UnloadUnusedAssets</a>. The files this guide calls Assets are rarely exposed to any public APIs. When they are exposed, it is generally only in build-related code, such as<a href="http://docs.unity3d.com/ScriptReference/AssetDatabase.html" target="_blank" rel="noopener"> AssetDatabase</a> and<a href="http://docs.unity3d.com/ScriptReference/BuildPipeline.html" target="_blank" rel="noopener"> BuildPipeline</a>. In these cases, they are called files in public APIs.</p>
<p></p>
<h2 id="2-Assets-Objects-and-serialization"><a href="#2-Assets-Objects-and-serialization" class="headerlink" title="2.Assets, Objects and serialization"></a>2.Assets, Objects and serialization</h2><p>This chapter covers the deep internals of Unity’s serialization system and how Unity maintains robust references between different Objects, both in the Unity Editor and at runtime. It also discusses the technical distinctions between Objects and Assets. The topics covered here are fundamental to understanding how to efficiently load and unload Assets in Unity. Proper Asset management is crucial to keeping loading times short and memory usage low.</p>
<h2 id=""><a href="#" class="headerlink" title=" "></a> </h2><p>2.1. Inside Assets and Objects</p>
<p>To understand how to properly manage data in Unity, it is important to understand how Unity identifies and serializes data. The first key point is the distinction between Assets and UnityEngine.Objects.</p>
<p>An Asset is a file on disk, stored in the Assets folder of a Unity project. Textures, 3D models, or audio clips are common types of Assets. Some Assets contain data in formats native to Unity, such as materials. Other Assets need to be processed into native formats, such as FBX files.</p>
<p>A UnityEngine.Object, or Object with a capitalized ‘O’, is a set of serialized data collectively describing a specific instance of a resource. This can be any type of resource which the Unity Engine uses, such as a mesh, sprite, AudioClip or AnimationClip. All Objects are subclasses of the<a href="http://docs.unity3d.com/ScriptReference/Object.html" target="_blank" rel="noopener"> UnityEngine.Object</a> base class.</p>
<p>While most Object types are built-in, there are two special types.</p>
<ol>
<li>1. </li>
</ol>
<p>A<a href="http://docs.unity3d.com/ScriptReference/ScriptableObject.html" target="_blank" rel="noopener"> ScriptableObject</a> provides a convenient system for developers to define their own data types. These types can be natively serialized and deserialized by Unity, and manipulated in the Unity Editor’s Inspector window.</p>
<ol>
<li>2. </li>
</ol>
<p>A<a href="http://docs.unity3d.com/ScriptReference/MonoBehaviour.html" target="_blank" rel="noopener"> MonoBehaviour</a> provides a wrapper that links to a<a href="http://docs.unity3d.com/ScriptReference/MonoScript.html" target="_blank" rel="noopener"> MonoScript</a>. A MonoScript is an internal data type that Unity uses to hold a reference to a specific scripting class within a specific assembly and namespace. The MonoScript does not contain any actual executable code.</p>
<p>There is a one-to-many relationship between Assets and Objects; that is, any given Asset file contains one or more Objects.</p>
<h2 id="-1"><a href="#-1" class="headerlink" title=" "></a> </h2><p>2.2. Inter-Object references</p>
<p>All UnityEngine.Objects can have references to other UnityEngine.Objects. These other Objects may reside within the same Asset file, or may be imported from other Asset files. For example, a material Object usually has one or more references to texture Objects. These texture Objects are generally imported from one or more texture Asset files (such as PNGs or JPGs).</p>
<p>When serialized, these references consist of two separate pieces of data: a File GUID and a Local ID. The File GUID identifies the Asset file where the target resource is stored. A locally unique Local ID identifies each Object within an Asset file because an Asset file may contain multiple Objects. (Note: AA Local ID is unique from all the other Local IDs for the same Asset file.)</p>
<p>File GUIDs are stored in .meta files. These .meta files are generated when Unity first imports an Asset, and are stored in the same directory as the Asset.</p>
<p>The above identification and referencing system can be seen in a text editor: create a fresh Unity project and change its Editor Settings to expose Visible Meta Files and to serialize Assets as text. Create a material and import a texture into the project. Assign the material to a cube in the scene and save the scene.</p>
<p>Using a text editor, open the .meta file associated with the material. A line labeled “guid” will appear near the top of the file. This line defines the material Asset’s File GUID. To find the Local ID, open the material file in a text editor. The material Object’s definition will look like this:</p>
<pre><code>--- !u!21 &amp;2100000
Material:
 serializedVersion: 3
 ... more data …
</code></pre><p>In the above example, the number preceded by an ampersand is the material’s Local ID. If this material Object were located inside an Asset identified by the File GUID “abcdefg”, then the material Object could be uniquely identified as the combination of the File GUID “abcdefg” and the Local ID “2100000”.</p>
<h2 id="-2"><a href="#-2" class="headerlink" title=" "></a> </h2><p>2.3. Why File GUIDs and Local IDs?</p>
<p>Why is Unity’s File GUID and Local ID system necessary? The answer is robustness and to provide a flexible, platform-independent workflow.</p>
<p>The File GUID provides an abstraction of a file’s specific location. As long as a specific File GUID can be associated with a specific file, that file’s location on disk becomes irrelevant. The file can be freely moved without having to update all Objects referring to the file.</p>
<p>As any given Asset file may contain (or produce via import) multiple UnityEngine.Object resources, a Local ID is required to unambiguously distinguish each distinct Object.</p>
<p>If the File GUID associated with an Asset file is lost, then references to all Objects in that Asset file will also be lost. This is why it is important that the .meta files must remain stored with the same file names and in the same folders as their associated Asset files. Note that Unity will regenerate deleted or misplaced .meta files.</p>
<p>The Unity Editor has a map of specific file paths to known File GUIDs. A map entry is recorded whenever an Asset is loaded or imported. The map entry links the Asset’s specific path to the Asset’s File GUID. If the Unity Editor is open when a .meta file goes missing and the Asset’s path does not change, the Editor can ensure that the Asset retains the same File GUID.</p>
<p>If the .meta file is lost while the Unity Editor is closed, or the Asset’s path changes without the .meta file moving along with the Asset, then all references to Objects within that Asset will be broken.</p>
<h2 id="-3"><a href="#-3" class="headerlink" title=" "></a> </h2><p>2.4. Composite Assets and importers</p>
<p>As mentioned in the Inside Assets and Objects section, non-native Asset types must be imported into Unity. This is done via an asset importer. While these importers are usually invoked automatically, they are also exposed to scripts via the <a href="http://docs.unity3d.com/ScriptReference/AssetImporter.html" target="_blank" rel="noopener">AssetImporter</a> API. For example, the <a href="http://docs.unity3d.com/ScriptReference/TextureImporter.html" target="_blank" rel="noopener">TextureImporter</a> API provides access to the settings used when importing individual texture Assets, such as PNG files.</p>
<p>The result of the import process is one or more UnityEngine.Objects. These are visible in the Unity Editor as multiple sub-assets within the parent Asset, such as multiple sprites nested beneath a texture Asset that has been imported as a sprite atlas. Each of these Objects will share a File GUID as their source data is stored within the same Asset file. They will be distinguished within the imported texture Asset by a Local ID.</p>
<p>The import process converts source Assets into formats suitable for the target platform selected in the Unity Editor. The import process can include a number of heavyweight operations, such as texture compression. As this is often a time-consuming process, imported Asset are cached in the Library folder, eliminating the need to re-import Assets again on the next Editor launch.</p>
<p>Specifically, the results of the import process are stored in a folder named for the first two digits of the Asset’s File GUID. This folder is stored inside the Library/metadata/ folder. The individual Objects from the Asset are serialized into a single binary file that has a name identical to the Asset’s File GUID.</p>
<p>This process applies to all Assets, not just non-native Assets. Native assets do not require lengthy conversion processes or re-serialization.</p>
<h2 id="-4"><a href="#-4" class="headerlink" title=" "></a> </h2><p>2.5. Serialization and instances</p>
<p>While File GUIDs and Local IDs are robust, GUID comparisons are slow and a more performant system is needed at runtime. Unity internally maintains a cache that translates File GUIDs and Local IDs into simple, session-unique integers (note: Internally, this cache is called the PersistentManager.) These integers are called Instance IDs, and are assigned in a simple, monotonically-increasing order when new Objects are registered with the cache.</p>
<p>The cache maintains mappings between a given Instance ID, File GUID and Local ID defining the location of the Object’s source data, and the instance of the Object in memory (if any). This allows UnityEngine.Objects to robustly maintain references to each other. Resolving an Instance ID reference can quickly return the loaded Object represented by the Instance ID. If the target Object is not yet loaded, the File GUID and Local ID can be resolved to the Object’s source data, allowing Unity to load the object just-in-time.</p>
<p>At startup, the Instance ID cache is initialized with data for all Objects immediately required by the project (i.e., referenced in built Scenes), as well as all Objects contained in the Resources folder. Additional entries are added to the cache when new assets are imported at runtime and when Objects are loaded from AssetBundles (note: An example of an Asset created at runtime would be a Texture2D Object created in script, like so: var myTexture = new Texture2D(1024, 768);). Instance ID entries are only removed from the cache when an AssetBundle providing access to a specific File GUID and Local ID is unloaded. When this occurs, the mapping between the Instance ID, its File GUID and Local ID are deleted to conserve memory. If the AssetBundle is re-loaded, a new Instance ID will be created for each Object loaded from the re-loaded AssetBundle.</p>
<p>For a deeper discussion of the implications of unloading AssetBundles, see the Managing Loaded Assets section in the AssetBundle Usage Patterns step.</p>
<p>On specific platforms, certain events can force Objects out of memory. For example, graphical Assets can be unloaded from graphics memory on iOS when an app is suspended. If these Objects originated in an AssetBundle that has been unloaded, Unity will be unable to reload the source data for the Objects. Any extant references to these Objects will also be invalid. In the preceding example, the scene may appear to have invisible meshes or magenta textures.</p>
<p>Implementation note: At runtime, the above control flow is not literally accurate. Comparing File GUIDs and Local IDs at runtime would not be sufficiently performant during heavy loading operations. When building a Unity project, the File GUIDs and Local IDs are deterministically mapped into a simpler format. However, the concept remains identical, and thinking in terms of File GUIDs and Local IDs remains a useful analogy during runtime. This is also the reason why Asset File GUIDs cannot be queried at runtime.</p>
<h2 id="-5"><a href="#-5" class="headerlink" title=" "></a> </h2><p>2.6. MonoScripts</p>
<p>It is important to understand that a MonoBehaviour has a reference to a MonoScript, and MonoScripts simply contain the information needed to locate a specific script class. Neither type of Object contains the executable code of script class.</p>
<p>A MonoScript contains three strings: assembly name, class name, and namespace.</p>
<p>While building a project, Unity compiles all the loose script files in the Assets folder into Mono assemblies. C# scripts outside of the Plugins subfolder are placed into Assembly-CSharp.dll. Scripts within the Plugins subfolder are placed into Assembly-CSharp-firstpass.dll, and so on. In addition, Unity 2017.3 also introduces the ability to <a href="https://docs.unity3d.com/Manual/ScriptCompilationAssemblyDefinitionFiles.html" target="_blank" rel="noopener">define custom managed assemblies</a>.</p>
<p>These assemblies, as well as pre-built assembly DLL files, are included in the final build of a Unity application. They are also the assemblies to which a MonoScript refers. Unlike other resources, all assemblies included in a Unity application are loaded on application start-up.</p>
<p>This MonoScript Object is the reason why an AssetBundle (or a Scene or a prefab) does not actually contain executable code in any of the MonoBehaviour Components in the AssetBundle, Scene or prefab. This allows different MonoBehaviours to refer to specific shared classes, even if the MonoBehaviours are in different AssetBundles.</p>
<h2 id="-6"><a href="#-6" class="headerlink" title=" "></a> </h2><p>2.7. Resource lifecycle</p>
<p>To reduce loading times and manage an application’s memory footprint, it’s important to understand the resource lifecycle of UnityEngine.Objects. Objects are loaded into/unloaded from memory at specific and defined times.</p>
<p>An Object is loaded automatically when:</p>
<ol>
<li>1. </li>
</ol>
<p>The Instance ID mapped to that Object is dereferenced</p>
<ol>
<li>2. </li>
</ol>
<p>The Object is currently not loaded into memory</p>
<ol>
<li>3. </li>
</ol>
<p>The Object’s source data can be located.</p>
<p>Objects can also be explicitly loaded in scripts, either by creating them or by calling a resource-loading API (e.g., <a href="http://docs.unity3d.com/ScriptReference/AssetBundle.LoadAsset.html" target="_blank" rel="noopener">AssetBundle.LoadAsset</a>). When an Object is loaded, Unity tries to resolve any references by translating each reference’s File GUID and Local ID into an Instance ID. An Object will be loaded on-demand the first time its Instance ID is dereferenced if two criteria are true:</p>
<ol>
<li>1. </li>
</ol>
<p>The Instance ID references an Object that is not currently loaded</p>
<ol>
<li>2. </li>
</ol>
<p>The Instance ID has a valid File GUID and Local ID registered in the cache</p>
<p>This generally occurs very shortly after the reference itself is loaded and resolved.</p>
<p>If a File GUID and Local ID do not have an Instance ID, or if an Instance ID with an unloaded Object references an invalid File GUID and Local ID, then the reference is preserved but the actual Object will not be loaded. This appears as a “(Missing)” reference in the Unity Editor. In a running application, or in the Scene View, “(Missing)” Objects will be visible in different ways, depending on their types. For example, meshes will appear to be invisible, while textures may appear to be magenta.</p>
<p>Objects are unloaded in three specific scenarios:</p>
<ul>
<li><p>Objects are automatically unloaded when unused Asset cleanup occurs. This process is triggered automatically when scenes are changed destructively (i.e. when <a href="https://docs.unity3d.com/ScriptReference/SceneManagement.SceneManager.html" target="_blank" rel="noopener">SceneManager.LoadScene</a> is invoked non-additively), or when a script invokes the<a href="http://docs.unity3d.com/ScriptReference/Resources.UnloadUnusedAssets.html" target="_blank" rel="noopener"> Resources.UnloadUnusedAssets</a> API. This process only unloads unreferenced Objects; an Object will only be unloaded if no Mono variable holds a reference to the Object, and there are no other live Objects holding references to the Object. Furthermore, note that anything marked with <a href="https://docs.unity3d.com/ScriptReference/HideFlags.DontUnloadUnusedAsset.html" target="_blank" rel="noopener">HideFlags.DontUnloadUnusedAsset</a> and <a href="https://docs.unity3d.com/ScriptReference/HideFlags.HideAndDontSave.html" target="_blank" rel="noopener">HideFlags.HideAndDontSave</a> will not be unloaded.</p>
</li>
<li><p>Objects sourced from the Resources folder can be explicitly unloaded by invoking the<a href="http://docs.unity3d.com/ScriptReference/Resources.UnloadAsset.html" target="_blank" rel="noopener"> Resources.UnloadAsset</a> API. The Instance ID for these Objects remains valid and will still contain a valid File GUID and LocalID entry. If any Mono variable or other Object holds a reference to an Object that is unloaded with<a href="http://docs.unity3d.com/ScriptReference/Resources.UnloadAsset.html" target="_blank" rel="noopener"> Resources.UnloadAsset</a>, then that Object will be reloaded as soon as any of the live references are dereferenced.</p>
</li>
<li><p>Objects sourced from AssetBundles are automatically and immediately unloaded when invoking the<a href="http://docs.unity3d.com/ScriptReference/AssetBundle.Unload.html" target="_blank" rel="noopener"> AssetBundle.Unload</a>(true) API. This invalidates the File GUID and Local ID of the Object’s Instance ID, and any live references to the unloaded Objects will become “(Missing)” references. From C# scripts, attempting to access methods or properties on an unloaded object will produce a NullReferenceException.</p>
</li>
</ul>
<p>If <a href="http://docs.unity3d.com/ScriptReference/AssetBundle.Unload.html" target="_blank" rel="noopener">AssetBundle.Unload</a>(false) is called, live Objects sourced from the unloaded AssetBundle will not be destroyed, but Unity will invalidate the File GUID and Local ID references of their Instance IDs. It will be impossible for Unity to reload these Objects if they are later unloaded from memory and live references to the unloaded Objects remain. </p>
<p>(Note: The most common case where Objects are removed from memory at runtime without being unloaded occurs when Unity loses control of its graphics context. This may occur when a mobile app is suspended and the app is forced into the background. In this case, the mobile OS usually evicts all graphical resources from GPU memory. When the app returns to the foreground, Unity must reload all needed Textures, Shaders and Meshes to the GPU before scene rendering can resume.)</p>
<h2 id="-7"><a href="#-7" class="headerlink" title=" "></a> </h2><p>2.8. Loading large hierarchies</p>
<p>When serializing hierarchies of Unity GameObjects, such as during prefabs serialization, it is important to remember that the entire hierarchy will be fully serialized. That is, every GameObject and Component in the hierarchy will be individually represented in the serialized data. This has interesting impacts on the time required to load and instantiate hierarchies of GameObjects.</p>
<p>When creating any GameObject hierarchy, CPU time is spent in several different ways:</p>
<ul>
<li><p>Reading the source data (from storage, from an AssetBundle, from another GameObject, etc.)</p>
</li>
<li><p>Setting up the parent-child relationships between the new Transforms</p>
</li>
<li><p>Instantiating the new GameObjects and Components</p>
</li>
<li><p>Awakening the new GameObjects and Components on the main thread</p>
</li>
</ul>
<p>The latter three time costs are generally invariant regardless of whether the hierarchy is being cloned from an existing hierarchy or is being loaded from storage. However, the time to read the source data increases linearly with the number of Components and GameObjects serialized into the hierarchy, and is also multiplied by the speed of the data source.</p>
<p>On all current platforms, it is considerably faster to read data from elsewhere in memory rather than loading it from a storage device. Further, the performance characteristics of the available storage media vary widely between different platforms. Therefore, when loading prefabs on platforms with slow storage, the time spent reading the prefab’s serialized data from storage can rapidly exceed the time spent instantiating the prefab. That is, the cost of the loading operation is bound to storage I/O time.</p>
<p>As mentioned before, when serializing a monolithic prefab, every GameObject and component’s data is serialized separately, which may duplicate data. For example, a UI screen with 30 identical elements will have the identical element serialized 30 times, producing a large blob of binary data. At load time, the data for all of the GameObjects and Components on each one of those 30 duplicate elements must be read from disk before being transferred to the newly-instantiated Object. This file reading time is a significant contributor to the overall cost of instantiating large prefabs. Large hierarchies should be instantiated in modular chunks, and then be stitched together at runtime.</p>
<p>Unity 5.4 note: Unity 5.4 altered the representation of transforms in memory. Each root transform’s entire child hierarchy is stored in compact, contiguous regions of memory. When instantiating new GameObjects that will be instantly reparented into another hierarchy, consider using the new <a href="https://docs.unity3d.com/ScriptReference/Object.Instantiate.html" target="_blank" rel="noopener">GameObject.Instantiate</a> overloaded variants which accept a parent argument. Using this overload avoids the allocation of a root transform hierarchy for the new GameObject. In tests, this speeds up the time required for an instantiate operation by about 5-10%.</p>
<p></p>
<h2 id="3-The-Resources-folder"><a href="#3-The-Resources-folder" class="headerlink" title="3.The Resources folder"></a>3.The Resources folder</h2><p>This chapter discusses the Resources system. This is the system that allows developers to store Assets within one or more folders named Resources and to load or unload Objects from those Assets at runtime using the<a href="http://docs.unity3d.com/ScriptReference/Resources.html" target="_blank" rel="noopener"> Resources</a> API.</p>
<h2 id="-8"><a href="#-8" class="headerlink" title=" "></a> </h2><p>3.1. Best Practices for the Resources System</p>
<p>Don’t use it.</p>
<p>This strong recommendation is made for several reasons:</p>
<ul>
<li><p>Use of the Resources folder makes fine-grained memory management more difficult</p>
</li>
<li><p>Improper use of Resources folders will increase application startup time and the length of builds</p>
</li>
<li><p>As the number of Resources folders increases, management of the Assets within those folders becomes very difficult</p>
</li>
<li><p>The Resources system degrades a project’s ability to deliver custom content to specific platforms and eliminates the possibility of incremental content upgrades</p>
</li>
<li><p>AssetBundle Variants are Unity’s primary tool for adjusting content on a per-device basis</p>
</li>
</ul>
<h3 id="-9"><a href="#-9" class="headerlink" title=" "></a> </h3><p>3.2. Proper uses of the Resources system</p>
<p>There are two specific use cases where the Resources system can be helpful without impeding good development practices:</p>
<ol>
<li>1. </li>
</ol>
<p>The ease of the Resources folder makes it an excellent system to rapidly prototype. However, when a project moves into full production, the use of the Resources folder should be eliminated.</p>
<ol>
<li>2. </li>
</ol>
<p>The Resources folder may be useful in some trivial cases, if the content is:</p>
<ol>
<li>3. </li>
</ol>
<p>Generally required throughout a project’s lifetime</p>
<ol>
<li>4. </li>
</ol>
<p>Not memory-intensive</p>
<ol>
<li>5. </li>
</ol>
<p>Not prone to patching, or does not vary across platforms or devices</p>
<ol>
<li>6. </li>
</ol>
<p>Used for minimal bootstrapping</p>
<p>Examples of this second case include MonoBehaviour singletons used to host prefabs, or ScriptableObjects containing third-party configuration data, such as a Facebook App ID.</p>
<h3 id="-10"><a href="#-10" class="headerlink" title=" "></a> </h3><p>3.3. Serialization of Resources</p>
<p>The Assets and Objects in all folders named “Resources” are combined into a single serialized file when a project is built. This file also contains metadata and indexing information, similar to an AssetBundle. As described in the <a href="https://docs.unity3d.com/Manual/AssetBundlesIntro.html" target="_blank" rel="noopener">AssetBundle documentation</a>, this index includes a serialized lookup tree that is used to resolve a given Object’s name into its appropriate File GUID and Local ID. It is also used to locate the Object at a specific byte offset in the serialized file’s body.</p>
<p>On most platforms, the lookup data structure is a balanced search tree, which has a construction time that grows at an O(n log(n)) rate. This growth also causes the index’s loading time to grow more-than-linearly as the number of Objects in Resources folders increases.</p>
<p>This operation is unskippable and occurs at application startup time while the initial non-interactive splash screen is displayed. Initializing a Resources system containing 10,000 assets has been observed to consume multiple seconds on low-end mobile devices, even though most of the Objects contained in Resources folders are rarely actually needed to load into an application’s first scene.</p>
<p></p>
<h2 id="4-AssetBundle-fundamentals"><a href="#4-AssetBundle-fundamentals" class="headerlink" title="4.AssetBundle fundamentals"></a>4.AssetBundle fundamentals</h2><p>This chapter discusses AssetBundles. It introduces the fundamental systems upon which AssetBundles are built, as well as the core APIs used to interact with AssetBundles. In particular, it discusses both the loading and unloading of AssetBundles themselves, as well as the loading and unloading of specific Asset and Objects from AssetBundles.</p>
<p>For more patterns and best practices on the uses of AssetBundles, see the next chapter in this series.</p>
<h2 id="-11"><a href="#-11" class="headerlink" title=" "></a> </h2><p>4.1. Overview</p>
<p>The AssetBundle system provides a method for storing one or more files in an archival format that Unity can index and serialize. AssetBundles are Unity’s primary tool for the delivery and updating of non-code content after installation. This permits developers to submit a smaller app package, minimize runtime memory pressure, and selectively load content optimized for the end-user’s device.</p>
<p>Understanding the way AssetBundles work is essential to building a successful Unity project for mobile devices. For an overall description of AssetBundle contents, review the <a href="https://docs.unity3d.com/Manual/AssetBundlesIntro.html" target="_blank" rel="noopener">AssetBundle documentation</a>.</p>
<h2 id="-12"><a href="#-12" class="headerlink" title=" "></a> </h2><p>4.2. AssetBundle layout</p>
<p>To summarize, an AssetBundle consists of two parts: a header and data segment.</p>
<p>The header contains information about the AssetBundle, such as its identifier, compression type, and a manifest. The manifest is a lookup table keyed by an Object’s name. Each entry provides a byte index that indicates where a given Object can be found within the AssetBundle’s data segment. On most platforms, this lookup table is implemented as a balanced search tree. Specifically, Windows and OSX-derived platforms (including iOS) employ a red-black tree. Therefore, the time needed to construct the manifest will increase more than linearly as the number of Assets within an AssetBundle grows.</p>
<p>The data segment contains the raw data generated by serializing the Assets in the AssetBundle. If LZMA is specified as the compression scheme, the complete byte array for all serialized assets is compressed. If LZ4 is instead specified, bytes for separate Assets are individually compressed. If no compression is used, the data segment will remain as raw byte streams.</p>
<p>Prior to Unity 5.3, Objects could not be compressed individually inside an AssetBundle. As a consequence, if a version of Unity before 5.3 is instructed to read one or more Objects from a compressed AssetBundle, Unity had to decompress the entire AssetBundle. Generally, Unity cached a decompressed copy of the AssetBundle to improve loading performance for subsequent loading requests on the same AssetBundle.</p>
<h2 id="-13"><a href="#-13" class="headerlink" title=" "></a> </h2><p>4.3. Loading AssetBundles</p>
<p>AssetBundles can be loaded via four distinct APIs. The behavior of these four APIs is different depending on two criteria:</p>
<ol>
<li>1. </li>
</ol>
<p>Whether the AssetBundle is LZMA compressed, LZ4 compressed or uncompressed</p>
<ol>
<li>2. </li>
</ol>
<p>The platform on which the AssetBundle is being loaded</p>
<p>These APIs are:</p>
<ul>
<li><p>AssetBundle.LoadFromMemory(Async optional)</p>
</li>
<li><p>AssetBundle.LoadFromFile(Async optional)</p>
</li>
<li><p>UnityWebRequest’s DownloadHandlerAssetBundle</p>
</li>
<li><p>WWW.LoadFromCacheOrDownload (on Unity 5.6 or older)</p>
</li>
</ul>
<h3 id="-14"><a href="#-14" class="headerlink" title=" "></a> </h3><p>4.3.1 AssetBundle.LoadFromMemory(Async)</p>
<p>Unity’s recommendation is not to use this API.</p>
<p><a href="https://docs.unity3d.com/ScriptReference/AssetBundle.LoadFromMemoryAsync.html" target="_blank" rel="noopener">AssetBundle.LoadFromMemoryAsync</a> loads an AssetBundle from a managed-code byte array (byte[] in C#). It will always copy the source data from the managed-code byte array into a newly-allocated, contiguous block of native memory. If the AssetBundle is LZMA compressed, it will decompress the AssetBundle while copying. Uncompressed and LZ4-compressed AssetBundles will be copied verbatim.</p>
<p>The peak amount of memory consumed by this API will be at least twice the size of the AssetBundle: one copy in native memory created by the API, and one copy in the managed byte array passed to the API. Assets loaded from an AssetBundle created via this API will therefore be duplicated three times in memory: once in the managed-code byte array, once in the native-memory copy of the AssetBundle and a third time in GPU or system memory for the asset itself.</p>
<p>Prior to Unity 5.3.3, this API was known as <strong>AssetBundle.CreateFromMemory</strong>. Its functionality has not changed.</p>
<h3 id="-15"><a href="#-15" class="headerlink" title=" "></a> </h3><p>4.3.2. AssetBundle.LoadFromFile(Async)</p>
<p><a href="https://docs.unity3d.com/ScriptReference/AssetBundle.LoadFromFile.html" target="_blank" rel="noopener">AssetBundle.LoadFromFile</a> is a highly-efficient API intended for loading uncompressed or LZ4-compressed AssetBundle from local storage, such as a hard disk or an SD card.</p>
<p>On desktop standalone, console, and mobile platforms, the API will only load the AssetBundle’s header, and will leave the remaining data on disk. The AssetBundle’s Objects will be loaded on-demand as loading methods (e.g. AssetBundle.Load) are called or as their InstanceIDs are dereferenced. No excess memory will be consumed in this scenario. In the Unity Editor, the API will load the entire AssetBundle into memory, as if the bytes were read off disk and AssetBundle.LoadFromMemoryAsync was used. This API can cause memory spikes to appear during AssetBundle loading if the project is profiled in the Unity Editor. This should not affect performance on-device and these spikes should be re-tested on-device before taking remedial action.</p>
<p>Note: On Android devices with Unity 5.3 or older, this API will fail when trying to load AssetBundles from the Streaming Assets path. This issue has been resolved in Unity 5.4. For more details, see the section Distribution - shipped with project section of the AssetBundle usage patterns step.</p>
<p>Prior to Unity 5.3, this API was known as <strong>AssetBundle.CreateFromFile</strong>. Its functionality has not been changed.</p>
<h3 id="-16"><a href="#-16" class="headerlink" title=" "></a> </h3><p>4.3.3. AssetBundleDownloadHandler</p>
<p>The <a href="http://docs.unity3d.com/ScriptReference/Networking.UnityWebRequest.html" target="_blank" rel="noopener">UnityWebRequest</a> API allows developers to specify exactly how Unity should handle downloaded data and allows developers to eliminate unnecessary memory usage. The simplest way to download an AssetBundle using UnityWebRequest is call <a href="http://docs.unity3d.com/ScriptReference/Networking.UnityWebRequest.GetAssetBundle.html" target="_blank" rel="noopener">UnityWebRequest.GetAssetBundle</a>.</p>
<p>For the purposes of this guide, the class of interest is <a href="http://docs.unity3d.com/ScriptReference/Networking.DownloadHandlerAssetBundle.html" target="_blank" rel="noopener">DownloadHandlerAssetBundle</a>. Using a worker thread, it streams downloaded data into a fixed-size buffer and then spools the buffered data to either temporary storage or the AssetBundle cache, depending on how the Download Handler has been configured. All of these operations occur in native code, eliminating the risk of expanding the managed heap. Additionally, this Download Handler does not keep a native-code copy of all downloaded bytes, further reducing the memory overhead of downloading an AssetBundle.</p>
<p>LZMA-compressed AssetBundles will be decompressed during download and cached using LZ4 compression. This behavior may be changed by setting <a href="https://docs.unity3d.com/ScriptReference/Caching-compressionEnabled.html" target="_blank" rel="noopener">Caching.CompressionEnabled</a>.</p>
<p>When the download is complete, the <a href="http://docs.unity3d.com/ScriptReference/Networking.DownloadHandlerAssetBundle-assetBundle.html" target="_blank" rel="noopener">assetBundle</a> property of the Download Handler provides access to the downloaded AssetBundle, as if AssetBundle.LoadFromFile had been called on the downloaded AssetBundle.</p>
<p>If caching information is provided to a UnityWebRequest object, and the requested AssetBundle already exists in Unity’s cache, then the AssetBundle will become available immediately and this API will operate identically to AssetBundle.LoadFromFile.</p>
<p>Prior to Unity 5.6, the UnityWebRequest system used a fixed pool of worker threads and an internal job system to safeguard against excessive, concurrent downloads. The size of the thread pool was not configurable. In Unity 5.6, these safeguards have been removed to accommodate more modern hardware, and allow for faster access to HTTP response codes and headers.</p>
<h3 id="-17"><a href="#-17" class="headerlink" title=" "></a> </h3><p>4.3.4. WWW.LoadFromCacheOrDownload</p>
<p>Note: Beginning in Unity 2017.1, <a href="http://docs.unity3d.com/ScriptReference/WWW.LoadFromCacheOrDownload.html" target="_blank" rel="noopener">WWW.LoadFromCacheOrDownload</a> simply wraps around UnityWebRequest. Accordingly, developers using Unity 2017.1 or higher should migrate to UnityWebRequest. WWW.LoadFromCacheOrDownload will be deprecated in a future release.</p>
<p>The following information is applicable to Unity 5.6 or older.</p>
<p><a href="http://docs.unity3d.com/ScriptReference/WWW.LoadFromCacheOrDownload.html" target="_blank" rel="noopener">WWW.LoadFromCacheOrDownload</a> is an API that allows loading of Objects from both remote servers and local storage. Files can be loaded from local storage via a file:// URL. If the AssetBundle is present in the Unity cache, this API will behave exactly like AssetBundle.LoadFromFile.</p>
<p>If an AssetBundle has not yet been cached, then WWW.LoadFromCacheOrDownload will read the AssetBundle from its source. If the AssetBundle is compressed, it will be decompressed using a worker thread and written into the cache. Otherwise, it will be written directly into the cache via the worker thread. Once the AssetBundle is cached, WWW.LoadFromCacheOrDownload will load header information from the cached, decompressed AssetBundle. The API will then behave identically to an AssetBundle loaded with AssetBundle.LoadFromFile. This cache is shared between WWW.LoadFromCacheOrDownload and UnityWebRequest. Any AssetBundle downloaded with one API will also be available via the other API.</p>
<p>While the data will be decompressed and written to the cache via a fixed-size buffer, the WWW object will keep a full copy of the AssetBundle’s bytes in native memory. This extra copy of the AssetBundle is kept to support the <a href="http://docs.unity3d.com/ScriptReference/WWW-bytes.html" target="_blank" rel="noopener">WWW.bytes</a> property.</p>
<p>Due to the memory overhead of caching an AssetBundle’s bytes in the WWW object, AssetBundles should remain small - a few megabytes, at most. For more discussion of AssetBundle sizing, see the<a href="https://unity3d.com/learn/tutorials/topics/best-practices/asset-bundle-usage-patterns#Asset_Assignment_Strategies" target="_blank" rel="noopener"> </a>Asset assignment strategies section in the<a href="https://unity3d.com/learn/tutorials/topics/best-practices/asset-bundle-usage-patterns" target="_blank" rel="noopener"> </a>AssetBundle usage patterns chapter.</p>
<p>Unlike UnityWebRequest, each call to this API will spawn a new worker thread. Accordingly, on platforms with limited memory, such as mobile devices, only a single AssetBundle at a time should be downloaded using this API, in order to avoid memory spikes. Be careful of creating an excessive number of threads when calling this API multiple times. If more than 5 AssetBundles need to be downloaded, create and manage a download queue in script code to ensure that only a few AssetBundle downloads are running occurring simultaneously.</p>
<h3 id="-18"><a href="#-18" class="headerlink" title=" "></a> </h3><p>4.3.5. Recommendations</p>
<p>In general, AssetBundle.LoadFromFile should be used whenever possible. This API is the most efficient in terms of speed, disk usage and runtime memory usage.</p>
<p>For projects that must download or patch AssetBundles, it is strongly recommended to use<a href="https://unity3d.com/learn/tutorials/topics/best-practices/assetbundle-fundamentals?playlist=30089#AssetBundleDownloadHandler" target="_blank" rel="noopener"> </a>UnityWebRequest for projects using Unity 5.3 or newer, and WWW.LoadFromCacheOrDownload for projects using Unity 5.2 or older. As detailed in the<a href="https://unity3d.com/learn/tutorials/topics/best-practices/asset-bundle-usage-patterns#Distribution" target="_blank" rel="noopener"> </a>Distribution section, it is possible to prime the AssetBundle Cache with Bundles included within a project’s installer.</p>
<p>When using either UnityWebRequest or WWW.LoadFromCacheOrDownload, ensure that the downloader code properly calls Dispose after loading the AssetBundle. Alternately, C#’s<a href="https://msdn.microsoft.com/en-us//library/yh598w02.aspx" target="_blank" rel="noopener"> using</a> statement is the most convenient way to ensure that a WWW or UnityWebRequest is safely disposed.</p>
<p>For projects with substantial engineering teams that require unique, specific caching or downloading requirements, a custom downloader may be considered. Writing a custom downloader is a non-trivial engineering task, and any custom downloader should be made compatible with AssetBundle.LoadFromFile. See the Distribution section of the next step for more details.</p>
<h2 id="-19"><a href="#-19" class="headerlink" title=" "></a> </h2><p>4.4. Loading Assets From AssetBundles</p>
<p>UnityEngine.Objects can be loaded from AssetBundles using three distinct APIs that are all attached to the AssetBundle object, which have both synchronous and asynchronous variants:</p>
<ul>
<li><p><a href="https://docs.unity3d.com/ScriptReference/AssetBundle.LoadAsset.html" target="_blank" rel="noopener">LoadAsset</a> (<a href="https://docs.unity3d.com/ScriptReference/AssetBundle.LoadAssetAsync.html" target="_blank" rel="noopener">LoadAssetAsync</a>)</p>
</li>
<li><p><a href="https://docs.unity3d.com/ScriptReference/AssetBundle.LoadAllAssets.html" target="_blank" rel="noopener">LoadAllAssets</a> (<a href="https://docs.unity3d.com/ScriptReference/AssetBundle.LoadAllAssetsAsync.html" target="_blank" rel="noopener">LoadAllAssetsAsync</a>)</p>
</li>
<li><p><a href="https://docs.unity3d.com/ScriptReference/AssetBundle.LoadAssetWithSubAssets.html" target="_blank" rel="noopener">LoadAssetWithSubAssets</a> (<a href="https://docs.unity3d.com/ScriptReference/AssetBundle.LoadAssetWithSubAssetsAsync.html" target="_blank" rel="noopener">LoadAssetWithSubAssetsAsync</a>)</p>
</li>
</ul>
<p>The synchronous versions of these APIs will always be faster than their asynchronous counterpart, by at least one frame.</p>
<p>Asynchronous loads will load multiple Objects per frame, up to their time-slice limits. See the<a href="https://unity3d.com/learn/tutorials/topics/best-practices/assetbundle-fundamentals?playlist=30089#Lowlevel_Loading_Details" target="_blank" rel="noopener"> </a>Low-level loading details section for the underlying technical reasons for this behavior.</p>
<p>LoadAllAssets should be used when loading multiple independent UnityEngine.Objects. It should only be used when the majority or all of the Objects within an AssetBundle need to be loaded. Compared to the other two APIs, LoadAllAssets is slightly faster than multiple individual calls to LoadAssets. Therefore, if the number of assets to be loaded is large, but less than 66% of the AssetBundle needs to be loaded at a single time, consider splitting the AssetBundle into multiple smaller bundles and using LoadAllAssets.</p>
<p>LoadAssetWithSubAssets should be used when loading a composite Asset which contains multiple embedded Objects, such as an FBX model with embedded animations or a sprite atlas with multiple sprites embedded inside it. If the Objects that need to be loaded all come from the same Asset, but are stored in an AssetBundle with many other unrelated Objects, then use this API.</p>
<p>For any other case, use LoadAsset or LoadAssetAsync.</p>
<h3 id="-20"><a href="#-20" class="headerlink" title=" "></a> </h3><p>4.4.1. Low-level loading details</p>
<p>UnityEngine.Object loading is performed off the main thread: an Object’s data is read from storage on a worker thread. Anything which does not touch thread-sensitive parts of the Unity system (scripting, graphics) will be converted on the worker thread. For example, VBOs will be created from meshes, textures will be decompressed, etc.</p>
<p>From Unity 5.3 onward, Object loading has been parallelized. Multiple Objects are deserialized, processed and integrated on worker threads. When an Object finishes loading, its Awake callback will be invoked and the Object will become available to the rest of the Unity Engine during the next frame.</p>
<p>The synchronous AssetBundle.Load methods will pause the main thread until Object loading is complete. They will also time-slice Object loading so that Object integration does not occupy more than a certain number of milliseconds of frame time. The number of milliseconds is set by the property Application.backgroundLoadingPriority:</p>
<ul>
<li><p>ThreadPriority.High: Maximum 50 milliseconds per frame</p>
</li>
<li><p>ThreadPriority.Normal: Maximum 10 milliseconds per frame</p>
</li>
<li><p>ThreadPriority.BelowNormal: Maximum 4 milliseconds per frame</p>
</li>
<li><p>ThreadPriority.Low: Maximum 2 milliseconds per frame.</p>
</li>
</ul>
<p>From Unity 5.2 onwards, multiple Objects are loaded until the frame-time limit for Object loading is reached. Assuming all other factors equal, the asynchronous variants of the asset loading APIs will always take longer to complete than the comparable synchronous version due to the minimum one-frame delay between issuing the asynchronous call and the object becoming available to the Engine.</p>
<h3 id="-21"><a href="#-21" class="headerlink" title=" "></a> </h3><p>4.4.2. AssetBundle dependencies</p>
<p>The dependencies among AssetBundles are automatically tracked using two different APIs, depending on the runtime environment. In the Unity Editor, AssetBundle dependencies can be queried via the<a href="http://docs.unity3d.com/ScriptReference/AssetDatabase.html" target="_blank" rel="noopener"> AssetDatabase</a> API. AssetBundle assignments and dependencies can be accessed and changed via the<a href="http://docs.unity3d.com/ScriptReference/AssetImporter.html" target="_blank" rel="noopener"> AssetImporter</a> API. At runtime, Unity provides an optional API to load the dependency information generated during an AssetBundle build via a ScriptableObject-based<a href="http://docs.unity3d.com/ScriptReference/AssetBundleManifest.html" target="_blank" rel="noopener"> AssetBundleManifest</a> API.</p>
<p>An AssetBundle is dependent upon another AssetBundle when one or more of the parent AssetBundle’s UnityEngine.Objects refers to one or more of the other AssetBundle’s UnityEngine.Objects. For more information on inter-Object references, see the<a href="https://unity3d.com/learn/tutorials/temas/best-practices/assets-objects-and-serialization#InterObject_References" target="_blank" rel="noopener"> </a>Inter-Object references section of the<a href="https://unity3d.com/learn/tutorials/temas/best-practices/assets-objects-and-serialization" target="_blank" rel="noopener"> </a>Assets, Objects and Serialization step.</p>
<p>As described in the Serialization and instances section of that step, AssetBundles serve as sources for the source data identified by the FileGUID &amp; LocalID of each Object contained within the AssetBundle.</p>
<p>Because an Object is loaded when its Instance ID is first dereferenced, and because an Object is assigned a valid Instance ID when its AssetBundle is loaded, the order in which AssetBundles are loaded is not important. Instead, it is important to load all AssetBundles that contain dependencies of an Object before loading the Object itself. Unity will not attempt to automatically load any child AssetBundles when a parent AssetBundle is loaded.</p>
<p>Example:</p>
<p>Assume material A refers to texture B. Material A is packaged into AssetBundle 1, and texture B is packaged into AssetBundle 2.</p>
<p><img src="assets/Assets,%20Resources%20and%20AssetBundles%20-%20Unity%20Le/f2a6f87c-5842-4acb-b220-2d7917e1f29f_ab1.jpg" alt=""></p>
<p>In this use case, AssetBundle 2 must be loaded prior to loading Material A out of AssetBundle 1.</p>
<p>This does not imply that AssetBundle 2 must be loaded before AssetBundle 1, or that Texture B must be loaded explicitly from AssetBundle 2. It is sufficient to have AssetBundle 2 loaded prior to loading Material A out of AssetBundle 1.</p>
<p>However, Unity will not automatically load AssetBundle 2 when AssetBundle 1 is loaded. This must be done manually in script code.</p>
<p>For more information on AssetBundle dependencies, refer to the <a href="https://docs.unity3d.com/Manual/AssetBundles-Dependencies.html" target="_blank" rel="noopener">manual page</a>.</p>
<h3 id="-22"><a href="#-22" class="headerlink" title=" "></a> </h3><p>4.4.3. AssetBundle manifests</p>
<p>When executing the AssetBundle build pipeline using the BuildPipeline.BuildAssetBundles API, Unity serializes an Object containing each AssetBundle’s dependency information. This data is stored in a separate AssetBundle, which contains a single Object of the<a href="http://docs.unity3d.com/ScriptReference/AssetBundleManifest.html" target="_blank" rel="noopener"> AssetBundleManifest</a> type.</p>
<p>This Asset will be stored in an AssetBundle with the same name as the parent directory where the AssetBundles are being built. If a project builds its AssetBundles to a folder at (projectroot)/build/Client/, then the AssetBundle containing the manifest will be saved as (projectroot)/build/Client/Client.manifest.</p>
<p>The AssetBundle containing the manifest can be loaded, cached and unloaded just like any other AssetBundle.</p>
<p>The AssetBundleManifest Object itself provides the<a href="http://docs.unity3d.com/ScriptReference/AssetBundleManifest.GetAllAssetBundles.html" target="_blank" rel="noopener"> GetAllAssetBundles</a> API to list all AssetBundles built concurrently with the manifest and two methods to query the dependencies of a specific AssetBundle:</p>
<ul>
<li><p><a href="http://docs.unity3d.com/ScriptReference/AssetBundleManifest.GetAllDependencies.html" target="_blank" rel="noopener">AssetBundleManifest.GetAllDependencies</a> returns all of an AssetBundle’s hierarchical dependencies, which includes the dependencies of the AssetBundle’s direct children, its children’s children, etc.</p>
</li>
<li><p><a href="http://docs.unity3d.com/ScriptReference/AssetBundleManifest.GetDirectDependencies.html" target="_blank" rel="noopener">AssetBundleManifest.GetDirectDependencies</a> returns only an AssetBundle’s direct children</p>
</li>
</ul>
<p>Note that both of these APIs allocate string arrays. Accordingly, they should only be used sparingly, and not during performance-sensitive portions of an application’s lifetime.</p>
<h3 id="-23"><a href="#-23" class="headerlink" title=" "></a> </h3><p>4.4.4. Recommendations</p>
<p>In many cases, it is preferable to load as many needed Objects as possible before players enter performance-critical areas of an application, such as the main game level or world. This is particularly critical on mobile platforms, where access to local storage is slow and the memory churn of loading and unloading Objects at play-time can trigger the garbage collector.</p>
<p>For projects that must load and unload Objects while the application is interactive, see the<a href="https://unity3d.com/learn/tutorials/topics/best-practices/asset-bundle-usage-patterns#Managing_Loaded_Assets" target="_blank" rel="noopener"> </a>Managing loaded assets section of the AssetBundle usage patterns step for more information on unloading Objects and AssetBundles.</p>
<p></p>
<h2 id="5-AssetBundle-usage-patterns"><a href="#5-AssetBundle-usage-patterns" class="headerlink" title="5.AssetBundle usage patterns"></a>5.AssetBundle usage patterns</h2><p>The previous step in this series covered the<a href="https://unity3d.com/learn/tutorials/topics/best-practices/asset-bundle-fundamentals" target="_blank" rel="noopener"> </a>fundamentals of AssetBundles, which included the low-level behavior of various loading APIs. This chapter discusses problems and potential solutions to various aspects of using AssetBundles in practice.</p>
<h2 id="-24"><a href="#-24" class="headerlink" title=" "></a> </h2><p>5.1 Managing loaded Assets</p>
<p>It is critical to carefully control the size and number of loaded Objects in memory-sensitive environments. Unity does not automatically unload Objects when they are removed from the active scene. Asset cleanup is triggered at specific times, and it can also be triggered manually.</p>
<p>AssetBundles themselves must be carefully managed. An AssetBundle backed by a file on local storage (either in the Unity cache or one loaded via <a href="http://docs.unity3d.com/ScriptReference/AssetBundle.LoadFromFile.html" target="_blank" rel="noopener">AssetBundle.LoadFromFile</a>) has minimal memory overhead, rarely consuming more than a few dozen kilobytes. However, this overhead can still become problematic if a large number of AssetBundles are present.</p>
<p>As most projects allow users to re-experience content (such as replaying a level), it’s important to know when to load or unload an AssetBundle. If an AssetBundle is unloaded improperly, it can cause Object duplication in memory. Improperly unloading AssetBundles can also result in undesirable behavior in certain circumstances, such as causing textures to go missing. To understand why this can happen, refer to the Inter-Object references section of the Assets, Objects, and serialization step.</p>
<p>The most important thing to understand when managing assets and AssetBundles is the difference in behavior when calling <a href="http://docs.unity3d.com/ScriptReference/AssetBundle.Unload.html" target="_blank" rel="noopener">AssetBundle.Unload</a> with either true or false for the unloadAllLoadedObjects parameter.</p>
<p>This API will unload the header information of the AssetBundle being called. The unloadAllLoadedObjects parameter determines whether to also unload all Objects instantiated from this AssetBundle. If set to true, then all Objects originating from the AssetBundle will also be immediately unloaded – even if they are currently being used in the active scene.</p>
<p>For example, assume a material M was loaded from an AssetBundle AB, and assume M is currently in the active scene.</p>
<p><img src="assets/Assets,%20Resources%20and%20AssetBundles%20-%20Unity%20Le/76e89c67-741d-4b74-9356-fd72c187f4dc_ab2a.jpg" alt=""></p>
<p>If AssetBundle.Unload(true) is called, then M will be removed from the scene, destroyed and unloaded. However, if AssetBundle.Unload(false) is called, then AB’s header information will be unloaded but M will remain in the scene and will still be functional. Calling AssetBundle.Unload(false) breaks the link between M and AB. If AB is loaded again later, then fresh copies of the Objects contained in AB will be loaded into memory.</p>
<p><img src="assets/Assets,%20Resources%20and%20AssetBundles%20-%20Unity%20Le/f82652fb-5175-4b25-b362-bfdd8527a340_ab2b.jpg" alt=""></p>
<p>If AB is loaded again later, then a new copy of the AssetBundle’s header information will be reloaded. However, M was not loaded from this new copy of AB. Unity does not establish any link between the new copy of AB and M.</p>
<p><img src="assets/Assets,%20Resources%20and%20AssetBundles%20-%20Unity%20Le/9bad77ee-6cdd-4e5c-886d-dc02142e421d_ab2c.jpg" alt=""></p>
<p>If AssetBundle.LoadAsset() were called to reload M, Unity would not interpret the old copy of M as being an instance of the data in AB. Therefore, Unity will load a new copy of M and there will be two identical copies of M in the scene.</p>
<p><img src="assets/Assets,%20Resources%20and%20AssetBundles%20-%20Unity%20Le/e1119799-f21d-4d2f-a56a-550302752728_ab2d.jpg" alt=""></p>
<p>For most projects, this behavior is undesirable. Most projects should use AssetBundle.Unload(true) and adopt a method to ensure that Objects are not duplicated. Two common methods are:</p>
<ol>
<li>1. </li>
</ol>
<p>Having well-defined points during the application’s lifetime at which transient AssetBundles are unloaded, such as between levels or during a loading screen. This is the simpler and most common option.</p>
<ol>
<li>2. </li>
</ol>
<p>Maintaining reference-counts for individual Objects and unload AssetBundles only when all of their constituent Objects are unused. This permits an application to unload and reload individual Objects without duplicating memory.</p>
<p>If an application must use AssetBundle.Unload(false), then individual Objects can only be unloaded in two ways:</p>
<ol>
<li>1. </li>
</ol>
<p>Eliminate all references to an unwanted Object, both in the scene and in code. After this is done, call <a href="http://docs.unity3d.com/ScriptReference/Resources.UnloadUnusedAssets.html" target="_blank" rel="noopener">Resources.UnloadUnusedAssets</a>.</p>
<ol>
<li>2. </li>
</ol>
<p>Load a scene non-additively. This will destroy all Objects in the current scene and invoke <a href="http://docs.unity3d.com/ScriptReference/Resources.UnloadUnusedAssets.html" target="_blank" rel="noopener">Resources.UnloadUnusedAssets</a> automatically.</p>
<p>If a project has well-defined points where the user can be made to wait for Objects to load and unload, such as in between game modes or levels, these points should be used to unload as many Objects as necessary and to load new Objects.</p>
<p>The simplest way to do this is to package discrete chunks of a project into scenes, and then build those scenes into AssetBundles, along with all of their dependencies. The application can then enter a “loading” scene, fully unload the AssetBundle containing the old scene, and then load the AssetBundle containing the new scene.</p>
<p>While this is the simplest flow, some projects require more complex AssetBundle management. As every project is different, there is no universal AssetBundle design pattern.</p>
<p>When deciding how to group Objects into AssetBundles, it is generally best to start by bundling Objects into AssetBundles if they must be loaded or updated at the same time. For example, consider a role-playing game. Individual maps and cutscenes can be grouped into AssetBundles by scene, but some Objects will be needed in most scenes. AssetBundles could be built to provide portraits, the in-game UI, and different character models and textures. These latter Objects and Assets could then be grouped into a second set of AssetBundles that are loaded at startup and remain loaded for the lifetime of the app.</p>
<p>Another problem can arise if Unity must reload an Object from its AssetBundle after the AssetBundle has been unloaded. In this case, the reload will fail and the Object will appear in the Unity Editor’s hierarchy as a (Missing) Object.</p>
<p>This primarily occurs when Unity loses and regains control over its graphics context, such as when a mobile app is suspended or the user locks their PC. In this case, Unity must re-upload textures and shaders to the GPU. If the source AssetBundle for these assets is unavailable, the application will render Objects in the scene as magenta.</p>
<h2 id="-25"><a href="#-25" class="headerlink" title=" "></a> </h2><p>5.2. Distribution</p>
<p>There are two basic ways to distribute a project’s AssetBundles to clients: installing them simultaneously with the project or downloading them after installation.</p>
<p>The decision whether to ship AssetBundles within or after installation is driven by the capabilities and restrictions of the platforms on which the project will run. Mobile projects usually opt for post-install downloads to reduce initial install size and remain below over-the-air download size limits. Console and PC projects generally ship AssetBundles with their initial install.</p>
<p>Proper architecture permits patching new or revised content into your project post-install regardless of how the AssetBundles are delivered initially. For more information on this, see the <a href="https://docs.unity3d.com/Manual/AssetBundles-Patching.html" target="_blank" rel="noopener">Patching with AssetBundles</a> section of the Unity Manual.</p>
<h3 id="-26"><a href="#-26" class="headerlink" title=" "></a> </h3><p>5.2.1. Shipped with project</p>
<p>Shipping AssetBundles with the project is the simplest way to distribute them as it does not require additional download-management code. There are two major reasons why a project might include AssetBundles with the install:</p>
<ul>
<li><p>To reduce project build times and permit simpler iterative development. If these AssetBundles do not need to be updated separately from the application itself, then the AssetBundles can be included with the application by storing the AssetBundles in Streaming Assets. See the Streaming Assets section, below.</p>
</li>
<li><p>To ship an initial revision of updatable content. This is commonly done to save end-users time after their initial install or to serve as the basis for later patching. Streaming Assets is not ideal for this case. However, if writing a custom downloading and caching system is not an option, then an initial revision of updatable content can be loaded into the Unity cache from Streaming Assets (See the Cache Priming section, below).</p>
</li>
</ul>
<h4 id="-27"><a href="#-27" class="headerlink" title=" "></a> </h4><p>5.2.1.1. Streaming Assets</p>
<p>The easiest way to include any type of content, including AssetBundles, within a Unity application at install time is to build the content into the /Assets/StreamingAssets/ folder, prior to building the project. Anything contained in the StreamingAssets folder at build time will be copied into the final application.</p>
<p>The full path to the StreamingAssets folder on local storage is accessible via the property <a href="http://docs.unity3d.com/ScriptReference/Application-streamingAssetsPath.html" target="_blank" rel="noopener">Application.streamingAssetsPath</a> at runtime. The AssetBundles can then be loaded with via AssetBundle.LoadFromFile on most platforms.</p>
<p>Android Developers: On Android, assets in the StreamingAssets folders are stored into the APK and may take more time to load if they are compressed, as files stored in an APK can use different storage algorithms. The algorithm used may vary from one Unity version to another. You can use an archiver such as 7-zip to open the APK to determine if the files are compressed or not. If they are, you can expect AssetBundle.LoadFromFile() to perform more slowly. In this case, you can retrieve the cached version by using <a href="https://docs.unity3d.com/ScriptReference/Networking.UnityWebRequest.GetAssetBundle.html" target="_blank" rel="noopener">UnityWebRequest.GetAssetBundle</a> as a workaround. By using UnityWebRequest, the AssetBundle will be uncompressed and cached during the first run, allowing for following executions to be faster. Note that this will will take more storage space, as the AssetBundle will be copied to the cache. Alternatively, you can export your Gradle project and add an extension to your AssetBundles at build time. You can then edit the build.gradle file and add that extension to the noCompress section. Once done, you should be able to use AssetBundle.LoadFromFile() without having to pay the decompression performance cost.</p>
<p>Note: Streaming Assets is not a writable location on some platforms. If a project’s AssetBundles need to be updated after installation, either use WWW.LoadFromCacheOrDownload or write a custom downloader.</p>
<h3 id="-28"><a href="#-28" class="headerlink" title=" "></a> </h3><p>5.2.2. Downloaded post-install</p>
<p>The favored method of delivering AssetBundles to mobile devices is to download them after app installation. This also allows the content to be updated after installation without forcing users to re-download the entire application. On many platforms, application binaries must undergo an expensive and lengthy re-certification process. Therefore, developing a good system for post-install downloads is vital.</p>
<p>The simplest way to deliver AssetBundles is to place them on a web server and deliver them via UnityWebRequest. Unity will automatically cache downloaded AssetBundles on local storage. If the downloaded AssetBundle is LZMA compressed, the AssetBundle will be stored in the cache either as uncompressed or re-compressed as LZ4 (dependent on the <a href="https://docs.unity3d.com/ScriptReference/Caching-compressionEnabled.html" target="_blank" rel="noopener">Caching.compressionEnabled</a> setting), for faster loading in the future. If the downloaded bundle is LZ4 compressed, the AssetBundle will be stored compressed. If the cache fills up, Unity will remove the least recently used AssetBundle from the cache. See the Built-in caching section for more details.</p>
<p>It is generally recommended to start by using UnityWebRequest when possible, or WWW.LoadFromCacheOrDownload only if using Unity 5.2 or older. Only invest in a custom download system if the built-in APIs’ memory consumption, caching behavior or performance are unacceptable for a specific project, or if a project must run platform-specific code to achieve its requirements.</p>
<p>Examples of situations which may prevent the use of UnityWebRequest or WWW.LoadFromCacheOrDownload:</p>
<ul>
<li><p>When fine-grained control over the AssetBundle cache is required</p>
</li>
<li><p>When a project needs to implement a custom compression strategy</p>
</li>
<li><p>When a project wishes to use platform-specific APIs to satisfy certain requirements, such as the need to stream data while inactive.</p>
</li>
<li><p>Example: Using iOS’ Background Tasks API to download data while in the background.</p>
</li>
<li><p>When AssetBundles must be delivered over SSL on platforms where Unity does not have proper SSL support (such as PC).</p>
</li>
</ul>
<h3 id="-29"><a href="#-29" class="headerlink" title=" "></a> </h3><p>5.2.3. Built-in caching</p>
<p>Unity has a built-in AssetBundle caching system that can be used to cache AssetBundles downloaded via the UnityWebRequest API, which has an overload accepting an AssetBundle version number as an argument. This number is not stored inside the AssetBundle, and is not generated by the AssetBundle system.</p>
<p>The caching system keeps track of the last version number passed to UnityWebRequest. When this API is called with a version number, the caching system checks to see if there is a cached AssetBundle by comparing version numbers. If these numbers match, the system will load the cached AssetBundle. If the numbers do not match, or there is no cached AssetBundle, then Unity will download a new copy. This new copy will be associated with the new version number.</p>
<p>AssetBundles in the caching system are identified only by their file names, and not by the full URL from which they are downloaded. This means that an AssetBundle with the same file name can be stored in multiple different locations, such as a Content Delivery Network. As long as the file names are identical, the caching system will recognize them as the same AssetBundle.</p>
<p>It is up to each individual application to determine an appropriate strategy for assigning version numbers to AssetBundles, and to pass these numbers to UnityWebRequest. The numbers may come from a unique identifiers of sorts, such as a CRC value. Note that while AssetBundleManifest.GetAssetBundleHash() may also be used for this purpose, we don’t recommend this function for versioning, as it provides just an estimation, and not a true hash calculation).</p>
<p>See the <a href="https://docs.unity3d.com/Manual/AssetBundles-Patching.html" target="_blank" rel="noopener">Patching with AssetBundles</a> section of the Unity Manual for more details.</p>
<p>In Unity 2017.1 onward, the <a href="https://docs.unity3d.com/ScriptReference/Caching.html" target="_blank" rel="noopener">Caching</a> API has been extended to provide more granular control, by allow developers to select an active cache from multiple caches. Prior versions of Unity may only modify <a href="https://docs.unity3d.com/560/Documentation/ScriptReference/Caching-expirationDelay.html" target="_blank" rel="noopener">Caching.expirationDelay</a> and <a href="https://docs.unity3d.com/560/Documentation/ScriptReference/Caching-maximumAvailableDiskSpace.html" target="_blank" rel="noopener">Caching.maximumAvailableDiskSpace</a> to remove cached items (these properties remain in Unity 2017.1 in the <a href="https://docs.unity3d.com/ScriptReference/Cache.html" target="_blank" rel="noopener">Cache class</a>).</p>
<p><a href="http://docs.unity3d.com/ScriptReference/Caching-expirationDelay.html" target="_blank" rel="noopener">expirationDelay</a> is the minimum number of seconds that must elapse before an AssetBundle is automatically deleted. If an AssetBundle is not accessed during this time, it will be deleted automatically.</p>
<p><a href="http://docs.unity3d.com/ScriptReference/Caching-maximumAvailableDiskSpace.html" target="_blank" rel="noopener">maximumAvailableDiskSpace</a> specifies the amount of space on local storage, in bytes, that the cache may use before it begins deleting AssetBundles that have been used less recently than the expirationDelay. When the limit is reached, Unity will delete the AssetBundle in the cache which was least recently opened (or marked as used via Caching.MarkAsUsed). Unity will delete cached AssetBundles until there is sufficient space to complete the new download.</p>
<h4 id="-30"><a href="#-30" class="headerlink" title=" "></a> </h4><p>5.2.3.1. Cache Priming</p>
<p>Because AssetBundles are identified by their file names, it is possible to “prime” the cache with AssetBundles shipped with the application. To do this, store the initial or base version of each AssetBundle in /Assets/StreamingAssets/. The process is identical to the one detailed in the<a href="https://unity3d.com/learn/tutorials/temas/best-practices/assetbundle-usage-patterns?playlist=30089#Shipped_with_Project" target="_blank" rel="noopener"> </a>Shipped with project section.</p>
<p>The cache can be populated by loading AssetBundles from Application.streamingAssetsPath the first time the application is run. From then on, the application can call UnityWebRequest normally (UnityWebRequest can also be used to initially load AssetBundles from the StreamingAssets path as well).</p>
<h3 id="-31"><a href="#-31" class="headerlink" title=" "></a> </h3><p>5.2.3. Custom downloaders</p>
<p>Writing a custom downloader gives an application full control over how AssetBundles are downloaded, decompressed and stored. As the engineering work involved is non-trivial, we recommend this approach only for larger teams. There are four major considerations when writing a custom downloader:</p>
<ul>
<li><p>Download mechanism</p>
</li>
<li><p>Storage location</p>
</li>
<li><p>Compression type</p>
</li>
<li><p>Patching</p>
</li>
</ul>
<p>For information on patching AssetBundles, see the<a href="https://docs.unity3d.com/Manual/AssetBundles-Patching.html" target="_blank" rel="noopener"> Patching with AssetBundles</a> section of the Unity Manual.</p>
<h4 id="-32"><a href="#-32" class="headerlink" title=" "></a> </h4><p>5.2.3.1. Downloading</p>
<p>For most applications, HTTP is the simplest method to download AssetBundles. However, implementing an HTTP-based downloader is not the simplest task. Custom downloaders must avoid excessive memory allocations, excessive thread usage and excessive thread wakeups. Unity’s WWW class is unsuitable for reasons exhaustively described in the WWW.LoadFromCacheOrDownload section of the AssetBundle fundamentals step.</p>
<p>When writing a custom downloader, there are three options:</p>
<ul>
<li><p>C#’s HttpWebRequest and WebClient classes</p>
</li>
<li><p>Custom native plugins</p>
</li>
<li><p>Asset store packages</p>
</li>
</ul>
<p>5.2.3.1.1. C# classes</p>
<p>If an application does not require HTTPS/SSL support, C#’s <a href="https://msdn.microsoft.com/en-us/library/system.net.webclient%28v=vs.110%29.aspx" target="_blank" rel="noopener">WebClient</a> class provides the simplest possible mechanism for downloading AssetBundles. It is capable of asynchronously downloading any file directly to local storage without excessive managed memory allocation.</p>
<p>To download an AssetBundle with WebClient, allocate an instance of the class and pass it the URL of the AssetBundle to download and a destination path. If more control is required over the request’s parameters, it is possible to write a downloader using C#’s <a href="https://msdn.microsoft.com/en-us/library/system.net.httpwebrequest%28v=vs.90%29.aspx" target="_blank" rel="noopener">HttpWebRequest</a> class:</p>
<ol>
<li>1. </li>
</ol>
<p>Get a byte stream from HttpWebResponse.GetResponseStream.</p>
<ol>
<li>2. </li>
</ol>
<p>Allocate a fixed-size byte buffer on the stack.</p>
<ol>
<li>3. </li>
</ol>
<p>Read from the response stream into the buffer.</p>
<ol>
<li>4. </li>
</ol>
<p>Write the buffer to disk using C#’s File.IO APIs, or any other streaming IO system.</p>
<p>5.2.3.1.2. Asset Store Packages</p>
<p>Several asset store packages offer native-code implementations to download files via HTTP, HTTPS and other protocols. Before writing a custom native-code plugin for Unity, it is recommended to evaluate available Asset Store packages.</p>
<p>5.2.3.1.3. Custom Native Plugins</p>
<p>Writing a custom native plugin is the most time-intensive, but most flexible method for downloading data in Unity. Due to the high programming time requirements and high technical risk, this method is only recommended if no other method is capable of satisfying an application’s requirements. For example, a custom native plugin may be necessary if an application must use SSL communication on platforms without C# SSL support in Unity.</p>
<p>A custom native plugin will generally wrap a target platform’s native downloading APIs. Examples include <a href="https://developer.apple.com/library/ios/documentation/Cocoa/Reference/Foundation/Classes/NSURLConnection_Class/" target="_blank" rel="noopener">NSURLConnection</a> on iOS and <a href="http://download.java.net/jdk7/archive/b123/docs/api/java/net/HttpURLConnection.html" target="_blank" rel="noopener">java.net.HttpURLConnection</a> on Android. Consult each platform’s native documentation for further details on using these APIs.</p>
<h4 id="-33"><a href="#-33" class="headerlink" title=" "></a> </h4><p>5.2.3.2. Storage</p>
<p>On all platforms, Application.persistentDataPath points to a writable location that should be used for storing data that should persist between runs of an application. When writing a custom downloader, it is strongly recommended to use a subdirectory of Application.persistentDataPath to store downloaded data.</p>
<p>Application.streamingAssetPath is not writable and is a poor choice for an AssetBundle cache. Example locations for streamingAssetsPath include:</p>
<ul>
<li><p>OSX: Within .app package; not writable.</p>
</li>
<li><p>Windows: Within install directory (e.g. Program Files); usually not writable</p>
</li>
<li><p>iOS: Within .ipa package; not writable</p>
</li>
<li><p>Android: Within .apk file; not writable</p>
</li>
</ul>
<h2 id="-34"><a href="#-34" class="headerlink" title=" "></a> </h2><p>5.3. Asset Assignment Strategies</p>
<p>Deciding how to divide a project’s assets into AssetBundles is not simple. It is tempting to adopt a simplistic strategy, such as placing all Objects in their own AssetBundle or using only a single AssetBundle, but these solutions have significant drawbacks:</p>
<ul>
<li><p>Having too few AssetBundles…</p>
</li>
<li><p>Increases runtime memory usage</p>
</li>
<li><p>Increases loading times</p>
</li>
<li><p>Requires larger downloads</p>
</li>
<li><p>Having too many AssetBundles…</p>
</li>
<li><p>Increases build times</p>
</li>
<li><p>Can complicate development</p>
</li>
<li><p>Increases total download time</p>
</li>
</ul>
<p>The key decision is how to group Objects into AssetBundles. The primary strategies are:</p>
<ul>
<li><p>Logical entities</p>
</li>
<li><p>Object Types</p>
</li>
<li><p>Concurrent content</p>
</li>
</ul>
<p>More information about these grouping strategies can be found in the <a href="https://docs.unity3d.com/Manual/AssetBundles-Preparing.html" target="_blank" rel="noopener">Manual</a>.</p>
<h2 id="-35"><a href="#-35" class="headerlink" title=" "></a> </h2><p>5.4. Common pitfalls</p>
<p>This section describes several problems that commonly appear in projects using AssetBundles.</p>
<h3 id="-36"><a href="#-36" class="headerlink" title=" "></a> </h3><p>5.5.1. Asset duplication</p>
<p>Unity 5’s AssetBundle system will discover all dependencies of an Object when the Object is built into an AssetBundle. This dependency information is used to determine the set of Objects that will be included in an AssetBundle.</p>
<p>Objects that are explicitly assigned to an AssetBundle will only be built into that AssetBundle. An Object is “explicitly assigned” when that Object’s AssetImporter has its assetBundleName property set to a non-empty string. This can be done in the Unity Editor by selecting an AssetBundle in the Object’s Inspector, or from Editor scripts.</p>
<p>Objects can also be assigned to an AssetBundle by defining them as part of an <a href="https://docs.unity3d.com/ScriptReference/AssetBundleBuild.html" target="_blank" rel="noopener">AssetBundle building map</a>, which is to be used in conjunction with the overloaded <a href="https://docs.unity3d.com/ScriptReference/BuildPipeline.BuildAssetBundles.html" target="_blank" rel="noopener">BuildPipeline.BuildAssetBundles()</a> function that takes in an array of AssetBundleBuild.</p>
<p>Any Object that is not explicitly assigned in an AssetBundle will be included in all AssetBundles that contain 1 or more Objects that reference the untagged Object.</p>
<p>For example, if two different Objects are assigned to two different AssetBundles, but both have references to a common dependency Object, then that dependency Object will be copied into both AssetBundles. The duplicated dependency will also be instanced, meaning that the two copies of the dependency Object will be considered different Objects with a different identifiers. This will increase the total size of the application’s AssetBundles. This will also cause two different copies of the Object to be loaded into memory if the application loads both of its parents.</p>
<p>There are several ways to address this problem:</p>
<ol>
<li>1. </li>
</ol>
<p>Ensure that Objects built into different AssetBundles do not share dependencies. Any Objects which do share dependencies can be placed into the same AssetBundle without duplicating their dependencies.</p>
<ul>
<li>This method usually is not viable for projects with many shared dependencies. It produces monolithic AssetBundles that must be rebuilt and re-downloaded too frequently to be convenient or efficient.</li>
</ul>
<ol>
<li>1. </li>
</ol>
<p>Segment AssetBundles so that no two AssetBundles that share a dependency will be loaded at the same time.</p>
<ul>
<li>This method may work for certain types of projects, such as level-based games. However, it still unnecessarily increases the size of the project’s AssetBundles, and increases both build times and loading times.</li>
</ul>
<ol>
<li>1. </li>
</ol>
<p>Ensure that all dependency assets are built into their own AssetBundles. This entirely eliminates the risk of duplicated assets, but also introduces complexity. The application must track dependencies between AssetBundles, and ensure that the right AssetBundles are loaded before calling any AssetBundle.LoadAsset APIs.</p>
<p>Object dependencies are tracked via the AssetDatabase API, located in the UnityEditor namespace. As the namespace implies, this API is only available in the Unity Editor and not at runtime. AssetDatabase.GetDependencies can be used to locate all of the immediate dependencies of a specific Object or Asset. Note that these dependencies may have their own dependencies. Additionally, the AssetImporter API can be used to query the AssetBundle to which any specific Object is assigned.</p>
<p>By combining the AssetDatabase and AssetImporter APIs, it is possible to write an Editor script that ensures that all of an AssetBundle’s direct or indirect dependencies are assigned to AssetBundles, or that no two AssetBundles share dependencies that have not been assigned to an AssetBundle. Due to the memory cost of duplicating assets, it is recommended that all projects have such a script.</p>
<h3 id="-37"><a href="#-37" class="headerlink" title=" "></a> </h3><p>5.5.2. Sprite atlas duplication</p>
<p>Any automatically-generated sprite atlas will be assigned to the AssetBundle containing the Sprite Objects from which the sprite atlas was generated. If the sprite Objects are assigned to multiple AssetBundles, then the sprite atlas will not be assigned to an AssetBundle and will be duplicated. If the Sprite Objects are not assigned to an AssetBundle, then the sprite atlas will also not be assigned to an AssetBundle.</p>
<p>To ensure that sprite atlases are not duplicated, check that all sprites tagged into the same sprite atlas are assigned to the same AssetBundle.</p>
<p>Note that in Unity 5.2.2p3 and older, automatically-generated sprite atlases will never be assigned to an AssetBundle. Because of this, they will be included in any AssetBundles containing their constituent sprites and also any AssetBundles referencing their constituent sprites. Because of this problem, it is strongly recommended that all Unity 5 projects using Unity’s sprite packer upgrade to Unity 5.2.2p4, 5.3 or any newer version of Unity.</p>
<h3 id="-38"><a href="#-38" class="headerlink" title=" "></a> </h3><p>5.5.3. Android textures</p>
<p>Due to heavy device fragmentation in the Android ecosystem, it is often necessary to compress textures into several different formats. While all Android devices support ETC1, ETC1 does not support textures with alpha channels. Should an application not require OpenGL ES 2 support, the cleanest way to solve the problem is to use ETC2, which is supported by all Android OpenGL ES 3 devices.</p>
<p>Most applications need to ship on older devices where ETC2 support is unavailable. One way to solve this problem is with Unity 5’s AssetBundle Variants (refer to Unity’s Android optimization guide for details on other options).</p>
<p>To use AssetBundle Variants, all textures that cannot be cleanly compressed using ETC1 must be isolated into texture-only AssetBundles. Next, create sufficient variants of these AssetBundles to support the non-ETC2-capable slices of the Android ecosystem, using vendor-specific texture compression formats such as DXT5, PVRTC and ATITC. For each AssetBundle Variant, change the included textures’ TextureImporter settings to the compression format appropriate to the Variant.</p>
<p>At runtime, support for the different texture compression formats can be detected using the<a href="http://docs.unity3d.com/ScriptReference/SystemInfo.SupportsTextureFormat.html" target="_blank" rel="noopener"> SystemInfo.SupportsTextureFormat</a> API. This information should be used to select and load the AssetBundle Variant containing textures compressed in a supported format.</p>
<p>More information on Android texture compression formats can be found<a href="http://developer.android.com/guide/topics/graphics/opengl.html#textures" target="_blank" rel="noopener"> here</a>.</p>
<h3 id="-39"><a href="#-39" class="headerlink" title=" "></a> </h3><p>5.5.4. iOS file handle overuse</p>
<p>Current versions of Unity are not affected by this issue.</p>
<p>In versions prior to Unity 5.3.2p2, Unity would hold an open file handle to an AssetBundle the entire time that the AssetBundle is loaded. This is not a problem on most platforms. However, iOS limits the number of file handles a process may simultaneously have open to 255. If loading an AssetBundle causes this limit to be exceeded, the loading call will fail with a “Too Many Open File Handles” error.</p>
<p>This was a common problem for projects trying to divide their content across many hundreds or thousands of AssetBundles.</p>
<p>For projects unable to upgrade to a patched version of Unity, temporary solutions are:</p>
<ul>
<li><p>Reducing the number of AssetBundles in use by merging related AssetBundles</p>
</li>
<li><p>Using AssetBundle.Unload(false) to close an AssetBundle’s file handle, and managing the loaded Objects’ lifecycles manually</p>
</li>
</ul>
<h2 id="-40"><a href="#-40" class="headerlink" title=" "></a> </h2><p>5.5. AssetBundle Variants</p>
<p>A key feature of the AssetBundle system is the introduction of AssetBundle Variants. The purpose of Variants is to allow an application to adjust its content to better suit its runtime environment. Variants permit different UnityEngine.Objects in different AssetBundle files to appear as being the “same” Object when loading Objects and resolving Instance ID references. Conceptually, it permits two UnityEngine.Objects to appear to share the same File GUID &amp; Local ID, and identifies the actual UnityEngine.Object to load by a string Variant ID.</p>
<p>There are two primary use cases for this system:</p>
<ol>
<li>1. </li>
</ol>
<p>Variants simplify the loading of AssetBundles appropriate for a given platform.</p>
<ul>
<li>Example: A build system might create an AssetBundle containing high-resolution textures and complex shaders suitable for a standalone DirectX11 Windows build, and a second AssetBundle with lower-fidelity content intended for Android. At runtime, the project’s resource loading code can then load the appropriate AssetBundle Variant for its platform, and the Object names passed into the AssetBundle.Load API do not need to change.</li>
</ul>
<ol>
<li>1. </li>
</ol>
<p>Variants allow an application to load different content on the same platform, but with different hardware.</p>
<ul>
<li><p>This is key for supporting a wide range of mobile devices. An iPhone 4 is incapable of displaying the same fidelity of content as the latest iPhone in any real-world application.</p>
</li>
<li><p>On Android, AssetBundle Variants can be used to tackle the immense fragmentation of screen aspect ratios and DPIs between devices.</p>
</li>
</ul>
<h3 id="-41"><a href="#-41" class="headerlink" title=" "></a> </h3><p>5.5.1. Limitations</p>
<p>A key limitation of the AssetBundle Variant system is that it requires Variants to be built from distinct Assets. This limitation applies even if the only variations between those Assets is their import settings. If the only distinction between a texture built into Variant A and Variant B is the specific texture compression algorithm selected in the Unity texture importer, Variant A and Variant B must still be entirely different Assets. This means that Variant A and Variant B must be separate files on disk.</p>
<p>This limitation complicates the management of large projects as multiple copies of a specific Asset must be kept in source control. All copies of an Asset must be updated when developers wish to change the content of the Asset. There are no built-in workarounds for this problem.</p>
<p>Most teams implement their own form of AssetBundle Variants. This is done by building AssetBundles with well-defined suffixes appended to their filenames, in order to identify the specific variant a given AssetBundle represents. Custom code programmatically alters the importer settings of the included Assets when building these AssetBundles. Some developers have extended their custom systems to also be able to alter parameters on components attached to prefabs.</p>
<h2 id="-42"><a href="#-42" class="headerlink" title=" "></a> </h2><p>5.6. Compressed or uncompressed?</p>
<p>Whether to compress AssetBundles requires several important considerations, which include:</p>
<ul>
<li><p>Loading time: Uncompressed AssetBundles are much faster to load than compressed AssetBundles when loading from local storage or a local cache.</p>
</li>
<li><p>Build time: LZMA and LZ4 are very slow when compressing files, and the Unity Editor processes AssetBundles serially. Projects with a large number of AssetBundles will spend a lot of time compressing them.</p>
</li>
<li><p>Application size: If the AssetBundles are shipped in the application, compressing them will reduce the application’s total size. Alternatively, the AssetBundles can be downloaded post-install.</p>
</li>
<li><p>Memory usage: Prior to Unity 5.3, all of Unity’s decompression mechanisms required the entire compressed AssetBundle to be loaded into memory prior to decompression. If memory usage is important, use either uncompressed or LZ4 compressed AssetBundles.</p>
</li>
<li><p>Download time: Compression may only be necessary if the AssetBundles are large, or if users are in a bandwidth-constrained environment, such as downloading on low-speed or metered connections. If only a few tens of megabytes of data are being delivered to PCs on high-speed connections, it may be possible to omit compression.</p>
</li>
</ul>
<h4 id="-43"><a href="#-43" class="headerlink" title=" "></a> </h4><p>5.6.1. Crunch Compression</p>
<p>Bundles which consist primarily of DXT-compressed textures which use the Crunch compression algorithm should be built uncompressed.</p>
<h2 id="-44"><a href="#-44" class="headerlink" title=" "></a> </h2><p>5.7. AssetBundles and WebGL</p>
<p>All AssetBundle decompression and loading in a WebGL project must occur on the main thread, due to Unity’s WebGL export option not currently supporting worker threads. The downloading of AssetBundles is delegated to the browser using XMLHttpRequest. Once downloaded, compressed AssetBundles will be decompressed on Unity’s main thread, therefore stalling execution of the Unity content depending on the size of the bundle.</p>
<p>Unity recommends that developers prefer small asset bundles to avoid incurring performance issues. This approach will also be more memory efficient than using large asset bundles. Unity WebGL only supports LZ4-compressed and uncompressed asset bundles, however, it is possible to apply gzip/brotli compression on the bundles generated by Unity. In that case you will need to configure your web server accordingly so that the files are decompressed on download by the browser. See <a href="https://docs.unity3d.com/Manual/webgl-deploying.html" target="_blank" rel="noopener">here</a> for more details.</p>
<p>If you are using Unity 5.5 or older, consider avoiding LZMA for your AssetBundles and compress using LZ4 instead, which is decompressed very efficiently on-demand. Unity 5.6 removes LZMA as a compression option for the WebGL platform.</p>
<p></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/" rel="tag">Unity3D</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-Unity3D-Assembly-Definition-File-Package-Manager"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2023/07/25/Unity3D-Assembly-Definition-File-Package-Manager/"
    >Assembly Definition File &amp; Package Manager</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2023/07/25/Unity3D-Assembly-Definition-File-Package-Manager/" class="article-date">
  <time datetime="2023-07-25T12:56:23.213Z" itemprop="datePublished">2023-07-25</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Unity3D/">Unity3D</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p><a href="https://blog.csdn.net/weixin_34329187/article/details/86016256?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-6&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-6" target="_blank" rel="noopener">https://blog.csdn.net/weixin_34329187/article/details/86016256?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-6&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-6</a>&gt;</p>
<h2 id="Assembly-Definition-File-XXX-asmdef"><a href="#Assembly-Definition-File-XXX-asmdef" class="headerlink" title="Assembly Definition File(XXX.asmdef)"></a>Assembly Definition File(XXX.asmdef)</h2><blockquote>
<p>Unity 2017.3中的新功能<br> 使用该特性，开发者可以在一个文件夹中自定义托管程序集。定义明晰的依赖文件，可以确保脚本被更改后，只会重新生成必需的程序集，提高工作效率，减少编译时间。</p>
</blockquote>
<p>Unity自动定义脚本编译为 <strong>托管程序集</strong> 的方式。Unity编辑器中进行脚本更改迭代的编译时间会随脚本数量的增加而增加。<br>你可以使用新的 <strong>程序集定义文件特性</strong> ，基于文件夹中的脚本定义你自己的托管程序集。如果你将项目脚本分为多个程序集，并进行良好的依赖定义，可以确保你在 <strong>更改某个脚本时，只会重新生成必需的程序集。</strong> 这减少了编译时间，因此你可以在Unity项目中将 <strong>每个托管程序集看做是单个的库</strong> 。</p>
<p><img src="assets/Assembly%20Definition%20File%20&amp;%20Package%20Manager/0ba13fb88d2746f6bd2ed681d1324d8c.png" alt="Alt text"></p>
<h3 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h3><p>都是JSON文件，包含以下字段:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Field</th>
<th>Type  </th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>string  </td>
</tr>
<tr>
<td>references(optional)</td>
<td>string array  </td>
</tr>
<tr>
<td>includePlatforms(optional)</td>
<td>string array  </td>
</tr>
<tr>
<td>excludePlatforms(optional)</td>
<td>string array  </td>
</tr>
</tbody>
</table>
</div>
<p>字段includePlatforms和 excludePlatforms不能在同一个程序集定义文件中使用</p>
<h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><ul>
<li><p>将一个程序集定义文件添加到Unity项目中的一个文件夹里，对该文件夹里所有的脚本进行编译，然后在检视窗口中对程序集名称进行设置。</p>
</li>
<li><p>你还可以使用检视窗口添加对项目中其它程序集定义文件的引用。编译程序集和定义程序集间的依赖时会用到这些引用。</p>
</li>
<li><p>Unity使用引用来编译程序集，以及定义程序集之间的依赖关系。你可以在检视窗口中设置程序集定义文件的平台兼容性，也可以选择排除或包括特定平台。</p>
</li>
</ul>
<blockquote>
<p>假设你有一个Assets/ExampleFolder/MyLibrary.asmdef和一个Assets/ExampleFolder/ExampleFolder2/Utility.asmdef文件，那么：</p>
<ul>
<li><p>Assets &gt; ExampleFolder &gt; ExampleFolder2文件夹中的所有脚本将会被编译到Assets/ExampleFolder/ExampleFolder2/Utility.asmdef定义的程序集中。</p>
</li>
<li><p>Assets &gt; ExampleFolder文件夹中的所有脚本，除Assets &gt; ExampleFolder&gt; ExampleFolder2中的脚本之外，将会被编译到Assets/ExampleFolder/MyLibrary.asmdef定义的程序集中。</p>
</li>
</ul>
<p>程序集定义文件不属于程序集生成文件。它们不支持在生成系统中常见的条件化生成规则。这也是程序集定义文件不支持预处理指令（定义）的原因，因为它们一直是静态的。</p>
</blockquote>
<h3 id="向后兼容和隐式依赖"><a href="#向后兼容和隐式依赖" class="headerlink" title="向后兼容和隐式依赖"></a>向后兼容和隐式依赖</h3><p>程序集定义文件向后兼容Unity中现存的 <strong>[预定义编译系统]（Predefined Compilation System）</strong> 。<br><strong>预定义程序集</strong> 总是依赖于每个 <strong>程序集定义文件的程序集</strong> 。<br>这与Unity中 <strong>所有脚本</strong> 都依赖于所有和当前生成目标兼容的 <strong>预编译程序集</strong> （插件/.dll）的情况相似。</p>
<p><img src="assets/Assembly%20Definition%20File%20&amp;%20Package%20Manager/48350069f86f4fa59e4fdd25dbc6e399.png" alt="Alt text"></p>
<p>Unity给予程序集定义文件的优先级要比<a href="http://CompileOrderFolders" target="_blank" rel="noopener">预定义编译系统</a>高。<br>这意味着，任何来自程序集定义文件文件夹内的预定义编译的特殊文件夹名，都不会对编译产生任何影响。Unity只将它们视为常规文件夹。</p>
<blockquote>
<p>强烈建议你对项目中的所有脚本使用程序集定义文件，或完全不使用。否则，没有使用程序集定义文件的脚本会在每次程序集定义文件重新编译时也被重新编译。这会减少你在项目中程序集定义文件所带来的好处。</p>
</blockquote>
<h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><p>要获取平台名，可使用：<br><code>CompilationPipeline.GetAssemblyDefinitionPlatforms</code><br>在<code>UnityEditor.Compilation</code>命名空间中，有一个静态的<code>CompilationPipeline</code>类，你可用它获取程序集定义文件以及所有由Unity生成的程序集的信息。</p>
<h2 id="Package-Manager"><a href="#Package-Manager" class="headerlink" title="Package Manager"></a>Package Manager</h2><p>一个包是一个容器，它可以包含各种资源的组合：shader、纹理、插件、图标、脚本等，可以增强项目的各个部分。</p>
<blockquote>
<p>优点：相对于Asset Store的包，Package Manager提供了更新，更容易集成的包管理方案，能够为Unity提供各种增强功能。</p>
</blockquote>
<h3 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h3><p>Window &gt; Package Manager 查看，安装，删除，更新<br>官方包名称会以 com.unity开头<br>一些包在版本号旁边显示标签。这些标签传达有关该包版本的信息。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>标签</th>
<th>含义  </th>
</tr>
</thead>
<tbody>
<tr>
<td>verified</td>
<td>Unity的质量保证团队已正式确认此包可与编辑器的特定版本配合使用。  </td>
</tr>
<tr>
<td>preview</td>
<td>该包处于发布周期的早期阶段，可能尚未被开发团队或Unity的质量保证团队记录和完全验证。  </td>
</tr>
</tbody>
</table>
</div>
<h3 id="package-manifest-file包清单文件"><a href="#package-manifest-file包清单文件" class="headerlink" title="package manifest file包清单文件"></a>package manifest file包清单文件</h3><h4 id="project-manifests-manifest-json"><a href="#project-manifests-manifest-json" class="headerlink" title="project manifests: manifest.json"></a>project manifests: manifest.json</h4><p>tell the Package Manager which packages and versions are available to the project.</p>
<h4 id="package-manifests-package-json"><a href="#package-manifests-package-json" class="headerlink" title="package manifests: package.json"></a>package manifests: package.json</h4><p>determine which version of the package to load, and what information to display in the Package Manager window.</p>
<blockquote>
<p>name必须纯小写，否则是invalid</p>
</blockquote>
<pre><code class="lang-csharp">
{ 

&quot;name&quot;: &quot;com.unity.package-4&quot;, 

&quot;displayName&quot;: &quot;Package Number 4&quot;, 

&quot;version&quot;: &quot;2.5.1&quot;, 

&quot;unity&quot;: &quot;2018.1&quot;, 

&quot;description&quot;: &quot;This package provides X, Y, and Z. \n\nTo find out more, click the \&quot;View Documentation\&quot; link.&quot;, 

&quot;keywords&quot;: [&quot;key X&quot;, &quot;key Y&quot;, &quot;key Z&quot;], 

&quot;category&quot;: &quot;Controllers&quot;, 

&quot;dependencies&quot;: { 

&quot;com.unity.package-1&quot;: &quot;1.0.0&quot;, 

&quot;com.unity.package-2&quot;: &quot;2.0.0&quot;, 

&quot;com.unity.package-3&quot;: &quot;3.0.0&quot;

} 

}
</code></pre>
<h3 id="The-Package-Registry"><a href="#The-Package-Registry" class="headerlink" title="The Package Registry"></a>The Package Registry</h3><p>Unity maintains a central registry of official packages that are available for distribution(可供分发的官方包的中央注册表。). When Unity loads, the Package Manager communicates with the registry, checks the project manifest file, and displays the status of each available package in the Package Manager window.</p>
<p>When you remove a package from the project, the Package Manager updates the project manifest to exclude that package from the list in In Project mode but it is still available in All mode because it is still on the registry.</p>
<p>When you install or update a package, the Package Manager downloads the package from the registry.</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/" rel="tag">Unity3D</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-Unity3D-An-introduction-to-IL2CPP-internalsВведение-в"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2023/07/25/Unity3D-An-introduction-to-IL2CPP-internals%D0%92%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B2/"
    >An introduction to IL2CPP internalsВведение в</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2023/07/25/Unity3D-An-introduction-to-IL2CPP-internals%D0%92%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B2/" class="article-date">
  <time datetime="2023-07-25T12:56:23.212Z" itemprop="datePublished">2023-07-25</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Unity3D/">Unity3D</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p> IL2CPP - Unity Technologies Blog</p>
<h1 id="An-introduction-to-IL2CPP-internals"><a href="#An-introduction-to-IL2CPP-internals" class="headerlink" title="An introduction to IL2CPP internals"></a>An introduction to IL2CPP internals</h1><p><a href="https://blogs.unity3d.com/author/josh/" target="_blank" rel="noopener" title="Posts by Josh Peterson">Josh Peterson</a>, May 6, 2015</p>
<p><a href="https://blogs.unity3d.com/category/technology/" target="_blank" rel="noopener">Technology</a></p>
<p><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fblogs.unity3d.com%2F2015%2F05%2F06%2Fan-introduction-to-ilcpp-internals%2F" target="_blank" rel="noopener"><br><img src="data:image/svg+xml,%3csvg xmlns=&#39;http://www.w3.org/2000/svg&#39; version=&#39;1.1&#39; x=&#39;0&#39; y=&#39;0&#39; width=&#39;470.5&#39; height=&#39;470.5&#39; viewBox=&#39;0 0 470.5 470.5&#39; xml:space=&#39;preserve&#39; fill=&#39;rgb\(0%2c 0%2c 0\" alt=""><br>‘ data-evernote-id=’278’ class=’js-evernote-checked’%3e%3cstyle data-evernote-id=’279’ class=’js-evernote-checked’%3e.s0 %7b fill: rgb(0%2c 0%2c 0)%3b %7d%3c/style%3e %3cpath d=’M271.5 154.2v-40.5c0-6.1 0.3-10.8 0.8-14.1 0.6-3.3 1.9-6.6 3.9-9.9 2-3.2 5.2-5.5 9.7-6.7 4.5-1.2 10.4-1.9 17.9-1.9h40.5V0h-64.8c-37.5 0-64.4 8.9-80.8 26.7 -16.4 17.8-24.6 44-24.6 78.7v48.8h-48.5v81.1h48.5v235.3h97.4V235.3h64.8l8.6-81.1H271.5z’ fill=’rgb(0%2c 0%2c 0)‘ data-evernote-id=’280’ class=’js-evernote-checked’%3e%3c/path%3e%3c/svg%3e) </a><a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fblogs.unity3d.com%2F2015%2F05%2F06%2Fan-introduction-to-ilcpp-internals%2F&amp;text=An+introduction+to+IL2CPP+internals&amp;via=unity3d" target="_blank" rel="noopener"><br><img src="data:image/svg+xml,%3csvg xmlns=&#39;http://www.w3.org/2000/svg&#39; version=&#39;1.1&#39; x=&#39;0&#39; y=&#39;0&#39; width=&#39;450&#39; height=&#39;450&#39; viewBox=&#39;0 0 450 450&#39; xml:space=&#39;preserve&#39; fill=&#39;rgb\(0%2c 0%2c 0\" alt=""><br>‘ data-evernote-id=’282’ class=’js-evernote-checked’%3e%3cstyle data-evernote-id=’283’ class=’js-evernote-checked’%3e.s0 %7b fill: rgb(0%2c 0%2c 0)%3b %7d%3c/style%3e %3cpath d=’M450 85.7c-17.7 7.6-35.4 12.4-53.1 14.3 20-12 33.5-28.9 40.5-50.8 -18.3 10.8-37.8 18.3-58.5 22.3 -18.3-19.4-40.7-29.1-67.4-29.1 -25.5 0-47.2 9-65.2 27 -18 18-27 39.7-27 65.2 0 6.9 0.8 13.9 2.3 21.1 -37.7-1.9-73-11.4-106.1-28.4C82.5 110.2 54.4 87.5 31.4 59.1c-8.4 14.3-12.6 29.8-12.6 46.5 0 15.8 3.7 30.5 11.1 44 7.4 13.5 17.4 24.5 30 32.8 -14.8-0.6-28.7-4.5-41.7-11.7v1.1c0 22.3 7 41.8 21 58.7 14 16.8 31.6 27.5 53 31.8 -8 2.1-16.1 3.1-24.3 3.1 -5.3 0-11.1-0.5-17.4-1.4 5.9 18.5 16.8 33.6 32.5 45.5 15.8 11.9 33.7 18 53.7 18.4 -33.5 26.3-71.7 39.4-114.5 39.4 -8.2 0-15.6-0.4-22.3-1.1 42.8 27.6 90 41.4 141.6 41.4 32.7 0 63.5-5.2 92.2-15.6 28.7-10.4 53.3-24.3 73.7-41.7 20.4-17.4 37.9-37.4 52.7-60.1 14.8-22.7 25.7-46.3 33-70.9 7.2-24.7 10.8-49.3 10.8-74.1 0-5.3-0.1-9.3-0.3-12C421.8 120.2 437.2 104.3 450 85.7z’ fill=’rgb(0%2c 0%2c 0)‘ data-evernote-id=’284’ class=’js-evernote-checked’%3e%3c/path%3e%3c/svg%3e) </a><a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fblogs.unity3d.com%2F2015%2F05%2F06%2Fan-introduction-to-ilcpp-internals%2F&amp;title=An+introduction+to+IL2CPP+internals&amp;summary=Almost+a+year+ago+now%2C+we+started+to+talk+about+the+future+of+scripting+in+Unity.+The+new+IL2CPP+scripting+backend+promised+to+bring+a+highly-performant%2C+highly-portable+virtual+machine+to+Unity.+In+January%2C+we+shipped+our+first+platform+using+IL2CPP%2C+iOS+64-bit.+The+Unity+5+release+brought+another+platform%2C+WebGL.+Thanks+to+the+input+from+%5B%26hellip%3B%5D&amp;source=Unity3d+Blog" target="_blank" rel="noopener"><br><img src="data:image/svg+xml,%3csvg xmlns=&#39;http://www.w3.org/2000/svg&#39; version=&#39;1.1&#39; x=&#39;0&#39; y=&#39;0&#39; width=&#39;438.5&#39; height=&#39;438.5&#39; viewBox=&#39;0 0 438.5 438.5&#39; xml:space=&#39;preserve&#39; fill=&#39;rgb\(0%2c 0%2c 0\" alt=""><br>‘ data-evernote-id=’286’ class=’js-evernote-checked’%3e%3cstyle data-evernote-id=’287’ class=’js-evernote-checked’%3e.s0 %7b fill: rgb(0%2c 0%2c 0)%3b %7d%3c/style%3e %3crect x=’5.4’ y=’145.9’ width=’94.2’ height=’282.9’ fill=’rgb(0%2c 0%2c 0)‘ data-evernote-id=’288’ class=’js-evernote-checked’%3e%3c/rect%3e %3cpath d=’M408.8 171.7c-19.8-21.6-46-32.4-78.5-32.4 -12 0-22.9 1.5-32.7 4.4 -9.8 3-18.1 7.1-24.8 12.4 -6.8 5.3-12.1 10.3-16.1 14.8 -3.8 4.3-7.5 9.4-11.1 15.1v-40.2h-93.9l0.3 13.7c0.2 9.1 0.3 37.3 0.3 84.5 0 47.2-0.2 108.8-0.6 184.7h93.9V270.9c0-9.7 1-17.4 3.1-23.1 4-9.7 10-17.8 18.1-24.4 8.1-6.6 18.1-9.9 30.1-9.9 16.4 0 28.4 5.7 36.1 17 7.7 11.3 11.6 27 11.6 47V428.8h93.9V266.7C438.5 225 428.6 193.3 408.8 171.7zM53.1 9.7c-15.8 0-28.6 4.6-38.4 13.8C4.9 32.8 0 44.4 0 58.5c0 13.9 4.8 25.5 14.3 34.8 9.5 9.3 22.1 14 37.7 14h0.6c16 0 28.9-4.7 38.7-14 9.8-9.3 14.6-20.9 14.4-34.8 -0.2-14.1-5-25.7-14.6-35C81.6 14.3 68.9 9.7 53.1 9.7z’ fill=’rgb(0%2c 0%2c 0)‘ data-evernote-id=’289’ class=’js-evernote-checked’%3e%3c/path%3e%3c/svg%3e) </a></p>
<p>Almost a year ago now, we started to talk about the <a href="http://blogs.unity3d.com/2014/05/20/the-future-of-scripting-in-unity/" target="_blank" rel="noopener">future</a> of scripting in Unity. The new IL2CPP scripting backend promised to bring a highly-performant, highly-portable virtual machine to Unity. In January, we shipped our first platform using IL2CPP, <a href="http://blogs.unity3d.com/2015/01/29/unity-4-6-2-ios-64-bit-support/" target="_blank" rel="noopener">iOS 64-bit</a>. The Unity 5 release brought another platform, <a href="http://blogs.unity3d.com/2014/04/29/on-the-future-of-web-publishing-in-unity/" target="_blank" rel="noopener">WebGL</a>. Thanks to the input from our tremendous community of users, we have shipped many patch release <a href="http://blogs.unity3d.com/2015/04/07/weekly-ios-64-bit-and-metal-update/" target="_blank" rel="noopener">updates</a> for IL2CPP, steadily improving its compiler and runtime.</p>
<p>We have no plans to stop improving IL2CPP, but we thought it might be a good idea to take a step back and tell you a little bit about how IL2CPP works from the inside out. Over the next few months, we’re planning to write about the following topics (and maybe others) in this IL2CPP Internals series of posts:</p>
<ol>
<li>The basics – toolchain and command line arguments (this post)</li>
<li><a href="http://blogs.unity3d.com/2015/05/13/il2cpp-internals-a-tour-of-generated-code/" target="_blank" rel="noopener">A tour of generated code</a></li>
<li><a href="http://blogs.unity3d.com/2015/05/20/il2cpp-internals-debugging-tips-for-generated-code/" target="_blank" rel="noopener">Debugging tips for generated code</a></li>
<li><a href="http://blogs.unity3d.com/2015/06/03/il2cpp-internals-method-calls/" target="_blank" rel="noopener">Method calls</a> (normal methods, virtual methods, etc.)</li>
<li><a href="http://blogs.unity3d.com/2015/06/16/il2cpp-internals-generic-sharing-implementation" target="_blank" rel="noopener">Generic sharing implementation</a></li>
<li><a href="http://blogs.unity3d.com/2015/07/02/il2cpp-internals-pinvoke-wrappers/" target="_blank" rel="noopener">P/invoke wrappers for types and methods</a></li>
<li><a href="http://blogs.unity3d.com/2015/07/09/il2cpp-internals-garbage-collector-integration/" target="_blank" rel="noopener">Garbage collection integration</a></li>
<li><a href="http://blogs.unity3d.com/2015/07/20/il2cpp-internals-testing-frameworks/" target="_blank" rel="noopener">Testing frameworks and usage</a></li>
</ol>
<p>In order to make this series of posts possible, we’re going to discuss some details about the IL2CPP implementation that will surely change in the future. Hopefully we can still provide some useful and interesting information.</p>
<p><strong>What is IL2CPP?</strong></p>
<p>The technology that we refer to as IL2CPP has two distinct parts.</p>
<ul>
<li>•An ahead-of-time (AOT) compiler</li>
<li>•A runtime library to support the virtual machine</li>
</ul>
<p>The AOT compiler translates Intermediate Language (IL), the low-level output from .NET compilers, to C++ source code. The runtime library provides services and abstractions like a garbage collector, platform-independent access to threads and files, and implementations of internal calls (native code which modifies managed data structures directly).</p>
<p><strong>The AOT compiler</strong></p>
<p>The IL2CPP AOT compiler is named il2cpp.exe. On Windows you can find it in the Editor\Data\il2cpp directory. On OSX it is in the Contents/Frameworks/il2cpp/build directory in the Unity installation. The il2cpp.exe utility is a managed executable, written entirely in C#. We compile it with both .NET and Mono compilers during our development of IL2CPP.</p>
<p>The il2cpp.exe utility accepts managed assemblies compiled with the Mono compiler that ships with Unity and generates C++ code which we pass on to a platform-specific C++ compiler.</p>
<p>You can think about the IL2CPP toolchain like this:</p>
<p><a href="https://blogs.unity3d.com/wp-content/uploads/2015/04/il2cpp-toolchain-smaller.png" target="_blank" rel="noopener"><br><img src="assets/An%20introduction%20to%20IL2CPP%20internalsВведение%20в/il2cpp-toolchain-smaller.png" alt="">
</a></p>
<p><strong>The runtime library</strong></p>
<p>The other part of the IL2CPP technology is a runtime library to support the virtual machine. We have implemented this library using almost entirely C++ code (it has a little bit of platform-specific assembly code, but let’s keep that between the two of us). We call the runtime library libil2cpp, and it is shipped as a static library linked into the player executable. One of the key benefits of the IL2CPP technology is this simple and portable runtime library.</p>
<p>You can find some clues about how the libil2cpp code is organized by looking at the header files for libil2cpp we ship with Unity (you’ll find them in the Editor\Data\PlaybackEngines\webglsupport\BuildTools\Libraries\libil2cpp\include directory on Windows, or the Contents/Frameworks/il2cpp/libil2cpp directory on OSX). For example, the interface between the C++ code generated by il2cpp.exe and the libil2cpp runtime is located in the codegen/il2cpp-codegen.h header file.</p>
<p>One key part of the runtime is the garbage collector. We’re shipping Unity 5 with <a href="https://github.com/ivmai/bdwgc/" target="_blank" rel="noopener">libgc</a>, the Boehm-Demers-Weiser garbage collector. However, libil2cpp has been designed to allow us to use other garbage collectors. For example, we are researching an integration of the Microsoft GC which was open-sourced as part of the CoreCLR. We’ll have more to say about this in our post about garbage collector integration later in the series.</p>
<p><strong>How is il2cpp.exe executed?</strong></p>
<p>Let’s take a look at an example. I’ll be using Unity 5.0.1 on Windows, and I’ll start with a new, empty project. So that we have at least one user script to convert, I’ll add this simple MonoBehaviour component to the Main Camera game object:</p>
<p>1</p>
<p>2</p>
<p>3</p>
<p>4</p>
<p>5</p>
<p>6</p>
<p>7</p>
<p>| </p>
<p>using UnityEngine;</p>
<p>public class HelloWorld : MonoBehaviour {</p>
<p>void Start () {</p>
<p>Debug.Log(“Hello, IL2CPP!”);</p>
<p>}</p>
<p>}  </p>
<p>—-|—-  </p>
<p>When I build for the WebGL platform, I can use <a href="https://technet.microsoft.com/en-us/sysinternals/bb896653.aspx" target="_blank" rel="noopener">Process Explorer</a> to see the command line Unity used to run il2cpp.exe:</p>
<p>1</p>
<p>| </p>
<p>“C:\Program Files\Unity\Editor\Data\MonoBleedingEdge\bin\mono.exe” “C:\Program Files\Unity\Editor\Data\il2cpp/il2cpp.exe” --copy-level=None --enable-generic-sharing --enable-unity-event-support --output-format=Compact --extra-types.file=”C:\Program Files\Unity\Editor\Data\il2cpp\il2cpp_default_extra_types.txt” “C:\Users\Josh Peterson\Documents\IL2CPP Blog Example\Temp\StagingArea\Data\Managed\Assembly-CSharp.dll” “C:\Users\Josh Peterson\Documents\IL2CPP Blog Example\Temp\StagingArea\Data\Managed\UnityEngine.UI.dll” “C:\Users\Josh Peterson\Documents\IL2CPP Blog Example\Temp\StagingArea\Data\il2cppOutput”  </p>
<p>—-|—-  </p>
<p>That command line is pretty long and horrible, so let’s unpack it. First, Unity is running this executable:</p>
<p>1</p>
<p>| </p>
<p>“C:\Program Files\Unity\Editor\Data\MonoBleedingEdge\bin\mono.exe”  </p>
<p>—-|—-  </p>
<p>The next argument on the command line is the il2cpp.exe utility itself.</p>
<p>1</p>
<p>| </p>
<p>“C:\Program Files\Unity\Editor\Data\il2cpp/il2cpp.exe”  </p>
<p>—-|—-  </p>
<p>The remaining command line arguments are passed to il2cpp.exe, not mono.exe. Let’s look at them. First, Unity passes five flags to il2cpp.exe:</p>
<ul>
<li>•–copy-level=None <ul>
<li>Specify that il2cpp.exe should not perform an special file copies of the generated C++ code.</li>
</ul>
</li>
<li>•–enable-generic-sharing <ul>
<li>This is a code and binary size reduction feature. IL2CPP will share the implementation of generic methods when it can.</li>
</ul>
</li>
<li>•–enable-unity-event-support <ul>
<li>Special support to ensure that code for Unity events, which are accessed via reflection, is correctly generated.</li>
</ul>
</li>
<li>•–output-format=Compact <ul>
<li>Generate C++ code in a format that requires fewer characters for type and method names. This code is difficult to debug, since the names in the IL code are not preserved, but it often compiles faster, since there is less code for the C++ compiler to parse.</li>
</ul>
</li>
<li>•–extra-types.file=”C:\Program Files\Unity\Editor\Data\il2cpp\il2cpp_default_extra_types.txt” <ul>
<li>Use the default (and empty) extra types file. This file can be added in a Unity project to let il2cpp.exe know which generic or array types will be created at runtime, but are not present in the IL code.</li>
</ul>
</li>
</ul>
<p>It is important to note that these command line arguments can and will be changed in later releases. We’re not at a point yet where we have a stable and supported set of command line arguments for il2cpp.exe.</p>
<p>Finally, we have a list of two files and one directory on the command line:</p>
<ul>
<li>•“C:\Users\Josh Peterson\Documents\IL2CPP Blog Example\Temp\StagingArea\Data\Managed\Assembly-CSharp.dll”</li>
<li>•“C:\Users\Josh Peterson\Documents\IL2CPP Blog Example\Temp\StagingArea\Data\Managed\UnityEngine.UI.dll”</li>
<li>•“C:\Users\Josh Peterson\Documents\IL2CPP Blog Example\Temp\StagingArea\Data\il2cppOutput”</li>
</ul>
<p>The il2cpp.exe utility accepts a list of all of the IL assemblies it should convert. In this case they are the assembly containing my simple MonoBehaviour, Assembly-CSharp.dll, and the GUI assembly, UnityEngine.UI.dll. Note that there are a few conspicuously missing assembles here. Clearly, my script references UnityEngine.dll, and that references at least mscorlib.dll, and maybe other assemblies. Where are they? Actually, il2cpp.exe resolves those assemblies internally. They can be mentioned on the command line, but they are not necessary. Unity only needs to mention the root assemblies (those which are not referenced by any other assembly) explicitly.</p>
<p>The last argument on the il2cpp.exe command line is the directory where the output C++ files should be created. If you are curious, have a look at the generated files in that directory, they will be the subject of the next post in this series. Before you do though, you might want to choose the “Development Player” option in the WebGL build settings. That will remove the –output-format=Compact command line argument and give you better type and method names in the generated C++ code.</p>
<p>Try changing various options in the WebGL or iOS Player Settings. You should be able to see different command line options passed to il2cpp.exe to enable different code generation steps. For example, changing the “Enable Exceptions” setting in the WebGL Player Settings to a value of “Full” adds the –emit-null-checks, –enable-stacktrace, and –enable-array-bounds-check arguments to the il2cpp.exe command line.</p>
<p><strong>What does IL2CPP not do?</strong></p>
<p>I’d like to point out one of the challenges that we did not take on with IL2CPP, and we could not be happier that we ignored it. We did not attempt to re-write the C# standard library with IL2CPP. When you build a Unity project which uses the IL2CPP scripting backend, all of the C# standard library code in mscorlib.dll, System.dll, etc. is the exact same code used for the Mono scripting backend.</p>
<p>We rely on C# standard library code that is already well-known by users and well-tested in Unity projects. So when we investigate a bug related to IL2CPP, we can be fairly confident that the bug is in either the AOT compiler or the runtime library, and nowhere else.</p>
<p><strong>How we develop, test, and ship IL2CPP</strong></p>
<p>Since the initial public release of IL2CPP at version 4.6.1p5 in January, we’ve shipped 6 full releases and 7 patch releases (across versions 4.6 and 5.0 of Unity). We have corrected more than 100 bugs mentioned in the release notes.</p>
<p>In order to make this continuous improvement happen, we develop against only one version of the IL2CPP code internally, which sits on the bleeding edge of the trunk branch in Unity used to ship alpha and beta releases. Just before each release, we port the IL2CPP changes to the specific release branch, run our tests, and verify all of the bugs we fixed are corrected in that version. Our QA and Sustained Engineering teams have done incredible work to make delivery at this rate possible. This means that our users are never more than about one week away from the latest fixes for IL2CPP bugs.</p>
<p>Our user community has proven invaluable by submitting many high quality bug reports. We appreciate all the feedback from our users to help continually improve IL2CPP, and we look forward to more of it.</p>
<p>The development team working on IL2CPP has a strong test-first mentality. We often employee Test Driven Design practices, and seldom merge a pull request without good tests. This strategy works well for a technology like IL2CPP, where we have clear inputs and outputs. It means that the vast majority of the bugs we see are not unexpected behavior, but rather unexpected cases (e.g. it is possible to use an 64-bit IntPtr as a 32-bit array index, causing clang to fail with a C++ compiler error, and <a href="http://forum.unity3d.com/threads/4-6-3-il2cpp-xcode-build-errors.299561/" target="_blank" rel="noopener">real code</a> actually does this!). That difference allows us to fix bugs quickly with a high degree of confidence.</p>
<p>With the help of our community, we’re working hard to make IL2CPP as stable and fast as possible. By the way, if any of this excites you, <a href="http://unity3d.com/jobs/position?id=oWfh0fwc" target="_blank" rel="noopener">we’re hiring</a> (just sayin’).</p>
<p><strong>More to come</strong></p>
<p>I fear that I’ve spent too much time here teasing future blog posts. We have a lot to say, and it simply won’t all fit in one post. Next time, we’ll dig into the code generated by il2cpp.exe to see how your project actually looks to the C++ compiler.</p>
<p><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fblogs.unity3d.com%2F2015%2F05%2F06%2Fan-introduction-to-ilcpp-internals%2F" target="_blank" rel="noopener"><br><img src="data:image/svg+xml,%3csvg xmlns=&#39;http://www.w3.org/2000/svg&#39; version=&#39;1.1&#39; x=&#39;0&#39; y=&#39;0&#39; width=&#39;470.5&#39; height=&#39;470.5&#39; viewBox=&#39;0 0 470.5 470.5&#39; xml:space=&#39;preserve&#39; fill=&#39;rgb\(0%2c 0%2c 0\" alt=""><br>‘ data-evernote-id=’599’ class=’js-evernote-checked’%3e%3cstyle data-evernote-id=’600’ class=’js-evernote-checked’%3e.s0 %7b fill: rgb(0%2c 0%2c 0)%3b %7d%3c/style%3e %3cpath d=’M271.5 154.2v-40.5c0-6.1 0.3-10.8 0.8-14.1 0.6-3.3 1.9-6.6 3.9-9.9 2-3.2 5.2-5.5 9.7-6.7 4.5-1.2 10.4-1.9 17.9-1.9h40.5V0h-64.8c-37.5 0-64.4 8.9-80.8 26.7 -16.4 17.8-24.6 44-24.6 78.7v48.8h-48.5v81.1h48.5v235.3h97.4V235.3h64.8l8.6-81.1H271.5z’ fill=’rgb(0%2c 0%2c 0)‘ data-evernote-id=’601’ class=’js-evernote-checked’%3e%3c/path%3e%3c/svg%3e) </a><a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fblogs.unity3d.com%2F2015%2F05%2F06%2Fan-introduction-to-ilcpp-internals%2F&amp;text=An+introduction+to+IL2CPP+internals&amp;via=unity3d" target="_blank" rel="noopener"><br><img src="data:image/svg+xml,%3csvg xmlns=&#39;http://www.w3.org/2000/svg&#39; version=&#39;1.1&#39; x=&#39;0&#39; y=&#39;0&#39; width=&#39;450&#39; height=&#39;450&#39; viewBox=&#39;0 0 450 450&#39; xml:space=&#39;preserve&#39; fill=&#39;rgb\(0%2c 0%2c 0\" alt=""><br>‘ data-evernote-id=’603’ class=’js-evernote-checked’%3e%3cstyle data-evernote-id=’604’ class=’js-evernote-checked’%3e.s0 %7b fill: rgb(0%2c 0%2c 0)%3b %7d%3c/style%3e %3cpath d=’M450 85.7c-17.7 7.6-35.4 12.4-53.1 14.3 20-12 33.5-28.9 40.5-50.8 -18.3 10.8-37.8 18.3-58.5 22.3 -18.3-19.4-40.7-29.1-67.4-29.1 -25.5 0-47.2 9-65.2 27 -18 18-27 39.7-27 65.2 0 6.9 0.8 13.9 2.3 21.1 -37.7-1.9-73-11.4-106.1-28.4C82.5 110.2 54.4 87.5 31.4 59.1c-8.4 14.3-12.6 29.8-12.6 46.5 0 15.8 3.7 30.5 11.1 44 7.4 13.5 17.4 24.5 30 32.8 -14.8-0.6-28.7-4.5-41.7-11.7v1.1c0 22.3 7 41.8 21 58.7 14 16.8 31.6 27.5 53 31.8 -8 2.1-16.1 3.1-24.3 3.1 -5.3 0-11.1-0.5-17.4-1.4 5.9 18.5 16.8 33.6 32.5 45.5 15.8 11.9 33.7 18 53.7 18.4 -33.5 26.3-71.7 39.4-114.5 39.4 -8.2 0-15.6-0.4-22.3-1.1 42.8 27.6 90 41.4 141.6 41.4 32.7 0 63.5-5.2 92.2-15.6 28.7-10.4 53.3-24.3 73.7-41.7 20.4-17.4 37.9-37.4 52.7-60.1 14.8-22.7 25.7-46.3 33-70.9 7.2-24.7 10.8-49.3 10.8-74.1 0-5.3-0.1-9.3-0.3-12C421.8 120.2 437.2 104.3 450 85.7z’ fill=’rgb(0%2c 0%2c 0)‘ data-evernote-id=’605’ class=’js-evernote-checked’%3e%3c/path%3e%3c/svg%3e) </a><a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fblogs.unity3d.com%2F2015%2F05%2F06%2Fan-introduction-to-ilcpp-internals%2F&amp;title=An+introduction+to+IL2CPP+internals&amp;summary=Almost+a+year+ago+now%2C+we+started+to+talk+about+the+future+of+scripting+in+Unity.+The+new+IL2CPP+scripting+backend+promised+to+bring+a+highly-performant%2C+highly-portable+virtual+machine+to+Unity.+In+January%2C+we+shipped+our+first+platform+using+IL2CPP%2C+iOS+64-bit.+The+Unity+5+release+brought+another+platform%2C+WebGL.+Thanks+to+the+input+from+%5B%26hellip%3B%5D&amp;source=Unity3d+Blog" target="_blank" rel="noopener"><br><img src="data:image/svg+xml,%3csvg xmlns=&#39;http://www.w3.org/2000/svg&#39; version=&#39;1.1&#39; x=&#39;0&#39; y=&#39;0&#39; width=&#39;438.5&#39; height=&#39;438.5&#39; viewBox=&#39;0 0 438.5 438.5&#39; xml:space=&#39;preserve&#39; fill=&#39;rgb\(0%2c 0%2c 0\" alt=""><br>‘ data-evernote-id=’607’ class=’js-evernote-checked’%3e%3cstyle data-evernote-id=’608’ class=’js-evernote-checked’%3e.s0 %7b fill: rgb(0%2c 0%2c 0)%3b %7d%3c/style%3e %3crect x=’5.4’ y=’145.9’ width=’94.2’ height=’282.9’ fill=’rgb(0%2c 0%2c 0)‘ data-evernote-id=’609’ class=’js-evernote-checked’%3e%3c/rect%3e %3cpath d=’M408.8 171.7c-19.8-21.6-46-32.4-78.5-32.4 -12 0-22.9 1.5-32.7 4.4 -9.8 3-18.1 7.1-24.8 12.4 -6.8 5.3-12.1 10.3-16.1 14.8 -3.8 4.3-7.5 9.4-11.1 15.1v-40.2h-93.9l0.3 13.7c0.2 9.1 0.3 37.3 0.3 84.5 0 47.2-0.2 108.8-0.6 184.7h93.9V270.9c0-9.7 1-17.4 3.1-23.1 4-9.7 10-17.8 18.1-24.4 8.1-6.6 18.1-9.9 30.1-9.9 16.4 0 28.4 5.7 36.1 17 7.7 11.3 11.6 27 11.6 47V428.8h93.9V266.7C438.5 225 428.6 193.3 408.8 171.7zM53.1 9.7c-15.8 0-28.6 4.6-38.4 13.8C4.9 32.8 0 44.4 0 58.5c0 13.9 4.8 25.5 14.3 34.8 9.5 9.3 22.1 14 37.7 14h0.6c16 0 28.9-4.7 38.7-14 9.8-9.3 14.6-20.9 14.4-34.8 -0.2-14.1-5-25.7-14.6-35C81.6 14.3 68.9 9.7 53.1 9.7z’ fill=’rgb(0%2c 0%2c 0)‘ data-evernote-id=’610’ class=’js-evernote-checked’%3e%3c/path%3e%3c/svg%3e) </a></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/" rel="tag">Unity3D</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-Unity3D-Animation优化"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2023/07/25/Unity3D-Animation%E4%BC%98%E5%8C%96/"
    >Animation优化</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2023/07/25/Unity3D-Animation%E4%BC%98%E5%8C%96/" class="article-date">
  <time datetime="2023-07-25T12:56:23.212Z" itemprop="datePublished">2023-07-25</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Unity3D/">Unity3D</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p><strong>标签：</strong>|  <em>优化</em>  </p>
<h2 id="优化方案"><a href="#优化方案" class="headerlink" title="优化方案"></a>优化方案</h2><ol>
<li><p>Rig-&gt;Animation Type:改为Generic</p>
</li>
<li><p>Animations-&gt;Anim.Compression:Optimal</p>
</li>
<li><p>其他高级方式</p>
</li>
</ol>
<h2 id="曲线数据存储与压缩"><a href="#曲线数据存储与压缩" class="headerlink" title="曲线数据存储与压缩"></a>曲线数据存储与压缩</h2><h3 id="存储方式"><a href="#存储方式" class="headerlink" title="存储方式"></a>存储方式</h3><h4 id="Stream-流"><a href="#Stream-流" class="headerlink" title="Stream(流)"></a>Stream(流)</h4><p>Use the “stream” method of storing data (values with time and tangent data for curved interpolation).<br>（保留时间和切线数据进行 <strong>曲线插值</strong> ）<br>This data occupies significantly <strong>more memory</strong> than the “dense” method.</p>
<blockquote>
<p>Streaming curves are very fast to decompress in the average use case.</p>
</blockquote>
<h4 id="Dense-密集的"><a href="#Dense-密集的" class="headerlink" title="Dense(密集的)"></a>Dense(密集的)</h4><p>Optimize animation curves using the “dense” method of storing data (discrete values which are interpolated between linearly).<br>（离散数值之间的 <strong>线性差值</strong> ）<br>不含有切线数据，使用较少内存<br>This method uses less significantly less memory than the “stream” method.<br>与“流”方法相比，此方法使用的内存要少得多。</p>
<h4 id="Constant"><a href="#Constant" class="headerlink" title="Constant"></a>Constant</h4><p>Curves are optimised as constant (unchanging) values.<br>Unity selects this automatically if your animation files contain curves with unchanging values.</p>
<h3 id="Compression方式"><a href="#Compression方式" class="headerlink" title="Compression方式"></a>Compression方式</h3><p>Unity引擎对导入的Clip提供三种压缩格式，Off、KeyframeReduction和Optimal。其中Off表示不压缩，Keyframe Reduction表示使用关键帧进行处理，Optimal则表示Unity引擎会根据动画曲线的特点来自动选择一个最优的压缩方式。</p>
<h4 id="Off"><a href="#Off" class="headerlink" title="Off"></a>Off</h4><p>存储方式：Stream</p>
<p>不压缩，官方不推荐</p>
<blockquote>
<p>Unity文档: This means that Unity doesn’t reduce keyframe count on import. Disabling animation compression leads to the highest precision animations, but slower performance and bigger file and runtime memory size. It is generally not advisable to use this option - if you need higher precision animation, you should enable keyframe reduction and lower allowed Animation Compression Error values instead.</p>
</blockquote>
<h4 id="Keyframe-Reduction"><a href="#Keyframe-Reduction" class="headerlink" title="Keyframe Reduction"></a>Keyframe Reduction</h4><p>存储方式：Stream<br>压缩方式：关键帧缩减算法</p>
<h5 id="Keyframe-Reduction算法"><a href="#Keyframe-Reduction算法" class="headerlink" title="Keyframe Reduction算法"></a>Keyframe Reduction算法</h5><p>Basically key frame reduction will simply <strong>go through all key frames in your animation, and evaluate the animation curves with and without that key, and if the difference is smaller then some defined delta, the key is removed.</strong></p>
<p><strong>error tolerance(误差宽容度，容错值)</strong> 或者称为 <strong>error threshold(误差阈值)</strong><br>值越小动画的精度越高，如果默认值的表现效果不过好，可以通过减小容错值来调。</p>
<ul>
<li><p>Rotation Error 角度值</p>
</li>
<li><p>Position Error 百分比值</p>
</li>
<li><p>Scale Error 百分比值</p>
</li>
</ul>
<p>Unity compares the original curve to what the curve looks like after removing a specific keyframe and applies this test：<br>OriginalValue - ReducedValue &gt; OriginalValue * percentageOfError<br>Unity removes a keyframe if the delta between the original value and the reduced value is less than the original value multiplied by the error tolerance percentage.</p>
<h4 id="Optimal"><a href="#Optimal" class="headerlink" title="Optimal"></a>Optimal</h4><p>存储方式：(Unity官方)Unity will use a heuristic algorithm to determine whether it is best to use the <strong>dense</strong> or <strong>stream</strong> method to store the data for each curve.<br>(笔者推测，可能对于unchanging的值做优化处理，使用constant方式存储)<br>压缩方式：Unity decide how to compress, either by <strong>keyframe reduction</strong> or by using <strong>dense format</strong>.</p>
<p>If a track is very short or very noisy (which could happen with motion capture clips or baked simulations), the key reduction algorithm might not give appreciable gains and it is possible that a dense curve might end up having a smaller memory footprint than a streaming curve. </p>
<blockquote>
<p>Unity官方：<br> If your animation clips are imported with “Anim Compression” set to “Optimal” in the Animation import reference, Unity will use a heuristic（启发式的） algorithm to determine whether it is best to use the <strong>dense</strong> or <strong>stream</strong> method to <strong>store the data for each curve</strong>.</p>
</blockquote>
<h3 id="UWA性能对比实验"><a href="#UWA性能对比实验" class="headerlink" title="UWA性能对比实验"></a>UWA性能对比实验</h3><p><a href="https://blog.uwa4d.com/archives/Loading_AnimationClip.html" target="_blank" rel="noopener">https://blog.uwa4d.com/archives/Loading_AnimationClip.html</a></p>
<ol>
<li><p>Optimal压缩方式确实可以提升资源的加载效率，无论是在高端机、中端机还是低端机上；</p>
</li>
<li><p>硬件设备性能越好，其加载效率越高。但随着设备的提升，Keyframe Reduction和Optimal的加载效率提升已不十分明显；</p>
</li>
<li><p>Optimal压缩方式可能会降低动画的视觉质量，因此，是否最终选择Optimal压缩模式，还需根据最终视觉效果的接受程度来决定。</p>
</li>
</ol>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>从性能的角度来看，Optimal的方式内存占用是最低的，是我们最推荐的方案，但是可能会降低动画的视觉质量。Off是不压缩，Unity官方都不推荐的。Keyframe Reduction内存稍高于Optimal，在内存性能和效果上算是折中的方案，用户手动设置Keyframe Reduction问题不大。</p>
<h2 id="优化方法"><a href="#优化方法" class="headerlink" title="优化方法"></a>优化方法</h2><h3 id="1-去掉AnimationClip中的无效曲线：例如ScaleCurve"><a href="#1-去掉AnimationClip中的无效曲线：例如ScaleCurve" class="headerlink" title="1. 去掉AnimationClip中的无效曲线：例如ScaleCurve"></a>1. 去掉AnimationClip中的无效曲线：例如ScaleCurve</h3><pre><code class="lang-csharp">
using UnityEngine; 

using UnityEditor; 

using System.Collections.Generic; 

public class RemoveCurve : AssetPostprocessor

{ 

void OnPostprocessModel(GameObject g)

{ 

Apply(g); 

} 

void Apply(GameObject g)

{ 

List&lt;AnimationClip&gt; animationClipList = new List&lt;AnimationClip&gt;(AnimationUtility.GetAnimationClips(g)); 

if (animationClipList.Count == 0) 

{ 

AnimationClip[] objectList = UnityEngine.Object.FindObjectsOfType(typeof(AnimationClip)) as AnimationClip[]; 

animationClipList.AddRange(objectList); 

} 

foreach (AnimationClip theAnimation in animationClipList) 

{ 

foreach (EditorCurveBinding theCurveBinding in AnimationUtility.GetCurveBindings(theAnimation)) 

{ 

string name = theCurveBinding.propertyName.ToLower(); 

if (name.Contains(&quot;scale&quot;)) 

{ 

AnimationUtility.SetEditorCurve(theAnimation, theCurveBinding, null); 

} 

} 

} 

} 

}
</code></pre>
<h3 id="2-压缩AnimationClip文件float的精度"><a href="#2-压缩AnimationClip文件float的精度" class="headerlink" title="2. 压缩AnimationClip文件float的精度"></a>2. 压缩AnimationClip文件float的精度</h3><pre><code class="lang-csharp">
public static bool CompressAnimationClip(Object o)

{ 

string animationPath = AssetDatabase.GetAssetPath(o); 

try

{ 

//AnimationClip clip = GameObject.Instantiate(o) as AnimationClip;

AnimationClip clip = o as AnimationClip; 

AnimationClipCurveData[] curves = null; 

curves = AnimationUtility.GetAllCurves(clip); 

Keyframe key; 

Keyframe[] keyFrames; 

for (int ii = 0; ii &lt; curves.Length; ++ii) 

{ 

AnimationClipCurveData curveDate = curves[ii]; 

if (curveDate.curve == null || curveDate.curve.keys == null) 

{ 

//Debug.LogWarning(string.Format(&quot;AnimationClipCurveData {0} don&#39;t have curve; Animation name {1} &quot;, curveDate, animationPath));

continue; 

} 

keyFrames = curveDate.curve.keys; 

for (int i = 0; i &lt; keyFrames.Length; i++) 

{ 

key = keyFrames[i]; 

key.value = float.Parse(key.value.ToString(&quot;f3&quot;)); 

key.inTangent = float.Parse(key.inTangent.ToString(&quot;f3&quot;)); 

key.outTangent = float.Parse(key.outTangent.ToString(&quot;f3&quot;)); 

keyFrames[i] = key; 

} 

curveDate.curve.keys = keyFrames; 

clip.SetCurve(curveDate.path, curveDate.type, curveDate.propertyName, curveDate.curve); 

} 

//AssetDatabase.CreateAsset(clip, animationPath);

Debug.Log(string.Format(&quot; CompressAnimationClip {0} Success !!!&quot;, animationPath)); 

return true; 

} 

catch(Exception e) 

{ 

Debug.LogError(string.Format(&quot;CompressAnimationClip Failed !!! animationPath : {0} error: {1}&quot;, animationPath, e)); 

return false; 

} 

}
</code></pre>
<h2 id="其他内容"><a href="#其他内容" class="headerlink" title="其他内容"></a>其他内容</h2><h3 id="optimize-gameobject"><a href="#optimize-gameobject" class="headerlink" title="optimize gameobject"></a>optimize gameobject</h3><p>针对Mecinam新版动画系统的优化选项，默认情况下会将动画网格下的所有骨骼结点隐藏，但是，你可以通过“Extra Transform to Expose”查看你想通过脚本获取的骨骼结点，这样既可以提升该角色的动画模块性能，又可以达到获取某个关键结点的需求。不过这种方式获得的骨骼节点是只读的，如果想要对其中的属性进行改变比如换装，就不可以开启这个选项。</p>
<h3 id="multithreaded-rendering"><a href="#multithreaded-rendering" class="headerlink" title="multithreaded rendering"></a>multithreaded rendering</h3><p>多线程渲染，将主线程的一部分渲染工作移到另一个线程里执行，Android平台下才有的优化渲染设置，但是对半透明物体支持不好，项目中需要进行测试来决定开不开启。</p>
<h3 id="Animation-Type"><a href="#Animation-Type" class="headerlink" title="Animation Type"></a>Animation Type</h3><p>Legacy Generic Humaniod<br>Legacy 老版动画系统<br>Generic 适合非人型动画<br>Humaniod 适合人型动画，可以动画重定向<br>cpu耗时 Generic &lt; Humanoid<br>Humanoid更省内存</p>
<h3 id="Apply-Root-Motion"><a href="#Apply-Root-Motion" class="headerlink" title="Apply Root Motion"></a>Apply Root Motion</h3><p>增加CPU计算量，不建议开启。如果要开启，建议勾上optimize gameobject。</p>
<h3 id="AnimationBlend"><a href="#AnimationBlend" class="headerlink" title="AnimationBlend"></a>AnimationBlend</h3><p>指的是混合树，多层动画，动画状态过渡三个方面。<br>会增加ProcessAnimations的开销<br>避免频繁blend<br>替换不必要的blend tree和layers</p>
<h3 id="Bake-Mesh"><a href="#Bake-Mesh" class="headerlink" title="Bake Mesh"></a>Bake Mesh</h3><p>将Skinned Mesh转换为普通的Mesh，运行时从网格中获取对应的网格数据进行渲染。<br>缺点：需要记录Mesh信息，占用大量内存。</p>
<h3 id="GPU-Skinning"><a href="#GPU-Skinning" class="headerlink" title="GPU Skinning"></a>GPU Skinning</h3><p>用GPU计算网格，<br>优点：<br>减少SkinnedMesh.Render的CPU耗时<br>骨骼结点信息通过纹理来存储，数据量较Bake Mesh会大幅降低<br>缺点：<br>增加GPU消耗，<br>要求DIrectX 11或者Opengl ES 3.0</p>
<h3 id="简化骨骼名字"><a href="#简化骨骼名字" class="headerlink" title="简化骨骼名字"></a>简化骨骼名字</h3><p>unity的动画数据存储的时候按每个骨骼节点的轨道拆分存储的，每个骨骼存储的是从根节点到这个骨骼节点的hierarchy路径，字符串的，骨骼多了之后这部分字符串不少。如果把所有骨骼名字都简化，这里可以省不少内存 </p>
<h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p><a href="http://nfrechette.github.io/2017/01/30/anim_compression_unity5/" target="_blank" rel="noopener">http://nfrechette.github.io/2017/01/30/anim_compression_unity5/</a><br><a href="http://www.manew.com/thread-103127-1-1.html" target="_blank" rel="noopener">http://www.manew.com/thread-103127-1-1.html</a><br><a href="https://blog.csdn.net/alexander_xfl/article/details/66975570" target="_blank" rel="noopener">https://blog.csdn.net/alexander_xfl/article/details/66975570</a><br><a href="https://blog.csdn.net/j756915370/article/details/79415841" target="_blank" rel="noopener">https://blog.csdn.net/j756915370/article/details/79415841</a><br><a href="https://blog.uwa4d.com/archives/Loading_AnimationClip.html" target="_blank" rel="noopener">https://blog.uwa4d.com/archives/Loading_AnimationClip.html</a><br><a href="http://www.360doc.com/content/17/0424/15/6432946_648246543.shtml" target="_blank" rel="noopener">http://www.360doc.com/content/17/0424/15/6432946_648246543.shtml</a></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/" rel="tag">Unity3D</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/archives/10/">上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/archives/9/">9</a><a class="page-number" href="/archives/10/">10</a><span class="page-number current">11</span><a class="page-number" href="/archives/12/">12</a><a class="page-number" href="/archives/13/">13</a><a class="extend next" rel="next" href="/archives/12/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2015-2023
        <i class="ri-heart-fill heart_icon"></i> Prin
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>Visitors:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>Views:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/img/circle_image.png" alt="半个出家人"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/friends">友链</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">关于我</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories/Unreal">虚幻引擎</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    

  </div>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-MML-AM_CHTML"></script>

</body>

</html>